<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>Weaver Li</title>
  <meta name="author" content="Weaver Li">
  
  <meta name="description" content="Time is money!">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Weaver Li"/>

  
    <meta property="og:image" content=""/>
  

  
    <link rel="alternative" href="/atom.xml" title="Weaver Li" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/prism.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70812759-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70812759-1');
</script>






<meta name="generator" content="Hexo 7.3.0"></head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">Weaver Li</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class=""></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class=""></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class=""></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class=""></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 <div class="page-header logo">
  <h1>Show Me The Code!<span class="blink-fast">|</span></h1>
</div>

<div class="row page">

	
	<div class="col-md-9">
	

		<div class="slogan">


		<i class="fa fa-heart blink-slow"></i>

		wubba lubba dub dub.

</div>    

		<div id="top_search"></div>
		<div class="mypage">
		
		<!-- title and entry -->
		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/10/12/appium自动化测试/" >appium自动化测试</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-10-12  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h4 id="使用Appium对Android-App-进行自动化测试"><a href="#使用Appium对Android-App-进行自动化测试" class="headerlink" title="使用Appium对Android App 进行自动化测试"></a>使用Appium对Android App 进行自动化测试</h4><h5 id="一、环境"><a href="#一、环境" class="headerlink" title="一、环境"></a>一、环境</h5><ul>
<li>node v16.3.0</li>
<li>python 2.7</li>
<li>java 13.0.1</li>
<li>android sdk 31</li>
</ul>
<h4 id="二、概述"><a href="#二、概述" class="headerlink" title="二、概述"></a>二、概述</h4><blockquote>
<p>Appium是一个自动化开源工具，支持iOS、Android和Windows桌面平台上的原生、移动Web和混合应用的自动化。<br>Appium是跨平台的：它允许你用同样的API对多平台（iOS、Android、Windows）写测试。<br>做到在iOS、Android和Windows测试套件之间复用代码。</p>
</blockquote>
<h4 id="三、下载安装环境配置"><a href="#三、下载安装环境配置" class="headerlink" title="三、下载安装环境配置"></a>三、下载安装环境配置</h4><p>1、 安装python安装Appium-Python-Client库（写python自动化测试脚本会用到）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install Appium-Python-Client</span><br></pre></td></tr></table></figure>

<p>2、安装SDK</p>
<p>自行安装即可</p>
<p>3、安装JDK</p>
<p>(1) 在<a target="_blank" rel="noopener" href="https://www.oracle.com/java/technologies/downloads/">oracle</a>官网下载安装JDK，安装JDK8及以上的版本。</p>
<p>(2) 安装完成后，设置JDK的环境变量</p>
<p>(3) 我这里使用的是oh my zsh</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~</span><br><span class="line">vim .zshrc</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置ANDROID_HOME环境变量</span></span><br><span class="line">export ANDROID_HOME=&quot;/Users/liwenyang/Library/Android/sdk/&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置JAVA_HOME环境变量</span></span><br><span class="line">export JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk-13.0.1.jdk/Contents/Home</span><br><span class="line">export PATH=$JAVA_HOME/bin:$PATH</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置Android sdk tools adb</span></span><br><span class="line">export PATH=&quot;$PATH:/Users/liwenyang/Library/Android/sdk/platform-tools&quot;</span><br></pre></td></tr></table></figure>

<p>将jdk版本号、用户名换成自己的 </p>
<p>然后 <code>source .zshrc</code></p>
<h4 id="四、安装appium-server"><a href="#四、安装appium-server" class="headerlink" title="四、安装appium server"></a>四、安装appium server</h4><p>1、在<a href="https://github.com/appium/appium-desktop/releases/tag/v1.22.0">appium官网</a>下载</p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20211012163841.png"></p>
<p>下载完之后进行安装就行了</p>
<p>2、设置</p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20211012164022.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20211012164101.png"></p>
<p>保存并重启就行了</p>
<p>3、启动</p>
<p>点击上图中的 start server 出现这个说明启动成功 </p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20211012164215.png"></p>
<h4 id="五、还需要一个东西"><a href="#五、还需要一个东西" class="headerlink" title="五、还需要一个东西"></a>五、还需要一个东西</h4><p>1、用来定位你app页面中的元素的 写自动化脚本会用到</p>
<p><a href="https://github.com/appium/appium-inspector/releases/tag/v2021.9.2">点击这个下载</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20211012164617.png"></p>
<p>正常安装即可</p>
<p>2、配置</p>
<p>真机测试 </p>
<p>USB连接手机，打开手机开发者模式，打开开发者选项中的USB调试、USB安装，小米手机还需要打开USB调试（安全设置），然后在CMD命令行输入adb devices回车，如果出现了手机的设备号，说明连接成功。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20211012165710.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20211012165003.png"></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;platformName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Android&quot;</span><span class="punctuation">,</span> # 声明是ios还是Android系统</span><br><span class="line"><span class="attr">&quot;platformVersion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;8.1.0&quot;</span><span class="punctuation">,</span> # Android内核版本号</span><br><span class="line"><span class="attr">&quot;deviceName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MI_5X&quot;</span><span class="punctuation">,</span> # 连接的设备名称</span><br><span class="line"><span class="attr">&quot;appPackage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;com.tencent.qqmusic&quot;</span><span class="punctuation">,</span> # apk的包名</span><br><span class="line"><span class="attr">&quot;appActivity&quot;</span><span class="punctuation">:</span> <span class="string">&quot;.activity.AppStarterActivity&quot;</span><span class="punctuation">,</span> # apk的launcherActivity</span><br><span class="line"><span class="attr">&quot;resetKeyboard&quot;</span><span class="punctuation">:</span> True<span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;noReset&quot;</span><span class="punctuation">:</span> True # 在开始会话之前不要重置应用程序状态</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>截图中的 appium前缀是勾选那个就可以加上了</p>
<p>下面点击 start session 就可以了</p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20211012165937.png"></p>
<p>这个工具就是方便我们进行定位app内的元素用的</p>
<h4 id="六、写自动化测试脚本"><a href="#六、写自动化测试脚本" class="headerlink" title="六、写自动化测试脚本"></a>六、写自动化测试脚本</h4><p>随便找一个地方写个 autoTest.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> appium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">caps = &#123;</span><br><span class="line">    <span class="string">&quot;platformName&quot;</span>: <span class="string">&quot;Android&quot;</span>,</span><br><span class="line">    <span class="string">&quot;platformVersion&quot;</span>: <span class="string">&quot;9&quot;</span>,</span><br><span class="line">    <span class="string">&quot;deviceName&quot;</span>: <span class="string">&quot;Note9&quot;</span>,</span><br><span class="line">    <span class="string">&quot;appPackage&quot;</span>: <span class="string">&quot;com.easylife.house.customer&quot;</span>,</span><br><span class="line">    <span class="string">&quot;appActivity&quot;</span>: <span class="string">&quot;.ui.pub.GuideActivity&quot;</span>,</span><br><span class="line">    <span class="string">&quot;resetKeyboard&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">&quot;noReset&quot;</span>: <span class="literal">True</span></span><br><span class="line">&#125;</span><br><span class="line">driver = webdriver.Remote(<span class="string">&quot;http://localhost:4723/wd/hub&quot;</span>, caps)</span><br><span class="line"></span><br><span class="line">lunch = driver.find_element_by_id(<span class="string">&quot;com.easylife.house.customer:id/activity_launch&quot;</span>)</span><br><span class="line">lunch.click()</span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">driver.find_element_by_id(<span class="string">&quot;com.easylife.house.customer:id/iv_icon2&quot;</span>).click()</span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line">driver.swipe(<span class="number">500</span>, <span class="number">1550</span>, <span class="number">500</span>, <span class="number">400</span>)</span><br><span class="line"></span><br><span class="line">driver.find_element_by_id(<span class="string">&quot;com.easylife.house.customer:id/iv_icon3&quot;</span>).click()</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line">driver.swipe(<span class="number">500</span>, <span class="number">1550</span>, <span class="number">500</span>, <span class="number">400</span>)</span><br><span class="line"></span><br><span class="line">driver.find_element_by_id(<span class="string">&quot;com.easylife.house.customer:id/iv_icon4&quot;</span>).click()</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line">driver.swipe(<span class="number">500</span>, <span class="number">1550</span>, <span class="number">500</span>, <span class="number">400</span>)</span><br><span class="line"></span><br><span class="line">driver.find_element_by_id(<span class="string">&quot;com.easylife.house.customer:id/iv_icon5&quot;</span>).click()</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line">driver.swipe(<span class="number">500</span>, <span class="number">1550</span>, <span class="number">500</span>, <span class="number">400</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#点击首页</span></span><br><span class="line">driver.find_element_by_id(<span class="string">&quot;com.easylife.house.customer:id/iv_icon1&quot;</span>).click()</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line">driver.find_element_by_id(<span class="string">&quot;com.easylife.house.customer:id/newHouse&quot;</span>).click()</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line">driver.swipe(<span class="number">500</span>, <span class="number">1550</span>, <span class="number">500</span>, <span class="number">400</span>)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行这个脚本 <code>python3 autoTest.py</code><br>脚本就可以自动的进行点击 滑动 等操作了</p>

	
	</div>
  <a type="button" href="/2021/10/12/appium自动化测试/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/07/30/deploy-a-nft-art-and-transfer-in-eth-testnet/" >deploy a nft art and transfer in eth testnet</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-07-30  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h3 id="如何在以太坊测试网络上发布一个NFT艺术品并转给他人"><a href="#如何在以太坊测试网络上发布一个NFT艺术品并转给他人" class="headerlink" title="如何在以太坊测试网络上发布一个NFT艺术品并转给他人"></a>如何在以太坊测试网络上发布一个NFT艺术品并转给他人</h3><h4 id="1、首先什么是NFT"><a href="#1、首先什么是NFT" class="headerlink" title="1、首先什么是NFT"></a>1、首先什么是NFT</h4><blockquote>
<p>非同质化代币NFT是一种数字资产，具备不可分割和独一无二这两大特性，可用于代表有形和无形的物品。NFT应用场景多样，包括数字收藏品、音乐、艺术品以及游戏内代币。</p>
</blockquote>
<h4 id="2-、什么是ERC-721"><a href="#2-、什么是ERC-721" class="headerlink" title="2 、什么是ERC-721"></a>2 、什么是ERC-721</h4><p>ERC 代表 Ethereum Request for Comment，721 是提案标识符号。 ERC 是以太坊生态系统中的应用级标准，可以是 ERC-20 等代币的智能合约标准，ERC 的作者负责与以太坊社区建立共识，一旦提案得到以太坊社区的审查和批准社区它成为一个标准。您可以在此处跟踪最近的 ERC 提案。创建 ERC-721 是为了提出在智能合约中跟踪和传输 NFT 的功能。</p>
<p>ERC-721 是一个开放标准，描述了如何在 EVM（以太坊虚拟机）兼容的区块链上构建不可替代的代币；它是不可替代代币的标准接口；它有一套规则，可以很容易地使用 NFT。 NFT 不仅是 ERC-721 类型；它们也可以是 ERC-1155 代币。</p>
<h4 id="3、我们还需要知道一个东西-IPFS"><a href="#3、我们还需要知道一个东西-IPFS" class="headerlink" title="3、我们还需要知道一个东西 IPFS"></a>3、我们还需要知道一个东西 <code>IPFS</code></h4><blockquote>
<p>星际文件系统（InterPlanetary File System，缩写为IPFS）是一个旨在创建持久且分布式存储和共享文件的网络传输协议。它是一种内容可寻址的对等超媒体分发协议。在IPFS网络中的节点将构成一个分布式文件系统。它是一个开放源代码项目，自2014年开始由协议实验室在开源社区的帮助下发展。其最初由Juan Benet设计。</p>
</blockquote>
<p>如果要发布一个NFT艺术品,我们需要定义这个艺术品的属性，通常我们用<code>json</code>文件来定义，我们还需要一个链接可以查看这个艺术品</p>
<p>随便创建一个xxx.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;NFT Art&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;This image shows the true nature of NFT.&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://ipfs.io/ipfs/QmQLzfy3Zs9S6nV4HG9to9wntbdaoJgC41wgEQMJwm6gBK&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>name 艺术品的名称</p>
</li>
<li><p>description 艺术品的描述</p>
</li>
<li><p>image 图片的链接</p>
</li>
</ul>
<p>这里我们就定义了一个简单的json文件来表示这个艺术品<br><code>IPFS</code> 是一个去中心化的平台 我们将json文件 图片上传到这个平台 可以拿到这样的链接</p>
<p><strong>下面我们来说一下如何使用<code>IPFS</code></strong></p>
<p><a target="_blank" rel="noopener" href="https://ipfs.io/">IPFS官网地址</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210730175202.png"></p>
<p>我这里选择的是 桌面应用程序 可视化界面 好操作一些 </p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210730175424.png"></p>
<p>打开之后 选择导入 我们选择创建的xxx.json 和 一张图片也好 gif也行</p>
<p>然后我们点击三个点 选择 分享链接 复制一下链接就行了</p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210730175647.png"></p>
<p>当然 你也可以不选择<code>IPFS</code> 只要提供的链接能访问到就行。用IPFS的原因是去中心化 如果是你自己提供的链接那就可能不是去中心化了</p>
<p>这里我给出我的两个链接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">json字符串 </span><br><span class="line">https://ipfs.io/ipfs/QmZJEQLGYSMoVMmzVrkujsPiydZiWbHHGFZQLvf8J79s8h?filename=apple.json</span><br><span class="line"></span><br><span class="line">图片链接</span><br><span class="line">https://ipfs.io/ipfs/QmQLzfy3Zs9S6nV4HG9to9wntbdaoJgC41wgEQMJwm6gBK?filename=spin.gif</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>后面的<code>?filename=apple.json</code>可以删掉也能访问到</p>
<h4 id="4、编写智能合约"><a href="#4、编写智能合约" class="headerlink" title="4、编写智能合约"></a>4、编写智能合约</h4><p>编写NFT合约代码的话 我们可以选择一些非常成熟的库在他们的基础上进行编写自己的NFT代码 比较好的库就是<code>OpenZeppelin</code></p>
<p><a href="https://github.com/OpenZeppelin/openzeppelin-contracts/tree/master/contracts/token/ERC721/extensions">github地址</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210730172037.png"></p>
<p>他这里是提供了很多个不同功能的NFT代码给我们， 我们只需要选择红色框那个来继承就行了，这个是比较简单的， 没有别的复杂功能。</p>
<h4 id="5、开始编写代码"><a href="#5、开始编写代码" class="headerlink" title="5、开始编写代码"></a>5、开始编写代码</h4><p>这里我们选择在线的<code>Remix</code>来编写我们的合约代码 </p>
<p><a target="_blank" rel="noopener" href="http://remix.app.hubwiz.com/#optimize=false&runs=200&evmVersion=null&version=soljson-v0.7.4+commit.3f05b770.js">Remix中文版地址</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.0;</span><br><span class="line"></span><br><span class="line">import &quot;https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC721/extensions/ERC721URIStorage.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract MobilePhoneNft is ERC721URIStorage&#123;</span><br><span class="line"></span><br><span class="line">  uint public counter;</span><br><span class="line"></span><br><span class="line">  constructor() ERC721(&quot;MobilePhoneNft&quot;, &quot;MPN&quot;)&#123;</span><br><span class="line">    counter = 0;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function createNFTs (string memory tokenURI) public returns(uint) &#123;</span><br><span class="line">    uint tokenId = counter;</span><br><span class="line"></span><br><span class="line">    _safeMint(msg.sender, tokenId);</span><br><span class="line">    _setTokenURI(tokenId, tokenURI);</span><br><span class="line"></span><br><span class="line">    counter ++;</span><br><span class="line">    return tokenId;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  function burn(uint256 tokenId) public virtual &#123;</span><br><span class="line">    require(_isApprovedOrOwner(msg.sender, tokenId), &quot;You can not burn it, because you are not the owner!&quot;);</span><br><span class="line">    super._burn(tokenId);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们讲一下这个代码 </p>
<p><code>createNFTs</code> 创建一个NFT 我们调用的时候需要传入一个参数 这个参数是一个地址代表你这个<code>NFT</code>的一些属性 这个地址是一串<code>json</code>字符串</p>
<p><a target="_blank" rel="noopener" href="https://ipfs.io/ipfs/QmZJEQLGYSMoVMmzVrkujsPiydZiWbHHGFZQLvf8J79s8h">https://ipfs.io/ipfs/QmZJEQLGYSMoVMmzVrkujsPiydZiWbHHGFZQLvf8J79s8h</a></p>
<p><code>json</code> 字符串内容如下:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;NFT Art&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;This image shows the true nature of NFT.&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://ipfs.io/ipfs/QmQLzfy3Zs9S6nV4HG9to9wntbdaoJgC41wgEQMJwm6gBK&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>tokenId 我们使用<code>counter ++</code> 自增 初始值为0</p>
<p>有一个<code>burn</code>的方法 当你调用完<code>createNFTs</code>创建了一个NFT但是你并不满意时 可以调用这个方法来烧毁这个<code>NFT</code>。</p>
<h4 id="6、合约部署"><a href="#6、合约部署" class="headerlink" title="6、合约部署"></a>6、合约部署</h4><p>编译一下我们的合约</p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210730180438.png"></p>
<p>如果没有问题 就可以部署了</p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210730180645.png"></p>
<p>我这里是部署到 Rinkeby 测试网络 部署完成之后 我们就调用一下 合约的方法 <code>createNFTs</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210730180909.png"></p>
<p>填入上面那个 <code>json</code> 的链接 正常付gas费就行了 </p>
<p>之后我们在<code>https://rinkeby.etherscan.io/</code>测试网络上查看 我们的账户就可以看到那个nft合约了 不过我们看不到图片</p>
<p>如果想看到图片的话 需要借助<code>openSea</code> 它也是支持了<code>Rinkby</code>测试网络的</p>
<p><a target="_blank" rel="noopener" href="https://testnets.opensea.io/account">Open Sea Rinkby 测试网络</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210730181750.png"></p>
<h4 id="7、将这个NFT转给他人"><a href="#7、将这个NFT转给他人" class="headerlink" title="7、将这个NFT转给他人"></a>7、将这个NFT转给他人</h4><p>我们只需要调用 这个方法就行了 这个方法是 ERC-721 提供的方法</p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210730182229.png"></p>
<p>tokenId 在rinkeby测试网可以查看 我这里是 0</p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210730182401.png"></p>

	
	</div>
  <a type="button" href="/2021/07/30/deploy-a-nft-art-and-transfer-in-eth-testnet/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/07/01/记一次被钓鱼网站盗走eth的经历/" >记一次被钓鱼网站盗走eth的经历</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-07-01  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h4 id="记一次被钓鱼网站盗走ETH的经历"><a href="#记一次被钓鱼网站盗走ETH的经历" class="headerlink" title="记一次被钓鱼网站盗走ETH的经历"></a>记一次被钓鱼网站盗走ETH的经历</h4><p>我本来是要研究<code>NFT</code>(非同质化代币)的, 在研究这个过程中 有几个在线的交易平台<code>Nifty Gateway</code>、<code>OpenSea</code>、<code>MakersPlace</code>等网站可以查看一些商品属性啥的，有助于了解到底啥是<code>NFT</code></p>
<p>我这边也是选择了 <code>OpenSea</code> </p>
<p>之后就被盗走 0.05 个 <code>ETH</code> 700多块钱吧</p>
<h4 id="钓鱼网站是怎样的"><a href="#钓鱼网站是怎样的" class="headerlink" title="钓鱼网站是怎样的"></a>钓鱼网站是怎样的</h4><p>于是我去 <code>Chrome</code> 浏览器 搜索 <code>OpenSea</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210701100243.png"></p>
<p>也是头晕眼花 没注意瞅 就选择了第一个搜索结果</p>
<p>打开网站: </p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210701100549.png"></p>
<p>注意看这里的域名是 <code>www-opensea.io</code> 这里看不出来有啥名堂 咱们继续往下走</p>
<p>点击右上角小头像进行登录</p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210701100814.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210701100904.png"></p>
<p>到这里 感觉有点不一样了 我的小狐狸明明是已经登录的状态 这里然我输入密码解锁 我也没多想解锁就解锁呗,输入密码进行解锁</p>
<p>解锁完之后 又让输入私钥 这网站咱也没登录过啊 可能就是需要私钥吧 我就继续输入了私钥</p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210701101043.png"></p>
<p>输入完私钥后 账户里的<code>eth</code>就没了 这个账户最好不要在使用了 因为账号和私钥已经泄露 </p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210701101449.png"></p>
<p>钱已经被全部转走了 有多少划走多少 转到了<code>0xAf9dE309b54198E2e37C8DB3d367967Fc20EAa9D</code>这个账户 我们去查一下这个账户</p>
<p><a target="_blank" rel="noopener" href="https://etherscan.io/address/0xaf9de309b54198e2e37c8db3d367967fc20eaa9d">骗子账户</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210701101815.png"></p>
<p>这个账户在我写博客的时候 陆陆续续已经进账 1.9 个 <code>eth</code> 了  钱也找不回来了 放弃吧 !!!</p>
<h4 id="正常网站应该是怎样的"><a href="#正常网站应该是怎样的" class="headerlink" title="正常网站应该是怎样的"></a>正常网站应该是怎样的</h4><p>我们打开第二个 网站</p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210701102219.png"></p>
<p>这里的域名是 <code>opensea.io</code></p>
<p>之后我们进行登录</p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210701102434.png"></p>
<p>可以看到 正常网站 如果我们钱包是登录的状态 直接是授权连接 不需要我们输入密码的 甚至密钥  </p>
<p>连接完之后 我们就登录进来了 </p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210701102624.png"></p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>正常网站在进行登录的时候 是不需要用户提供私钥的 如果让你输入解锁密码和私钥 那你可要小心了。</p>
<p>如果让你提供密码和私钥才能进行登录的话 极有可能是 <strong>钓鱼网站</strong> 千万小心。</p>
<p>一旦私钥泄漏 这个账号最好不要再使用 因为这个账号已经不属于你了 及时换账号吧！</p>

	
	</div>
  <a type="button" href="/2021/07/01/记一次被钓鱼网站盗走eth的经历/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/06/25/Android-tablayout-viewpager2-fragment-你可能用错了/" >Android tablayout viewpager2 fragment 你可能用错了</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-06-25  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h3 id="tabLayout-viewPager2-fragment-用不好会导致内存泄漏"><a href="#tabLayout-viewPager2-fragment-用不好会导致内存泄漏" class="headerlink" title="tabLayout + viewPager2 + fragment 用不好会导致内存泄漏"></a>tabLayout + viewPager2 + fragment 用不好会导致内存泄漏</h3><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>tabLayout + viewPager2 + fragment 这是在app开发中非常常见的UI架构了 但是用不好的话 是会导致内存泄漏的</p>
<p><a href="https://github.com/Naruto-1996/ViewPager2_Demo">Demo地址</a></p>
<p>先上图: </p>
<p>(<code>app</code>模板使用<code>android studio</code> 创建一个就行 我只用 <code>HomeFragment</code>)</p>
<img src="https://ae03.alicdn.com/kf/U3292cb58c99d44a3bcf092f9d0fba361h.png" width = "300" height = "600" alt="图片名称" align=center />

<h3 id="先了解一下viewPager"><a href="#先了解一下viewPager" class="headerlink" title="先了解一下viewPager"></a>先了解一下viewPager</h3><p>之前我们都是使用viewPager 但是 viewPager 有两个毛病 </p>
<ul>
<li><p>不能关闭预加载</p>
</li>
<li><p>更新Adapter不生效</p>
</li>
</ul>
<p>虽然能解决 但是很麻烦</p>
<p>viewPager 有个方法 <code>offscreenPageLimit</code> 用来设置 当前页前后预加载的数量 即使设置为0也不起任何作用 因为源码中默认值为1</p>
<p>先来看个图:</p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210625175636.png"></p>
<p>上面是<code>ViewPager</code>默认情况下的加载示意图，当切换到当前页面时，会默认预加载左右两侧的布局到<code>ViewPager</code>中，<br>尽管两侧的<code>View</code>并不可见的，我们称这种情况叫预加载；由于<code>ViewPager</code>对<code>offscreenPageLimit</code>设置了限制，<br>页面的预加载是不可避免</p>
<p>如果使用 一定要使用viewPager 也可以做到 fragment 懒加载 主要是对<code>fragment</code>做手脚 结合生命周期方法和setUserVisibleHint状态，控制数据延迟加载，而布局只能提前进入</p>
<h3 id="viewPager2基本使用"><a href="#viewPager2基本使用" class="headerlink" title="viewPager2基本使用"></a>viewPager2基本使用</h3><p>1、 承载tabLayout 和 viewPager2 需要一个 fragment 或者 activity 这里我们使用 fragment</p>
<p><code>HomeFragment</code> 如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HomeFragment</span> <span class="keyword">extends</span> <span class="title class_">Fragment</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> HomeViewModel homeViewModel;</span><br><span class="line">  <span class="keyword">private</span> TabLayout tabLayout;</span><br><span class="line">  <span class="keyword">private</span> ViewPager2 viewPager2;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> ArrayList&lt;String&gt; tabTitles = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 用List 存放fragment 不推荐使用 用不好 导致内存泄漏</span></span><br><span class="line">  <span class="keyword">private</span> ArrayList&lt;BlankFragment&gt; fragments = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> View <span class="title function_">onCreateView</span><span class="params">(<span class="meta">@NonNull</span> LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    homeViewModel = <span class="keyword">new</span> <span class="title class_">ViewModelProvider</span>(<span class="built_in">this</span>).get(HomeViewModel.class);</span><br><span class="line">    <span class="type">View</span> <span class="variable">root</span> <span class="operator">=</span> inflater.inflate(R.layout.fragment_home, container, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    tabLayout = root.findViewById(R.id.tabs);</span><br><span class="line">    viewPager2 = root.findViewById(R.id.viewPager);</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onViewCreated</span><span class="params">(<span class="meta">@NonNull</span> View view, <span class="meta">@Nullable</span> Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onViewCreated(view, savedInstanceState);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化 tabTitles 和 fragments</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">15</span>; i++) &#123;</span><br><span class="line">      tabTitles.add(String.valueOf(i));</span><br><span class="line">      fragments.add(BlankFragment.newInstance(tabTitles.get(i)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭预加载</span></span><br><span class="line">    viewPager2.setOffscreenPageLimit(ViewPager2.OFFSCREEN_PAGE_LIMIT_DEFAULT);  <span class="comment">// 可以不设置 因为默认是 -1 默认不进行预加载</span></span><br><span class="line">    <span class="comment">// 这个必须设置 不然仍然会启用预加载</span></span><br><span class="line">    ((RecyclerView)viewPager2.getChildAt(<span class="number">0</span>)).getLayoutManager().setItemPrefetchEnabled(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// 设置缓存数量，对应 RecyclerView 中的 mCachedViews，即屏幕外的视图数量</span></span><br><span class="line">    ((RecyclerView)viewPager2.getChildAt(<span class="number">0</span>)).setItemViewCacheSize(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第一种方法 (可能会内存泄漏)</span></span><br><span class="line">    <span class="comment">//FragmentAdapter adapter = new FragmentAdapter(this, fragments);</span></span><br><span class="line">    <span class="comment">//viewPager2.setAdapter(adapter);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这里使用第二种方法</span></span><br><span class="line">    viewPager2.setAdapter(<span class="keyword">new</span> <span class="title class_">FragmentStateAdapter</span>(<span class="built_in">this</span>) &#123;</span><br><span class="line">      <span class="meta">@NonNull</span></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> Fragment <span class="title function_">createFragment</span><span class="params">(<span class="type">int</span> position)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> BlankFragment.newInstance(tabTitles.get(position));</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getItemCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tabTitles.size();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// viewPager2 滑动监听</span></span><br><span class="line">    viewPager2.registerOnPageChangeCallback(<span class="keyword">new</span> <span class="title class_">ViewPager2</span>.OnPageChangeCallback() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPageSelected</span><span class="params">(<span class="type">int</span> position)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onPageSelected(position);</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这里第四个参数一定要设置为false  如果设置为true时 我们在滑动时 BlankFragment的创建 和 销毁 都很正常</span></span><br><span class="line">    <span class="comment">// 一旦 我们通过 点击tabLayout时 如果两个tab距离过远  那么所有划过的tabLayout 都会创建和销毁BlankFragment 这显然不是我们想要的</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// tabLayout 和 viewPager 联动</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">TabLayoutMediator</span>(tabLayout, viewPager2,<span class="literal">true</span>,<span class="literal">false</span>, <span class="keyword">new</span> <span class="title class_">TabLayoutMediator</span>.TabConfigurationStrategy() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onConfigureTab</span><span class="params">(<span class="meta">@NonNull</span> TabLayout.Tab tab, <span class="type">int</span> position)</span> &#123;</span><br><span class="line">        tab.setText(tabTitles.get(position));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;).attach();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>fragment_home.xml</code> 布局文件:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">tools:context</span>=<span class="string">&quot;.ui.home.HomeFragment&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">com.google.android.material.tabs.TabLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/tabs&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;40dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:tabGravity</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:tabIndicatorColor</span>=<span class="string">&quot;#ff678f&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:tabIndicatorFullWidth</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:tabIndicatorHeight</span>=<span class="string">&quot;2dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:tabMode</span>=<span class="string">&quot;scrollable&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:tabSelectedTextColor</span>=<span class="string">&quot;#ff678f&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:tabTextColor</span>=<span class="string">&quot;#333333&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:tabUnboundedRipple</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">androidx.viewpager2.widget.ViewPager2</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/viewPager&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">&quot;@color/purple_200&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_weight</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、viewPager2的 FragmentStateAdapter 创建fragment时 我们 复用一个fragment</p>
<p><code>BlankFragment</code> 如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlankFragment</span> <span class="keyword">extends</span> <span class="title class_">Fragment</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> String mParam1;</span><br><span class="line">  <span class="keyword">private</span> TextView mTextView;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> BlankFragment <span class="title function_">newInstance</span><span class="params">(String param1)</span> &#123;</span><br><span class="line">    <span class="type">BlankFragment</span> <span class="variable">fragment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BlankFragment</span>();</span><br><span class="line">    <span class="type">Bundle</span> <span class="variable">args</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bundle</span>();</span><br><span class="line">    args.putString(<span class="string">&quot;param1&quot;</span>, param1);</span><br><span class="line">    fragment.setArguments(args);</span><br><span class="line">    <span class="keyword">return</span> fragment;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPause</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onPause();</span><br><span class="line">    Log.i(<span class="string">&quot;TAG=======onPause&quot;</span>, mParam1);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    <span class="keyword">if</span> (getArguments() != <span class="literal">null</span>) &#123;</span><br><span class="line">      mParam1 = getArguments().getString(<span class="string">&quot;param1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Log.i(<span class="string">&quot;TAG=======onCreate&quot;</span>, mParam1);</span><br><span class="line">    Toast.makeText(getContext(), mParam1, Toast.LENGTH_SHORT).show();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDestroy</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onDestroy();</span><br><span class="line">    Log.i(<span class="string">&quot;TAG=======onDestroy&quot;</span>, mParam1);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> View <span class="title function_">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    <span class="comment">// Inflate the layout for this fragment</span></span><br><span class="line">    <span class="type">View</span> <span class="variable">root</span> <span class="operator">=</span> inflater.inflate(R.layout.fragment_blank, container, <span class="literal">false</span>);</span><br><span class="line">    mTextView = root.findViewById(R.id.text1);</span><br><span class="line">    mTextView.setText(mParam1);</span><br><span class="line">    Log.i(<span class="string">&quot;TAG=======onCreateView&quot;</span>, mParam1);</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 对外提供一个刷新Ui的方法</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">refreshUi</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (getArguments() != <span class="literal">null</span>) &#123;</span><br><span class="line">      mParam1 = getArguments().getString(<span class="string">&quot;param1&quot;</span>);</span><br><span class="line">      mTextView.setText(mParam1 + <span class="string">&quot;ddd&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDestroyView</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onDestroyView();</span><br><span class="line">    Log.i(<span class="string">&quot;TAG======onDestroyView&quot;</span>, mParam1);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>fragment_blank.xml</code> 如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:gravity</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">tools:context</span>=<span class="string">&quot;.ui.BlankFragment&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/text1&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:textSize</span>=<span class="string">&quot;26sp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:text</span>=<span class="string">&quot;black&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>至此 我们已经完成了 tabLayout + viewPager2 + fragment </p>
<h3 id="viewPager2常用方法"><a href="#viewPager2常用方法" class="headerlink" title="viewPager2常用方法"></a>viewPager2常用方法</h3><ul>
<li><code>setAdapter()</code> 设置适配器</li>
<li><code>setOrientation()</code> 设置布局方向</li>
<li><code>setCurrentItem()</code> 设置当前Item下标</li>
<li><code>beginFakeDrag()</code> 开始模拟拖拽</li>
<li><code>fakeDragBy()</code> 模拟拖拽中</li>
<li><code>endFakeDrag()</code> 模拟拖拽结束</li>
<li><code>setUserInputEnabled()</code> 设置是否允许用户输入&#x2F;触摸</li>
<li><code>setOffscreenPageLimit()</code> 设置屏幕外加载页面数量</li>
<li><code>registerOnPageChangeCallback()</code> 注册页面滑动监听回调</li>
<li><code>setPageTransformer()</code> 设置页面滑动时的变换效果</li>
</ul>
<h3 id="ViewPager2-预加载和缓存"><a href="#ViewPager2-预加载和缓存" class="headerlink" title="ViewPager2 预加载和缓存"></a>ViewPager2 预加载和缓存</h3><p><code>viewPager2</code> 是存在预加载和缓存的 我们虽然可以通过<code>offscreenPageLimit</code> 去设置预加载的数量 但是 <code>viewPager2</code> 会默认帮我们<br>缓存两个<code>fragment</code> 意思就是我们再滑动回来时 不会再去走 fragment 创建的生命周期了 会走 onResume 生命周期函数</p>
<p><code>one picture is worth a thousand words</code> :</p>
<p><code>viewPager2</code> 默认开启预加载 </p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210625182426.png"></p>
<p><strong>如何关闭预加载、并设置缓存数量</strong></p>
<p><strong>常见设置如下</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//设置应保留在当前可见页面两侧的页面数</span></span><br><span class="line">viewPager2.setOffscreenPageLimit(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//关闭预加载</span></span><br><span class="line">((RecyclerView)viewPager2.getChildAt(<span class="number">0</span>)).getLayoutManager().setItemPrefetchEnabled(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置缓存数量，对应 RecyclerView 中的 mCachedViews，即屏幕外的视图数量</span></span><br><span class="line">((RecyclerView)viewPager2.getChildAt(<span class="number">0</span>)).setItemViewCacheSize(<span class="number">4</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>viewPager2</code> 会默认缓存2个<code>ItemView</code></p>
<p>我们将<code>((RecyclerView)viewPager2.getChildAt(0)).setItemViewCacheSize(0);</code> 设置为<code>0</code>即可 这样我们每次滑动一个新的<code>tab</code>时 会创建<br>新的<code>fragment</code>并销毁上一个<code>fragment</code></p>
<h3 id="viewPager2-对-fragment-的支持"><a href="#viewPager2-对-fragment-的支持" class="headerlink" title="viewPager2 对 fragment 的支持"></a>viewPager2 对 fragment 的支持</h3><p>目前，<code>ViewPager2</code>对<code>Fragment</code>的支持只能使用<code>FragmentStateAdapter</code>，使用起来也是非常简单：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">viewPager2.setAdapter(<span class="keyword">new</span> <span class="title class_">FragmentStateAdapter</span>(<span class="built_in">this</span>) &#123;</span><br><span class="line">  <span class="meta">@NonNull</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Fragment <span class="title function_">createFragment</span><span class="params">(<span class="type">int</span> position)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> BlankFragment.newInstance(tabTitles.get(position));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getItemCount</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> tabTitles.size();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="另外还有一个小坑"><a href="#另外还有一个小坑" class="headerlink" title="另外还有一个小坑"></a>另外还有一个小坑</h3><p><strong>ViewPager2+TabLayout懒加载问题，Fragment被创建多次</strong></p>
<p><code>ViewPager2</code>默认只加载当前页面，相当于官方处理了<code>Fragment</code>的懒加载问题，当你使用代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">new TabLayoutMediator(tabLayout, viewPager, true, new TabLayoutMediator.TabConfigurationStrategy() &#123;</span><br><span class="line"></span><br><span class="line">       @Override</span><br><span class="line"></span><br><span class="line">       public void onConfigureTab(@NonNull TabLayout.Tab tab, int position) &#123;</span><br><span class="line"></span><br><span class="line">           tab.setText(titles.get(position));</span><br><span class="line"></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">&#125;).attach();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>此时当你滑动<code>ViewPager2</code>时，滑动到某个<code>Fragment</code>页面才会加载，执行onCreateView()方法，</p>
<p>但是当你手动点击<code>TabLayout</code>时，此时懒加载就会失效，<code>onCreateView()</code>会被执行多次，</p>
<p>原因就是…此时<code>ViewPager2</code>默认是平滑滚动的，滚动滑过的<code>Fragment</code>都会被加载，</p>
<p><strong>只需修改代码:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">TabLayoutMediator</span>(tabLayout, viewPager, <span class="literal">true</span>,<span class="literal">false</span>, <span class="keyword">new</span> <span class="title class_">TabLayoutMediator</span>.TabConfigurationStrategy() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onConfigureTab</span><span class="params">(<span class="meta">@NonNull</span> TabLayout.Tab tab, <span class="type">int</span> position)</span> &#123;</span><br><span class="line"></span><br><span class="line">                tab.setText(titles.get(position));</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">&#125;).attach();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其中，第二个<code>boolean</code>参数为<code>smoothScroll</code> 一定要填<code>false</code>  这时点击 哪个<code>tab</code> 就会创建 哪个 <code>fragment</code></p>
<p>但是页面看起来没有那么平滑了 各有利弊吧</p>
<p><strong>—————————————————————————————</strong></p>
<p>如果 需要点击tab无动画 滑动页面时有动画 怎么办呢?</p>
<p>TabLayoutMediator 是final类  且smoothScroll字段是私有的、我们没法继承重写、但是可以copy源码修改、不会有问题</p>
<p>我们将 源码copy下来 稍作修改就可以用了 下面是修改好的代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> androidx.viewpager2.widget.ViewPager2.SCROLL_STATE_DRAGGING;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> androidx.viewpager2.widget.ViewPager2.SCROLL_STATE_IDLE;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> androidx.viewpager2.widget.ViewPager2.SCROLL_STATE_SETTLING;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.annotation.NonNull;</span><br><span class="line"><span class="keyword">import</span> androidx.annotation.Nullable;</span><br><span class="line"><span class="keyword">import</span> androidx.recyclerview.widget.RecyclerView;</span><br><span class="line"><span class="keyword">import</span> androidx.viewpager2.widget.ViewPager2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.android.material.tabs.TabLayout;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.ref.WeakReference;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A mediator to link a TabLayout with a ViewPager2. The mediator will synchronize the ViewPager2&#x27;s</span></span><br><span class="line"><span class="comment"> * position with the selected tab when a tab is selected, and the TabLayout&#x27;s scroll position when</span></span><br><span class="line"><span class="comment"> * the user drags the ViewPager2. TabLayoutMediator will listen to ViewPager2&#x27;s OnPageChangeCallback</span></span><br><span class="line"><span class="comment"> * to adjust tab when ViewPager2 moves. TabLayoutMediator listens to TabLayout&#x27;s</span></span><br><span class="line"><span class="comment"> * OnTabSelectedListener to adjust VP2 when tab moves. TabLayoutMediator listens to RecyclerView&#x27;s</span></span><br><span class="line"><span class="comment"> * AdapterDataObserver to recreate tab content when dataset changes.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Establish the link by creating an instance of this class, make sure the ViewPager2 has an</span></span><br><span class="line"><span class="comment"> * adapter and then call &#123;<span class="doctag">@link</span> #attach()&#125; on it. Instantiating a TabLayoutMediator will only create</span></span><br><span class="line"><span class="comment"> * the mediator object, &#123;<span class="doctag">@link</span> #attach()&#125; will link the TabLayout and the ViewPager2 together. When</span></span><br><span class="line"><span class="comment"> * creating an instance of this class, you must supply an implementation of &#123;<span class="doctag">@link</span></span></span><br><span class="line"><span class="comment"> * com.google.android.material.tabs.TabLayoutMediator.TabConfigurationStrategy&#125; in which you set the text of the tab, and/or perform any styling of the</span></span><br><span class="line"><span class="comment"> * tabs that you require. Changing ViewPager2&#x27;s adapter will require a &#123;<span class="doctag">@link</span> #detach()&#125; followed by</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> #attach()&#125; call. Changing the ViewPager2 or TabLayout will require a new instantiation of</span></span><br><span class="line"><span class="comment"> * TabLayoutMediator.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">TabLayoutMediators</span> &#123;</span><br><span class="line">  <span class="meta">@NonNull</span> <span class="keyword">private</span> <span class="keyword">final</span> TabLayout tabLayout;</span><br><span class="line">  <span class="meta">@NonNull</span> <span class="keyword">private</span> <span class="keyword">final</span> ViewPager2 viewPager;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">boolean</span> autoRefresh;</span><br><span class="line">  <span class="comment">// 这里我们改为静态变量 以便于在静态方法中使用这个变量</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> smoothScroll;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> TabConfigurationStrategy tabConfigurationStrategy;</span><br><span class="line">  <span class="meta">@Nullable</span> <span class="keyword">private</span> RecyclerView.Adapter&lt;?&gt; adapter;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">boolean</span> attached;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Nullable</span> <span class="keyword">private</span> TabLayoutOnPageChangeCallback onPageChangeCallback;</span><br><span class="line">  <span class="meta">@Nullable</span> <span class="keyword">private</span> TabLayout.OnTabSelectedListener onTabSelectedListener;</span><br><span class="line">  <span class="meta">@Nullable</span> <span class="keyword">private</span> RecyclerView.AdapterDataObserver pagerAdapterObserver;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * A callback interface that must be implemented to set the text and styling of newly created</span></span><br><span class="line"><span class="comment">   * tabs.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TabConfigurationStrategy</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Called to configure the tab for the page at the specified position. Typically calls &#123;<span class="doctag">@link</span></span></span><br><span class="line"><span class="comment">     * TabLayout.Tab#setText(CharSequence)&#125;, but any form of styling can be applied.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tab The Tab which should be configured to represent the title of the item at the given</span></span><br><span class="line"><span class="comment">     *     position in the data set.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> position The position of the item within the adapter&#x27;s data set.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onConfigureTab</span><span class="params">(<span class="meta">@NonNull</span> TabLayout.Tab tab, <span class="type">int</span> position)</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">TabLayoutMediators</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="meta">@NonNull</span> TabLayout tabLayout,</span></span><br><span class="line"><span class="params">    <span class="meta">@NonNull</span> ViewPager2 viewPager,</span></span><br><span class="line"><span class="params">    <span class="meta">@NonNull</span> TabConfigurationStrategy tabConfigurationStrategy)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>(tabLayout, viewPager, <span class="comment">/* autoRefresh= */</span> <span class="literal">true</span>, tabConfigurationStrategy);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">TabLayoutMediators</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="meta">@NonNull</span> TabLayout tabLayout,</span></span><br><span class="line"><span class="params">    <span class="meta">@NonNull</span> ViewPager2 viewPager,</span></span><br><span class="line"><span class="params">    <span class="type">boolean</span> autoRefresh,</span></span><br><span class="line"><span class="params">    <span class="meta">@NonNull</span> TabConfigurationStrategy tabConfigurationStrategy)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>(tabLayout, viewPager, autoRefresh, <span class="comment">/* smoothScroll= */</span> <span class="literal">true</span>, tabConfigurationStrategy);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">TabLayoutMediators</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="meta">@NonNull</span> TabLayout tabLayout,</span></span><br><span class="line"><span class="params">    <span class="meta">@NonNull</span> ViewPager2 viewPager,</span></span><br><span class="line"><span class="params">    <span class="type">boolean</span> autoRefresh,</span></span><br><span class="line"><span class="params">    <span class="type">boolean</span> smoothScroll,</span></span><br><span class="line"><span class="params">    <span class="meta">@NonNull</span> TabConfigurationStrategy tabConfigurationStrategy)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.tabLayout = tabLayout;</span><br><span class="line">    <span class="built_in">this</span>.viewPager = viewPager;</span><br><span class="line">    <span class="built_in">this</span>.autoRefresh = autoRefresh;</span><br><span class="line">    TabLayoutMediators.smoothScroll = smoothScroll;</span><br><span class="line">    <span class="built_in">this</span>.tabConfigurationStrategy = tabConfigurationStrategy;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Link the TabLayout and the ViewPager2 together. Must be called after ViewPager2 has an adapter</span></span><br><span class="line"><span class="comment">   * set. To be called on a new instance of TabLayoutMediator or if the ViewPager2&#x27;s adapter</span></span><br><span class="line"><span class="comment">   * changes.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@throws</span> IllegalStateException If the mediator is already attached, or the ViewPager2 has no</span></span><br><span class="line"><span class="comment">   *     adapter.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">attach</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (attached) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;TabLayoutMediator is already attached&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    adapter = viewPager.getAdapter();</span><br><span class="line">    <span class="keyword">if</span> (adapter == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(</span><br><span class="line">        <span class="string">&quot;TabLayoutMediator attached before ViewPager2 has an &quot;</span> + <span class="string">&quot;adapter&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    attached = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add our custom OnPageChangeCallback to the ViewPager</span></span><br><span class="line">    onPageChangeCallback = <span class="keyword">new</span> <span class="title class_">TabLayoutOnPageChangeCallback</span>(tabLayout);</span><br><span class="line">    viewPager.registerOnPageChangeCallback(onPageChangeCallback);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Now we&#x27;ll add a tab selected listener to set ViewPager&#x27;s current item</span></span><br><span class="line">    onTabSelectedListener = <span class="keyword">new</span> <span class="title class_">ViewPagerOnTabSelectedListener</span>(viewPager, smoothScroll);</span><br><span class="line">    tabLayout.addOnTabSelectedListener(onTabSelectedListener);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Now we&#x27;ll populate ourselves from the pager adapter, adding an observer if</span></span><br><span class="line">    <span class="comment">// autoRefresh is enabled</span></span><br><span class="line">    <span class="keyword">if</span> (autoRefresh) &#123;</span><br><span class="line">      <span class="comment">// Register our observer on the new adapter</span></span><br><span class="line">      pagerAdapterObserver = <span class="keyword">new</span> <span class="title class_">PagerAdapterObserver</span>();</span><br><span class="line">      adapter.registerAdapterDataObserver(pagerAdapterObserver);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    populateTabsFromPagerAdapter();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Now update the scroll position to match the ViewPager&#x27;s current item</span></span><br><span class="line">    tabLayout.setScrollPosition(viewPager.getCurrentItem(), <span class="number">0f</span>, <span class="literal">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Unlink the TabLayout and the ViewPager. To be called on a stale TabLayoutMediator if a new one</span></span><br><span class="line"><span class="comment">   * is instantiated, to prevent holding on to a view that should be garbage collected. Also to be</span></span><br><span class="line"><span class="comment">   * called before &#123;<span class="doctag">@link</span> #attach()&#125; when a ViewPager2&#x27;s adapter is changed.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">detach</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (autoRefresh &amp;&amp; adapter != <span class="literal">null</span>) &#123;</span><br><span class="line">      adapter.unregisterAdapterDataObserver(pagerAdapterObserver);</span><br><span class="line">      pagerAdapterObserver = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    tabLayout.removeOnTabSelectedListener(onTabSelectedListener);</span><br><span class="line">    viewPager.unregisterOnPageChangeCallback(onPageChangeCallback);</span><br><span class="line">    onTabSelectedListener = <span class="literal">null</span>;</span><br><span class="line">    onPageChangeCallback = <span class="literal">null</span>;</span><br><span class="line">    adapter = <span class="literal">null</span>;</span><br><span class="line">    attached = <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SuppressWarnings(&quot;WeakerAccess&quot;)</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">populateTabsFromPagerAdapter</span><span class="params">()</span> &#123;</span><br><span class="line">    tabLayout.removeAllTabs();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (adapter != <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="type">int</span> <span class="variable">adapterCount</span> <span class="operator">=</span> adapter.getItemCount();</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; adapterCount; i++) &#123;</span><br><span class="line">        TabLayout.<span class="type">Tab</span> <span class="variable">tab</span> <span class="operator">=</span> tabLayout.newTab();</span><br><span class="line">        tabConfigurationStrategy.onConfigureTab(tab, i);</span><br><span class="line">        tabLayout.addTab(tab, <span class="literal">false</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// Make sure we reflect the currently set ViewPager item</span></span><br><span class="line">      <span class="keyword">if</span> (adapterCount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">lastItem</span> <span class="operator">=</span> tabLayout.getTabCount() - <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">currItem</span> <span class="operator">=</span> Math.min(viewPager.getCurrentItem(), lastItem);</span><br><span class="line">        <span class="keyword">if</span> (currItem != tabLayout.getSelectedTabPosition()) &#123;</span><br><span class="line">          tabLayout.selectTab(tabLayout.getTabAt(currItem));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * A &#123;<span class="doctag">@link</span> ViewPager2.OnPageChangeCallback&#125; class which contains the necessary calls back to the</span></span><br><span class="line"><span class="comment">   * provided &#123;<span class="doctag">@link</span> TabLayout&#125; so that the tab position is kept in sync.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * &lt;p&gt;This class stores the provided TabLayout weakly, meaning that you can use &#123;<span class="doctag">@link</span></span></span><br><span class="line"><span class="comment">   * ViewPager2#registerOnPageChangeCallback(ViewPager2.OnPageChangeCallback)&#125; without removing the</span></span><br><span class="line"><span class="comment">   * callback and not cause a leak.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">TabLayoutOnPageChangeCallback</span> <span class="keyword">extends</span> <span class="title class_">ViewPager2</span>.OnPageChangeCallback &#123;</span><br><span class="line">    <span class="meta">@NonNull</span> <span class="keyword">private</span> <span class="keyword">final</span> WeakReference&lt;TabLayout&gt; tabLayoutRef;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> previousScrollState;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> scrollState;</span><br><span class="line"></span><br><span class="line">    TabLayoutOnPageChangeCallback(TabLayout tabLayout) &#123;</span><br><span class="line">      tabLayoutRef = <span class="keyword">new</span> <span class="title class_">WeakReference</span>&lt;&gt;(tabLayout);</span><br><span class="line">      reset();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPageScrollStateChanged</span><span class="params">(<span class="keyword">final</span> <span class="type">int</span> state)</span> &#123;</span><br><span class="line">      <span class="comment">// 根据 是滑动的viewPager还是 点击的 tab 去设置 是否需要平滑动画</span></span><br><span class="line">      <span class="keyword">if</span> (state == SCROLL_STATE_DRAGGING) &#123;</span><br><span class="line">        <span class="comment">// 如果是滑动就设置平滑动画</span></span><br><span class="line">        smoothScroll = <span class="literal">true</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == SCROLL_STATE_IDLE) &#123;</span><br><span class="line">        <span class="comment">// 点击的tab就不设置平滑动画</span></span><br><span class="line">        smoothScroll = <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      previousScrollState = scrollState;</span><br><span class="line">      scrollState = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPageScrolled</span><span class="params">(<span class="type">int</span> position, <span class="type">float</span> positionOffset, <span class="type">int</span> positionOffsetPixels)</span> &#123;</span><br><span class="line">      <span class="type">TabLayout</span> <span class="variable">tabLayout</span> <span class="operator">=</span> tabLayoutRef.get();</span><br><span class="line">      <span class="keyword">if</span> (tabLayout != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// Only update the text selection if we&#x27;re not settling, or we are settling after</span></span><br><span class="line">        <span class="comment">// being dragged</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">updateText</span> <span class="operator">=</span></span><br><span class="line">          scrollState != SCROLL_STATE_SETTLING || previousScrollState == SCROLL_STATE_DRAGGING;</span><br><span class="line">        <span class="comment">// Update the indicator if we&#x27;re not settling after being idle. This is caused</span></span><br><span class="line">        <span class="comment">// from a setCurrentItem() call and will be handled by an animation from</span></span><br><span class="line">        <span class="comment">// onPageSelected() instead.</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">updateIndicator</span> <span class="operator">=</span></span><br><span class="line">          !(scrollState == SCROLL_STATE_SETTLING &amp;&amp; previousScrollState == SCROLL_STATE_IDLE);</span><br><span class="line">        tabLayout.setScrollPosition(position, positionOffset, updateText, updateIndicator);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPageSelected</span><span class="params">(<span class="keyword">final</span> <span class="type">int</span> position)</span> &#123;</span><br><span class="line">      <span class="type">TabLayout</span> <span class="variable">tabLayout</span> <span class="operator">=</span> tabLayoutRef.get();</span><br><span class="line">      <span class="keyword">if</span> (tabLayout != <span class="literal">null</span></span><br><span class="line">        &amp;&amp; tabLayout.getSelectedTabPosition() != position</span><br><span class="line">        &amp;&amp; position &lt; tabLayout.getTabCount()) &#123;</span><br><span class="line">        <span class="comment">// Select the tab, only updating the indicator if we&#x27;re not being dragged/settled</span></span><br><span class="line">        <span class="comment">// (since onPageScrolled will handle that).</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">updateIndicator</span> <span class="operator">=</span></span><br><span class="line">          scrollState == SCROLL_STATE_IDLE</span><br><span class="line">            || (scrollState == SCROLL_STATE_SETTLING</span><br><span class="line">            &amp;&amp; previousScrollState == SCROLL_STATE_IDLE);</span><br><span class="line">        tabLayout.selectTab(tabLayout.getTabAt(position), updateIndicator);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">reset</span><span class="params">()</span> &#123;</span><br><span class="line">      previousScrollState = scrollState = SCROLL_STATE_IDLE;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * A &#123;<span class="doctag">@link</span> TabLayout.OnTabSelectedListener&#125; class which contains the necessary calls back to the</span></span><br><span class="line"><span class="comment">   * provided &#123;<span class="doctag">@link</span> ViewPager2&#125; so that the tab position is kept in sync.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ViewPagerOnTabSelectedListener</span> <span class="keyword">implements</span> <span class="title class_">TabLayout</span>.OnTabSelectedListener &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ViewPager2 viewPager;</span><br><span class="line">    <span class="comment">// 注释掉这个局部变量 使用最上边的那个全局变量</span></span><br><span class="line">    <span class="comment">//private final boolean smoothScroll;</span></span><br><span class="line"></span><br><span class="line">    ViewPagerOnTabSelectedListener(ViewPager2 viewPager, <span class="type">boolean</span> smoothScroll) &#123;</span><br><span class="line">      <span class="built_in">this</span>.viewPager = viewPager;</span><br><span class="line">      <span class="comment">// 这一行也注释掉</span></span><br><span class="line">      <span class="comment">//this.smoothScroll = smoothScroll;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onTabSelected</span><span class="params">(<span class="meta">@NonNull</span> TabLayout.Tab tab)</span> &#123;</span><br><span class="line">      viewPager.setCurrentItem(tab.getPosition(), smoothScroll);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onTabUnselected</span><span class="params">(TabLayout.Tab tab)</span> &#123;</span><br><span class="line">      <span class="comment">// No-op</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onTabReselected</span><span class="params">(TabLayout.Tab tab)</span> &#123;</span><br><span class="line">      <span class="comment">// No-op</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">PagerAdapterObserver</span> <span class="keyword">extends</span> <span class="title class_">RecyclerView</span>.AdapterDataObserver &#123;</span><br><span class="line">    PagerAdapterObserver() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onChanged</span><span class="params">()</span> &#123;</span><br><span class="line">      populateTabsFromPagerAdapter();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onItemRangeChanged</span><span class="params">(<span class="type">int</span> positionStart, <span class="type">int</span> itemCount)</span> &#123;</span><br><span class="line">      populateTabsFromPagerAdapter();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onItemRangeChanged</span><span class="params">(<span class="type">int</span> positionStart, <span class="type">int</span> itemCount, <span class="meta">@Nullable</span> Object payload)</span> &#123;</span><br><span class="line">      populateTabsFromPagerAdapter();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onItemRangeInserted</span><span class="params">(<span class="type">int</span> positionStart, <span class="type">int</span> itemCount)</span> &#123;</span><br><span class="line">      populateTabsFromPagerAdapter();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onItemRangeRemoved</span><span class="params">(<span class="type">int</span> positionStart, <span class="type">int</span> itemCount)</span> &#123;</span><br><span class="line">      populateTabsFromPagerAdapter();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onItemRangeMoved</span><span class="params">(<span class="type">int</span> fromPosition, <span class="type">int</span> toPosition, <span class="type">int</span> itemCount)</span> &#123;</span><br><span class="line">      populateTabsFromPagerAdapter();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>具体用法为:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">TabLayoutMediators</span>(tabLayout, viewPager2, <span class="keyword">new</span> <span class="title class_">TabLayoutMediators</span>.TabConfigurationStrategy() &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onConfigureTab</span><span class="params">(<span class="meta">@NonNull</span> TabLayout.Tab tab, <span class="type">int</span> position)</span> &#123;</span><br><span class="line">    tab.setText(tabTitles.get(position));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).attach();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>和官方的用法一样 没啥差别</p>
<p><strong>—————————————————————————————</strong></p>
<p>如果即要求点击tab有动画 滑动页面也有动画 可以看下面这个 我们摒弃官方的 TabLayoutMediator 联动方法</p>
<p>我们自己来手动 让 tabLayout 和 viewPager2 联动起来</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">firstMethod</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置 tabLayout 标题</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; tabTitles.size(); i++) &#123;</span><br><span class="line">      tabLayout.addTab(tabLayout.newTab().setText(tabTitles.get(i)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 监听tabLayout事件 设置选中的viewPager2</span></span><br><span class="line">    tabLayout.addOnTabSelectedListener(<span class="keyword">new</span> <span class="title class_">TabLayout</span>.OnTabSelectedListener() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onTabSelected</span><span class="params">(TabLayout.Tab tab)</span> &#123;</span><br><span class="line">        viewPager2.setCurrentItem(tab.getPosition(), <span class="literal">false</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onTabUnselected</span><span class="params">(TabLayout.Tab tab)</span> &#123;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onTabReselected</span><span class="params">(TabLayout.Tab tab)</span> &#123;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// viewPager2 滑动监听 设置tab选中</span></span><br><span class="line">    viewPager2.registerOnPageChangeCallback(<span class="keyword">new</span> <span class="title class_">ViewPager2</span>.OnPageChangeCallback() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPageSelected</span><span class="params">(<span class="type">int</span> position)</span> &#123;</span><br><span class="line">        tabLayout.selectTab(tabLayout.getTabAt(position));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>viewPager2的优点还是有目共睹的, 但是还是要去踩坑啊，我之前也是用<code>viewPager2</code> 但是没用对的话是会产生内存泄露的<br>所以就研究了一下 在这里记录一下问题 参考了很多博客 基本上都不咋解决问题</p>
<p>只有下面这四篇有帮助 感谢!!!</p>
<p>第一篇、 <a target="_blank" rel="noopener" href="https://hitendev.github.io/2019/05/14/ViewPager2%E9%87%8D%E5%A4%A7%E6%9B%B4%E6%96%B0%EF%BC%8C%E6%94%AF%E6%8C%81offscreenPageLimit/">ViewPager2重大更新</a></p>
<p>第二篇、 <a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904114124652558#heading-9">ViewPager2主要功能</a></p>
<p>第三篇、 <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/2cc7bdd50c6c">解决ViewPager2+TabLayout懒加载问题，Fragment被创建多次</a></p>
<p>第四篇、<a target="_blank" rel="noopener" href="https://blog.csdn.net/BirdEatBug/article/details/117414954">android ViewPager2+TabLayout、滑动效果相关问题！</a></p>
<p><strong>另外</strong></p>
<p>LeakCanary –&gt; <a target="_blank" rel="noopener" href="https://square.github.io/leakcanary/getting_started/">内存泄漏检测工具</a></p>
<p>使用非常简单 </p>
<p>只需要 在build.gradle 中 添加这么一行就可以了 只会在debug模式下检测 不会影响到 正式环境</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">  // debugImplementation because LeakCanary should only run in debug builds.</span><br><span class="line">  debugImplementation &#x27;com.squareup.leakcanary:leakcanary-android:2.7&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

	
	</div>
  <a type="button" href="/2021/06/25/Android-tablayout-viewpager2-fragment-你可能用错了/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/06/22/Android-中的单例模式/" >Android 中的单例模式</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-06-22  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h3 id="Android-中的单例模式"><a href="#Android-中的单例模式" class="headerlink" title="Android 中的单例模式"></a>Android 中的单例模式</h3><h4 id="单例模式的优缺点"><a href="#单例模式的优缺点" class="headerlink" title="单例模式的优缺点"></a>单例模式的优缺点</h4><p>1、主要优点:</p>
<ul>
<li>提供了对唯一实例的受控访问。</li>
<li>由于在系统内存中只存在一个对象，因此可以节约系统资源，对于一些需要频繁创建和销毁的对象单例模式无疑可以提高系统的性能。</li>
<li>允许可变数目的实例</li>
</ul>
<p>2、主要缺点:</p>
<ul>
<li>由于单利模式中没有抽象层，因此单例类的扩展有很大的困难。</li>
<li>单例类的职责过重，在一定程度上违背了“单一职责原则”。</li>
<li>滥用单例将带来一些负面问题，如为了节省资源将数据库连接池对象设计为的单例类，可能会导致共享连接池对象的程序过多而出现连接池溢出；如果实例化的对象长时间不被利用，系统会认为是垃圾而被回收，这将导致对象状态的丢失。</li>
</ul>
<h4 id="Java中的几种单例模式"><a href="#Java中的几种单例模式" class="headerlink" title="Java中的几种单例模式"></a>Java中的几种单例模式</h4><blockquote>
<p>懒汉式、 饿汉式、 DCL双重校验模式、 静态内部类单例模式、 枚举单例、 使用容器实现单例模式</p>
</blockquote>
<h4 id="懒汉式-线程不安全"><a href="#懒汉式-线程不安全" class="headerlink" title="懒汉式(线程不安全)"></a>懒汉式(线程不安全)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//懒汉式单例类.在第一次调用的时候实例化自己   </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;  </span><br><span class="line">    <span class="comment">//私有的构造函数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125; </span><br><span class="line">    <span class="comment">//私有的静态变量 </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Singleton</span> <span class="variable">single</span> <span class="operator">=</span> <span class="literal">null</span>;  </span><br><span class="line">    <span class="comment">//暴露的公有静态方法   </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;  </span><br><span class="line">         <span class="keyword">if</span> (single == <span class="literal">null</span>) &#123;    </span><br><span class="line">             single = <span class="keyword">new</span> <span class="title class_">Singleton</span>();  </span><br><span class="line">         &#125;    </span><br><span class="line">        <span class="keyword">return</span> single;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>如果多个线程同时调用 getInstance 方法，可能存在同时判断 instance 变量是否为空的情况，上面的代码中很容易导致重复创建多个实例，这违背了单例模式的目的。</li>
<li>这种方式创建的缺点是存在线程不安全的问题，解决的办法就是使用synchronized 关键字，便是单例模式的第二种写法了。</li>
</ul>
<h4 id="懒汉式-线程安全"><a href="#懒汉式-线程安全" class="headerlink" title="懒汉式(线程安全)"></a>懒汉式(线程安全)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;  </span><br><span class="line">    <span class="comment">//私有的静态变量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;  </span><br><span class="line">    <span class="comment">//私有的构造方法</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span> <span class="params">()</span>&#123;&#125;;</span><br><span class="line">    <span class="comment">//公有的同步静态方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;  </span><br><span class="line">    <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;  </span><br><span class="line">        instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> instance;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>这种单例实现方式的getInstance（）方法中添加了synchronized 关键字，也就是告诉Java（JVM）getInstance是一个同步方法。</li>
<li>同步的意思是当两个并发线程访问同一个类中的这个synchronized同步方法时，一个时间内只能有一个线程得到执行，另一个线程必须等待当前线程执行完才能执行，因此同步方法使得线程安全，保证了单例只有唯一个实例。</li>
<li>缺点也很明显 每次每次调用getInstance（）都进行同步，造成了不必要的同步开销。这种模式一般不建议使用。效率低</li>
</ul>
<h4 id="饿汉式-天生线程安全"><a href="#饿汉式-天生线程安全" class="headerlink" title="饿汉式(天生线程安全)"></a>饿汉式(天生线程安全)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//饿汉式单例类.在类初始化时，已经自行实例化   </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;  </span><br><span class="line">    <span class="comment">//static修饰的静态变量在内存中一旦创建，便永久存在</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Singleton</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton</span>();  </span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span> <span class="params">()</span>&#123;&#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;  </span><br><span class="line">    <span class="keyword">return</span> instance;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>饿汉式的例子一看就懂，不管三七二十一先创建了对象再说，不同的进程通过 getInstance 获取的都是同一个对象，所以是线程安全的。</li>
<li>缺点: 如果某个类创建过程会消耗很多资源，但程序运行中没有调用过 getInstance 方法，那么就存在资源浪费的情况，如果一个系统存在非常多此类情况那么这个系统可能存在性能上的问题。</li>
<li>所以，我们需要的是一种延迟加载的功能。</li>
</ul>
<h4 id="DCL双重校验模式-推荐使用"><a href="#DCL双重校验模式-推荐使用" class="headerlink" title="DCL双重校验模式(推荐使用)"></a>DCL双重校验模式(推荐使用)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton singleton;  <span class="comment">//静态变量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span> <span class="params">()</span>&#123;&#125;  <span class="comment">//私有构造函数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;  </span><br><span class="line">      <span class="keyword">if</span> (singleton == <span class="literal">null</span>) &#123;  <span class="comment">//第一层校验</span></span><br><span class="line">          <span class="keyword">synchronized</span> (Singleton.class) &#123;  </span><br><span class="line">          <span class="keyword">if</span> (singleton == <span class="literal">null</span>) &#123;  <span class="comment">//第二层校验</span></span><br><span class="line">              singleton = <span class="keyword">new</span> <span class="title class_">Singleton</span>();  </span><br><span class="line">          &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">      &#125;  </span><br><span class="line">    <span class="keyword">return</span> singleton;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>这种写法也是用的最多的 增加了效率的同时 也是线程安全的</li>
</ul>
<h4 id="静态内部类-推荐使用"><a href="#静态内部类-推荐使用" class="headerlink" title="静态内部类(推荐使用)"></a>静态内部类(推荐使用)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span> <span class="params">()</span>&#123;&#125; ;<span class="comment">//私有的构造函数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.INSTANCE;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="comment">//定义的静态内部类</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SingletonHolder</span> &#123;  </span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Singleton</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton</span>();  <span class="comment">//创建实例的地方</span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>这种方法也可以做到延迟加载，但是它又不同于饿汉式。</li>
<li>因为只有调用 getInstance 时，SingletonHolder 才会进行初始化。</li>
<li>Android中涉及到图片缓存加载的时候经常会看到一些开源组件有各类 ImageHolder 的代码，原理正是如此。</li>
</ul>
<h4 id="枚举类型"><a href="#枚举类型" class="headerlink" title="枚举类型"></a>枚举类型</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Singleton</span> &#123;  <span class="comment">//enum枚举类</span></span><br><span class="line">    INSTANCE;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">whateverMethod</span><span class="params">()</span> &#123;  </span><br><span class="line"></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>枚举单例模式最大的优点就是写法简单，枚举在java中与普通的类是一样的，不仅能够有字段，还能够有自己的方法，最重要的是默认枚举实例是线程安全的，并且在任何情况下，它都是一个单例。即使是在反序列化的过程，枚举单例也不会重新生成新的实例。</li>
</ul>
<p>我们只需要 Singleton.INSTANCE.whateverMethod() 来访问实例的方法，这比调用getInstance()方法简单多了</p>
<h4 id="容器式"><a href="#容器式" class="headerlink" title="容器式"></a>容器式</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class SingletonManager &#123; </span><br><span class="line">　　private static Map&lt;String, Object&gt; objMap = new HashMap&lt;String,Object&gt;();//使用HashMap作为缓存容器</span><br><span class="line">　　private Singleton() &#123; &#125;</span><br><span class="line">　　public static void registerService(String key, Objectinstance) &#123;</span><br><span class="line">　　　　if (!objMap.containsKey(key) ) &#123;</span><br><span class="line">　　　　　　objMap.put(key, instance) ;//第一次是存入Map</span><br><span class="line">　　　　&#125;</span><br><span class="line">　　&#125;</span><br><span class="line">　　public static ObjectgetService(String key) &#123;</span><br><span class="line">　　　　return objMap.get(key) ;//返回与key相对应的对象</span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>在程序的初始，将多种单例模式注入到一个统一的管理类中，在使用时根据key获取对应类型的对象。</li>
</ul>
<p>总结 推荐使用 DCL 和 静态内部类的方式</p>

	
	</div>
  <a type="button" href="/2021/06/22/Android-中的单例模式/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/06/22/Android-知识总结/" >Android 知识总结</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-06-22  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h3 id="Android-细碎知识总结"><a href="#Android-细碎知识总结" class="headerlink" title="Android 细碎知识总结"></a>Android 细碎知识总结</h3><h5 id="1、implementation、api-的区别"><a href="#1、implementation、api-的区别" class="headerlink" title="1、implementation、api 的区别"></a>1、implementation、api 的区别</h5><blockquote>
<p>android studio 3.0 版本之后 gradle 也升级为了3.x版本</p>
<p>compile已过时，已被 implementation 和api 取代</p>
</blockquote>
<p>那么，他们之间的区别在哪？</p>
<ul>
<li><p>implementation: 只能在内部使用此模块，比如我在一个libiary中使用implementation依赖了gson库，然后我的主项目依赖了libiary，那么，我的主项目就无法访问gson库中的方法。<br>这样的好处是编译速度会加快，推荐使用implementation的方式去依赖，</p>
</li>
<li><p>api: 如果你需要提供给外部访问，那么就使用api依赖即可</p>
</li>
</ul>
<h5 id="2、Android中为什么不推荐使用-Enum-枚举"><a href="#2、Android中为什么不推荐使用-Enum-枚举" class="headerlink" title="2、Android中为什么不推荐使用 Enum (枚举)"></a>2、Android中为什么不推荐使用 Enum (枚举)</h5><p>大家都说 Android 中不应该使用 Enum，而且官方文档上也写出不应该使用 Enum，好那我就不用了，<br>改成 Android 注解。然后这句好就被一传十，十传百，<br>所有人都记住了 “ Android 中不推荐使用枚举，请使用注解代替”。</p>
<p>谣言 绝对的谣言</p>
<p>JakeWharton 关于 Android 中使用枚举的一些建议：</p>
<p>JW 认为 ProGuard 和 R8 会在编译的时候会将琐碎的枚举优化为整型，不存在效率低下的问题，enum 效率低下只是 Android 团队散布的谣言，同时 Kotlin 和 Java 中的 Enum 在编译成字节码之后是一样的。</p>
<p>更多的时候我们不需要过分关心使用 Enum 带来的内存增长，你要记住 Enum 是一个类，它只是占用了作为一个类来说应有的内存。</p>
<p>所以是可以使用的.</p>

	
	</div>
  <a type="button" href="/2021/06/22/Android-知识总结/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/05/19/Android-逆向工程/" >Android 逆向工程</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-05-19  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h3 id="Android-逆向工程"><a href="#Android-逆向工程" class="headerlink" title="Android 逆向工程"></a>Android 逆向工程</h3><h4 id="一、需要的工具"><a href="#一、需要的工具" class="headerlink" title="一、需要的工具"></a>一、需要的工具</h4><p>1、Apktool</p>
<blockquote>
<p>是一款应用在Apk上的逆向工程的工具，它有编译、反编译、签名等功能</p>
</blockquote>
<p>使用HomeBrew安装Apktool </p>
<p><a target="_blank" rel="noopener" href="https://ibotpeaches.github.io/Apktool/install/">这里给出其他安装方式</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~</span><br><span class="line">brew install apktool</span><br></pre></td></tr></table></figure>
<p>安装完以后输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apktool</span><br></pre></td></tr></table></figure>

<p>如果出现 下方的东西 安装成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Apktool v2.5.0 - a tool for reengineering Android apk files</span><br><span class="line">with smali v2.4.0 and baksmali v2.4.0</span><br><span class="line">Copyright 2010 Ryszard Wiśniewski &lt;brut.alll@gmail.com&gt;</span><br><span class="line">Copyright 2010 Connor Tumbleson &lt;connor.tumbleson@gmail.com&gt;</span><br><span class="line"></span><br><span class="line">usage: apktool</span><br><span class="line"> -advance,--advanced   prints advance information.</span><br><span class="line"> -version,--version    prints the version then exits</span><br><span class="line">usage: apktool if|install-framework [options] &lt;framework.apk&gt;</span><br><span class="line"> -p,--frame-path &lt;dir&gt;   Stores framework files into &lt;dir&gt;.</span><br><span class="line"> -t,--tag &lt;tag&gt;          Tag frameworks using &lt;tag&gt;.</span><br><span class="line">usage: apktool d[ecode] [options] &lt;file_apk&gt;</span><br><span class="line"> -f,--force              Force delete destination directory.</span><br><span class="line"> -o,--output &lt;dir&gt;       The name of folder that gets written. Default is apk.out</span><br><span class="line"> -p,--frame-path &lt;dir&gt;   Uses framework files located in &lt;dir&gt;.</span><br><span class="line"> -r,--no-res             Do not decode resources.</span><br><span class="line"> -s,--no-src             Do not decode sources.</span><br><span class="line"> -t,--frame-tag &lt;tag&gt;    Uses framework files tagged by &lt;tag&gt;.</span><br><span class="line">usage: apktool b[uild] [options] &lt;app_path&gt;</span><br><span class="line"> -f,--force-all          Skip changes detection and build all files.</span><br><span class="line"> -o,--output &lt;dir&gt;       The name of apk that gets written. Default is dist/name.apk</span><br><span class="line"> -p,--frame-path &lt;dir&gt;   Uses framework files located in &lt;dir&gt;.</span><br><span class="line"></span><br><span class="line">For additional info, see: https://ibotpeaches.github.io/Apktool/ </span><br><span class="line">For smali/baksmali info, see: https://github.com/JesusFreke/smali</span><br></pre></td></tr></table></figure>

<p>2、dex2jar</p>
<blockquote>
<p>这款工具的作用主要是将dex文件转换成jar文件，转换成jar后我们才好借助JD-GUI来查看反编译dex后的代码</p>
</blockquote>
<p><a href="https://github.com/geilige/dex2jar/releases">下载路径</a></p>
<p>请下载最新的压缩包</p>
<p>下载完后直接解压就行了 后面我们再说用途</p>
<p>3、JD-GUI </p>
<blockquote>
<p>一款Java反编译器GUI，通过它我们能查看到反编译后的dex的代码，通常需要配合dex2jar使用;</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="http://java-decompiler.github.io/">下载路径</a></p>
<p>下载完后解压 进入到文件夹双击图标的时候 如果提示打不开就去  系统偏好设置-&gt; 安全性和隐私 -&gt; 通用 </p>
<p>设置一下允许</p>
<h4 id="二、具体操作"><a href="#二、具体操作" class="headerlink" title="二、具体操作"></a>二、具体操作</h4><p>1、首先我们找到一个apk文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apktool d test.apk</span><br></pre></td></tr></table></figure>

<p>运行完成后，得到一个包含资源文件和代码的文件：</p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210519180706.png"></p>
<h5 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h5><p>此时 dex 文件直接反编译成了 smali 文件，而我们需要的是 .dex 文件。</p>
<p>此时再运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apktool d -s -f test.apk</span><br></pre></td></tr></table></figure>

<blockquote>
<p>-d 反编译 apk 文件</p>
<p>-s 不反编译 dex 文件，而是将其保留</p>
<p>-f 如果目标文件夹存在，则删除后重新反编译</p>
</blockquote>
<p>此时得到这样的文件夹：</p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210519180931.png"></p>
<p>2、将上一步得到的 classes.dex 文件(可能是多个) copy到dex2jar 解压好的目录中 </p>
<p>运行代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh d2j-dex2jar.sh classes.dex</span><br></pre></td></tr></table></figure>

<p>如果提示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d2j-dex2jar.sh: line 36: ./d2j_invoke.sh: Permission denied</span><br></pre></td></tr></table></figure>

<p>执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod +x d2j_invoke.sh</span><br></pre></td></tr></table></figure>

<p>然后在执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh d2j-dex2jar.sh classes.dex</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210519181313.png"></p>
<p>运行成功 会在当前目录下生成对应的 .jar文件</p>
<p>3、 我们打开 可视化工具 jd-gui</p>
<p>将刚才生成的 .jar 文件拖进去 就能看到源码了</p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210519181524.png"></p>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/29370382">参考文章1</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/fengyuzhengfan/article/details/80286704">参考文章2</a></p>

	
	</div>
  <a type="button" href="/2021/05/19/Android-逆向工程/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/04/27/recycleView去掉滑动边界阴影/" >recycleView去掉滑动边界阴影</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-04-27  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h4 id="RecycleView-去掉滑动边界的阴影"><a href="#RecycleView-去掉滑动边界的阴影" class="headerlink" title="RecycleView 去掉滑动边界的阴影"></a>RecycleView 去掉滑动边界的阴影</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;android.support.v7.widget.RecyclerView</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    android:overScrollMode=&quot;never&quot; /&gt;</span><br></pre></td></tr></table></figure>
	
	</div>
  <a type="button" href="/2021/04/27/recycleView去掉滑动边界阴影/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/03/29/Ubuntu权限详解/" >Ubuntu权限详解</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-03-29  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h3 id="Ubuntu权限详解"><a href="#Ubuntu权限详解" class="headerlink" title="Ubuntu权限详解"></a>Ubuntu权限详解</h3><p>在Linux系统中，文件的权限控制着文件的所有操作，比如一个文件的读写权限、执行权限、是否为目录等等。<br>以下操作全部在终端中执行</p>
<p>输入ls -altrh</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">user1@wzjing-win10:/mnt/c/Users/user1$ ls -l</span><br><span class="line">total 458391864</span><br><span class="line">drwxrwxrwx 0 root root       512 May 13 00:51 AppData</span><br><span class="line">drwxrwxrwx 0 root root       512 Apr 25 00:10 CLionProjects</span><br><span class="line">drwxrwxrwx 0 root root       512 May 22 09:32 compile</span><br><span class="line">drwxrwxrwx 0 root root       512 May 28 14:08 Desktop</span><br><span class="line">-rwxrwxrwx 0 root root       512 May 28 14:08 test.apk</span><br></pre></td></tr></table></figure>

<p>每一行的含义分别如下:</p>
<table>
<thead>
<tr>
<th>权限</th>
<th>incode</th>
<th>所属用户</th>
<th>所属用户组</th>
<th>文件大小</th>
<th>修改时间</th>
<th>文件或文件名</th>
</tr>
</thead>
<tbody><tr>
<td>drwxrwxrwx</td>
<td>0</td>
<td>root</td>
<td>root</td>
<td>512</td>
<td>May 13 00:51</td>
<td>AppData</td>
</tr>
</tbody></table>
<p>每一行的第一个字段，如<code>drwxrwxrwx</code>代表了这个文件的权限详情，共分为10位，由 d r w x - 五种标识符组成，</p>
<ul>
<li><code>d</code> 是否为目录</li>
<li><code>r</code> 代表用户是否有读取权限</li>
<li><code>w</code> 代表用户是否有写入权限</li>
<li><code>x</code> 代表用户是否有执行权限</li>
<li><code>-</code> 代表此项为空，也就是没有此项权限的意思</li>
</ul>
<table>
<thead>
<tr>
<th>位置</th>
<th>属性</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>第1位</td>
<td>d</td>
<td>代表是否为文件夹</td>
</tr>
<tr>
<td>第2-4位</td>
<td>rwx</td>
<td>代表所属用户的读 写 执行权限</td>
</tr>
<tr>
<td>第5-7位</td>
<td>rwx</td>
<td>代表所属用户组的读 写 执行权限</td>
</tr>
<tr>
<td>第8-10位</td>
<td>rwx</td>
<td>代表其他用户的读 写 执行权限</td>
</tr>
</tbody></table>
<p>如第一位是<code>d</code>代表是文件夹， 第一位如果是-代表不是文件夹（那不就是文件喽）<br><code>rwx</code>代表有读取、写入、执行权限，如果为<code>-wd</code>代表无读取、有写入、有执行权限<br>好吧，现在来理解这一行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drwxrwxrwx 0 root root       512 May 13 00:51 AppData</span><br></pre></td></tr></table></figure>

<ul>
<li>第1位 <code>d</code> 是文件夹</li>
<li>2-4位 <code>rwx</code> 所属用户root有 读取、写入、执行 三项权限</li>
<li>5-7位 <code>rwx</code> 所属用户组root有 读取、写入、执行 三项权限</li>
<li>8-10位 <code>rwx</code> 其他用户user1有 读取、写入、执行 三项权限</li>
</ul>
<h3 id="使用chmod命令更改文件权限"><a href="#使用chmod命令更改文件权限" class="headerlink" title="使用chmod命令更改文件权限"></a>使用<code>chmod</code>命令更改文件权限</h3><p>语法<code>chmod [权限操作] [文件名]</code><br>你不能把一个文件改成文件夹或者把文件夹改成文件，所以你只能改后9位<br>使用 <code>u g o a</code> 代表要更改的权限群组，</p>
<ul>
<li><code>u</code> [代表所属用户]</li>
<li><code>g</code> [代表所属用户组]</li>
<li><code>o</code> [代表其他用户]</li>
<li><code>a</code> [代表以上所有三个]</li>
<li><code>-</code> [代表删除权限]</li>
<li><code>+</code> [代表增加权限]</li>
<li><code>=</code> [代表将权限设置为]</li>
</ul>
<p><strong>示例</strong>（如果提示你没权限修改的话，就在命令前边增加<code>sudo</code>）</p>
<p><code>chmod u+x test.apk</code> 代表增加所属用户对test.apk的可执行权限</p>
<p><code>chmod a-w AppData</code> 代表删除所有人对AppData这个文件夹的写入权限</p>
<p><code>chmod -w AppData</code> a可以省略，此条命令和上边这条完全相同</p>
<p><strong>也可以一次设置多个权限</strong></p>
<p><code>chmod g+rwx AppData</code> 代表添加所属用户组可读取、可写入、可执行权限</p>
<p><code>chmod g=rwx AppData</code> 代表把所属用户组的权限设置为可读取、可写入、可执行</p>
<p><strong>Tip:</strong>  其实<code>+</code>和<code>=</code>的区别不是很大</p>
<p><strong>有一种更为简便的写法：</strong></p>
<p>Linux系统内部设定： <code>r=4 w=2 x=1 -=0</code></p>
<p><code>r w x</code>任意一种组合的三个值相加的结果都不同</p>
<p>如：</p>
<p>rwx&#x3D;7</p>
<p>-wx&#x3D;3</p>
<p>r-x&#x3D;5</p>
<p>rw-&#x3D;6</p>
<p>所以可以这么写命令：</p>
<p><code>chmod 777 test.apk</code> 设置权限为 -rwxrwxrwx</p>
<p><code>chmod 755 test.apk</code> 设置权限为 -rwxr-xr-x</p>
<p><code>chmod 666 test.apk</code> 设置权限为 -rw-rw-rw-</p>

	
	</div>
  <a type="button" href="/2021/03/29/Ubuntu权限详解/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/03/29/服务器安装oh-my-zsh/" >服务器安装oh_my_zsh</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-03-29  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h3 id="给自己的服务器安装-oh-my-zsh"><a href="#给自己的服务器安装-oh-my-zsh" class="headerlink" title="给自己的服务器安装 oh my zsh"></a>给自己的服务器安装 oh my zsh</h3><h4 id="1、安装zsh"><a href="#1、安装zsh" class="headerlink" title="1、安装zsh"></a>1、安装zsh</h4><p><code>oh my zsh</code> 需要先安装<code>zsh</code> 所以如果你没有装<code>zsh</code>的话需要先装一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~</span><br><span class="line">sudo apt install zsh</span><br></pre></td></tr></table></figure>

<h3 id="2、安装git"><a href="#2、安装git" class="headerlink" title="2、安装git"></a>2、安装git</h3><p>需要安装<code>git</code>因为在装<code>oh my zsh</code>的时候会去clone它的仓库，所以需要装个<code>git</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install git</span><br></pre></td></tr></table></figure>

<h3 id="3、安装oh-my-zsh"><a href="#3、安装oh-my-zsh" class="headerlink" title="3、安装oh my zsh"></a>3、安装<code>oh my zsh</code></h3><p>这个过程中可能会出现无法连接github的问题，我之前的博客也有解决方案 可以搜一下关键字 <code>解决服务器连不上github的问题</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh -c &quot;$(wget -O- https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210329100744.png"></p>
<p>在安装的过程中会问你是否设为默认终端 选择<code>y</code>就行了</p>
<h3 id="4、更换主题"><a href="#4、更换主题" class="headerlink" title="4、更换主题"></a>4、更换主题</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~</span><br><span class="line">sudo vim .zshrc</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210329101040.png"></p>
<p>这里去改一下主题名称，保存并退出  然后 <code>source .zshrc</code> 就可以了</p>

	
	</div>
  <a type="button" href="/2021/03/29/服务器安装oh-my-zsh/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/03/29/解决服务器连不上github的问题/" >解决服务器连不上github的问题</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-03-29  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h3 id="解决服务器连不上github的问题"><a href="#解决服务器连不上github的问题" class="headerlink" title="解决服务器连不上github的问题"></a>解决服务器连不上github的问题</h3><p>报错信息:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fatal: unable to access &#x27;https://github.com/ohmyzsh/ohmyzsh.git/&#x27;: Empty reply from server</span><br><span class="line">Error: git clone of oh-my-zsh repo failed</span><br></pre></td></tr></table></figure>

<p>本来想改变一下服务器终端的主题，一直都是黑白色 有些单调，就想着安装一个 <code>on my zsh</code> 结果死活连不上<code>github</code></p>
<p>一向贫穷的我怎么买的起香港的服务器当跳板呢，所以绞尽脑汁看各种资料 终于还是发现了</p>
<p>具体步骤如下:</p>
<p>1、首先我们去查一下<code>github.com</code>的ip地址</p>
<p><a target="_blank" rel="noopener" href="https://www.ipaddress.com/ip-lookup">https://www.ipaddress.com/ip-lookup</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210329093225.png"></p>
<p>2、我们进入自己的服务器的<code>/etc</code> 目录下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /etc</span><br><span class="line">sudo vim hosts</span><br></pre></td></tr></table></figure>

<p>在<code>hosts</code>文件最后一行 加上下面这行，并保存退出服务器 重新进一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GitHub的IP   github.com</span><br></pre></td></tr></table></figure>

<p>GitHub的IP 是我们刚才查到的</p>
<p>发现可以连上了。</p>

	
	</div>
  <a type="button" href="/2021/03/29/解决服务器连不上github的问题/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/03/19/ETH智能合约开发/" >ETH智能合约开发</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-03-19  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h2 id="ETH智能合约开发-vue-智能合约"><a href="#ETH智能合约开发-vue-智能合约" class="headerlink" title="ETH智能合约开发(vue + 智能合约)"></a>ETH智能合约开发(vue + 智能合约)</h2><h3 id="一、什么是ETH智能合约"><a href="#一、什么是ETH智能合约" class="headerlink" title="一、什么是ETH智能合约"></a>一、什么是ETH智能合约</h3><blockquote>
<p>说白了就是一段可以运行在以太坊平台上的代码，应用中，我们可以使用 Solidity 来编写和区块链交互的智能合约，<br>合约编写好之后，我们通过一个有余额的外部账户将合约部署到以太坊节点上，<br>并运行合约（使用 Truffle 框架可以更好的帮助我们做这些事情）</p>
</blockquote>
<h3 id="二、Truffle-和-ganache-cli-简介"><a href="#二、Truffle-和-ganache-cli-简介" class="headerlink" title="二、Truffle 和 ganache-cli 简介"></a>二、Truffle 和 ganache-cli 简介</h3><blockquote>
<p>Truffle Truffle是Dapp开发框架，他可以帮我们处理掉大量无关紧要的小事情，<br>让我们可以迅速开始写代码-编译-部署-测试-打包DApp这个流程。<br>Truffle是使用Nodejs开发的，我们首先需要安装Nodejs运行环境。</p>
</blockquote>
<blockquote>
<p>ganache-cli是以太坊节点仿真器软件ganache的命令行版本，可以方便开发者快速进行以太坊DApp的开发与测试。</p>
</blockquote>
<p>1、Truffle安装</p>
<p>查看node版本 没有安装node的请自行google安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Nodejs版本</span><br><span class="line">&gt; npm -v</span><br><span class="line">6.0.0</span><br><span class="line">&gt; node -v</span><br><span class="line">v8.9.4</span><br></pre></td></tr></table></figure>

<p>全局安装Truffle工具。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g truffle</span><br></pre></td></tr></table></figure>

<p>安装完成后查看命令行是否安装成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&gt; truffle</span><br><span class="line">Truffle v4.1.12 - a development framework for Ethereum</span><br><span class="line"></span><br><span class="line">Usage: truffle  [options]</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  init      Initialize new and empty Ethereum project</span><br><span class="line">  compile   Compile contract source files</span><br><span class="line">  migrate   Run migrations to deploy contracts</span><br><span class="line">  deploy    (alias for migrate)</span><br><span class="line">  build     Execute build pipeline (if configuration present)</span><br><span class="line">  test      Run JavaScript and Solidity tests</span><br><span class="line">  debug     Interactively debug any transaction on the blockchain (experimental)</span><br><span class="line">  opcode    Print the compiled opcodes for a given contract</span><br><span class="line">  console   Run a console with contract abstractions and commands available</span><br><span class="line">  develop   Open a console with a local development blockchain</span><br><span class="line">  create    Helper to create new contracts, migrations and tests</span><br><span class="line">  install   Install a package from the Ethereum Package Registry</span><br><span class="line">  publish   Publish a package to the Ethereum Package Registry</span><br><span class="line">  networks  Show addresses for deployed contracts on each network</span><br><span class="line">  watch     Watch filesystem for changes and rebuild the project automatically</span><br><span class="line">  serve     Serve the build directory on localhost and watch for changes</span><br><span class="line">  exec      Execute a JS module within this Truffle environment</span><br><span class="line">  unbox     Download a Truffle Box, a pre-built Truffle project</span><br><span class="line">  version   Show version number and exit</span><br><span class="line"></span><br><span class="line">See more at http://truffleframework.com/docs</span><br></pre></td></tr></table></figure>

<p>2、全局安装ganache-cli</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g ganache-cli</span><br></pre></td></tr></table></figure>

<h3 id="三、创建项目"><a href="#三、创建项目" class="headerlink" title="三、创建项目"></a>三、创建项目</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt; cd ~</span><br><span class="line">&gt; mkdir truffle-crowdfund</span><br><span class="line">&gt; cd truffle-crowdfund</span><br><span class="line"># 初始化项目</span><br><span class="line">&gt; truffle init</span><br><span class="line">Downloading...</span><br><span class="line">Unpacking...</span><br><span class="line">Setting up...</span><br><span class="line">Unbox successful. Sweet!</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line"></span><br><span class="line">  Compile:        truffle compile</span><br><span class="line">  Migrate:        truffle migrate</span><br><span class="line">  Test contracts: truffle test</span><br></pre></td></tr></table></figure>

<h3 id="四、启动测试节点"><a href="#四、启动测试节点" class="headerlink" title="四、启动测试节点"></a>四、启动测试节点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ganache-cli</span><br></pre></td></tr></table></figure>

<p>它会自动给我们生成10个带有100个eth的账户</p>
<h3 id="五、接下来写合约代码并部署到测试网络上"><a href="#五、接下来写合约代码并部署到测试网络上" class="headerlink" title="五、接下来写合约代码并部署到测试网络上"></a>五、接下来写合约代码并部署到测试网络上</h3><h4 id="需求："><a href="#需求：" class="headerlink" title="需求："></a>需求：</h4><blockquote>
<p>假设我准备出版一本区块练技术书籍，但是不确定有多少人愿意购买这本书，于是我发起了一个众筹， 如果在一个月内，<br>  能筹集到 10 个 ETH，我就进行写作，并给参与的读者每人赠送一本书，如果未能筹到足够的资金，<br>  参与的读者赎回之前投入的资金。<br>  同时，为了让读者积极参与，初始时，参与众筹的价格非常低（0.02 ETH），每筹集满 1 个 ETH 时，价格上涨 0.002ETH。<br>  归纳出合约三个对外动作（函数）：</p>
</blockquote>
<blockquote>
<p>1、汇款进合约，可通过实现合约的回退函数来实现。</p>
<p>2、读者赎回汇款，这个函数仅仅在众筹未达标之后，由读者本人调用生效。</p>
<p>3、创作者提取资金，这个函数需要在众筹达标之后，由创作者调用。</p>
</blockquote>
<blockquote>
<p>除此之外，还需要一个状态变量来保存以下状态：</p>
</blockquote>
<blockquote>
<p>1、用户众筹的金额，使用一个 mapping 来保存。</p>
<p>2、当前众筹的价格，以及一个相应的内部函数逐步上涨价格。价格可以使用一个 uint 来保存。</p>
<p>3、合约众筹的截止时间，用 uint 来保存， 在合约创建时往后追加 30 天，在构造函数中完成。</p>
<p>4、记录合约众筹的收益者，即创作者，在合约创建时在构造函数中进行赋值，合约创建者就是创作者。</p>
<p>5、再加入众筹状态，如果众筹停止阻止用户在参与。创作者提取资金时及时关闭众筹。</p>
</blockquote>
<h4 id="实现众筹合约"><a href="#实现众筹合约" class="headerlink" title="实现众筹合约"></a>实现众筹合约</h4><p>我们进入到上面使用<code>truffle init</code>命令创建的项目中去</p>
<p>在 contracts 下创建一个合约文件 Crowdfunding.sol:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity &gt;=0.4.21 &lt;0.7.0;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">contract Crowdfunding &#123;</span><br><span class="line">    // 创作者</span><br><span class="line">    address public author;</span><br><span class="line"></span><br><span class="line">    // 参与金额</span><br><span class="line">    mapping(address =&gt; uint) public joined;</span><br><span class="line"></span><br><span class="line">    // 众筹目标</span><br><span class="line">    uint constant Target = 10 ether;</span><br><span class="line"></span><br><span class="line">    // 众筹截止时间</span><br><span class="line">    uint public endTime;</span><br><span class="line"></span><br><span class="line">    // 记录当前众筹价格</span><br><span class="line">    uint public price  = 0.02 ether ;</span><br><span class="line"></span><br><span class="line">    // 作者提取资金之后，关闭众筹</span><br><span class="line">    bool public closed = false;</span><br><span class="line"></span><br><span class="line">    // 部署合约时调用，初始化作者以及众筹结束时间</span><br><span class="line">    constructor() public &#123;</span><br><span class="line">        author = msg.sender;</span><br><span class="line">        endTime = now + 30 days;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 更新价格，这是一个内部函数</span><br><span class="line">    function updatePrice() internal &#123;</span><br><span class="line">        uint rise = address(this).balance / 1 ether * 0.002 ether;</span><br><span class="line">        price = 0.02 ether + rise;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 用户向合约转账时 触发的回调函数</span><br><span class="line">    function () external payable &#123;</span><br><span class="line">        require(now &lt; endTime &amp;&amp; !closed  , &quot;众筹已结束&quot;);</span><br><span class="line">        require(joined[msg.sender] == 0 , &quot;你已经参与过众筹&quot;);</span><br><span class="line"></span><br><span class="line">        require (msg.value &gt;= price, &quot;出价太低了&quot;);</span><br><span class="line">        joined[msg.sender] = msg.value;</span><br><span class="line"></span><br><span class="line">        updatePrice();</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    // 作者提取资金</span><br><span class="line">    function withdrawFund() external &#123;</span><br><span class="line">        require(msg.sender == author, &quot;你不是作者&quot;);</span><br><span class="line">        require(address(this).balance &gt;= Target, &quot;未达到众筹目标&quot;);</span><br><span class="line">        closed = true;   </span><br><span class="line">        msg.sender.transfer(address(this).balance);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 读者赎回资金</span><br><span class="line">    function withdraw() external &#123;</span><br><span class="line">        require(now &gt; endTime, &quot;还未到众筹结束时间&quot;);</span><br><span class="line">        require(!closed, &quot;众筹达标，众筹资金已提取&quot;);</span><br><span class="line">        require(Target &gt; address(this).balance, &quot;众筹达标，你没法提取资金&quot;);</span><br><span class="line">        </span><br><span class="line">        msg.sender.transfer(joined[msg.sender]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>代码的介绍，在合约代码中，使用到了 Solidity 语言中的一些知识点：</p>
</blockquote>
<blockquote>
<p>ether : 这是货币单位<br>。<br>days : 这是时间单位，1 days 对应 1 天的秒数。</p>
<p>now : 这是一个 Solidity 的内置属性，用于获取当前的时间戳，单位是秒。</p>
<p>require : 如果条件不满足回退交易。</p>
<p>address.transfer(value) : 对某一个地址进行转账。</p>
<p>有关 Solidity 语言入门推荐大家使用官网课程 <a target="_blank" rel="noopener" href="https://cryptozombies.io/zh/course/">僵尸游戏</a></p>
</blockquote>
<h4 id="合约部署"><a href="#合约部署" class="headerlink" title="合约部署"></a>合约部署</h4><p>部署之前我们使用 <code>truffle compile</code> 命令来进行编译</p>
<p>之后，在 migrations 下创建一个部署脚本 2_crowfunding.js ，内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const crowd = artifacts.require(&quot;Crowdfunding&quot;);</span><br><span class="line"></span><br><span class="line">module.exports = function(deployer) &#123;</span><br><span class="line">  deployer.deploy(crowd);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>接下来你的文件目录应该是这样的:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">├── build</span><br><span class="line">│   └── contracts</span><br><span class="line">│       ├── CrowdFunding.json</span><br><span class="line">│       └── Migrations.json</span><br><span class="line">├── contracts</span><br><span class="line">│   ├── CrowdFunding.sol</span><br><span class="line">│   └── Migrations.sol</span><br><span class="line">├── migrations</span><br><span class="line">│   ├── 1_initial_migration.js</span><br><span class="line">│   └── 2_crowdfunding_migration.js</span><br><span class="line">├── test</span><br><span class="line">└── truffle-config.js</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>注意一下这个<code>1_initial_migration.js</code>文件和 <code>Migrations.sol</code>文件 这是我们在使用<code>truffle init</code>命令初始化项目时它为我们生成的文件 这两个文件是不能删除的否则会无法进行部署，我们在<code>migrations</code>文件夹下面创建的文件要按照 1_xxx.js, 2_xxx.js 在部署的时候是按照这个顺序进行的。</p>
<p>下面我们配置部署脚本<code>truffle-config.js</code></p>
<p>配置之前 我们还需要做一些事情：</p>
<p>1、注册infura获取PROJECT-ID</p>
<p><a target="_blank" rel="noopener" href="https://infura.io/">infura</a>是基于ETH的chain公共API服务，为开发者提供链上数据查询、交易广播等功能。</p>
<p>注册成功之后需要创建项目</p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210325100549.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210325100631.png"></p>
<p>项目名字是随便起的无所谓</p>
<p>项目创建完之后你就能看到PROJECT-ID了这个我们待会要用</p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210325100830.png"></p>
<p>2、我们还需要一个浏览器插件 <a target="_blank" rel="noopener" href="https://metamask.io/">MetaMask</a> 推荐大家使用Chrome浏览器 </p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210325101145.png"></p>
<p>按照步骤注册账户，并将助记词保存下来， 我们下面要用到</p>
<p>我们需要获取ETH，以为部署是要gas费的, 测试网络可以每天给我们5个ETH 这足够我们使用了</p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210325103044.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210325103155.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210325103316.png"></p>
<p>3、安装 <code>truffle-hdwallet-provider</code></p>
<p>由于需要将合约部署到测试网Ropsten，此过程需要部署者私钥进行签名再将数据进行广播，<br><code>truffle-hdwallet-provider</code>是truffle上提供交易离线签名的模块</p>
<p>注：必须在truffle框架的代码目录下安装，否则不生效</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; cd truffle-crowdfund</span><br><span class="line">&gt; npm install truffle-hdwallet-provider</span><br></pre></td></tr></table></figure>

<p>4、我们终于可以进行修改<code>truffle-config.js</code>部署脚本了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Use this file to configure your truffle project. It&#x27;s seeded with some</span><br><span class="line"> * common settings for different networks and features like migrations,</span><br><span class="line"> * compilation and testing. Uncomment the ones you need or modify</span><br><span class="line"> * them to suit your project as necessary.</span><br><span class="line"> *</span><br><span class="line"> * More information about configuration can be found at:</span><br><span class="line"> *</span><br><span class="line"> * trufflesuite.com/docs/advanced/configuration</span><br><span class="line"> *</span><br><span class="line"> * To deploy via Infura you&#x27;ll need a wallet provider (like @truffle/hdwallet-provider)</span><br><span class="line"> * to sign your transactions before they&#x27;re sent to a remote public node. Infura accounts</span><br><span class="line"> * are available for free at: infura.io/register.</span><br><span class="line"> *</span><br><span class="line"> * You&#x27;ll also need a mnemonic - the twelve word phrase the wallet uses to generate</span><br><span class="line"> * public/private key pairs. If you&#x27;re publishing your code to GitHub make sure you load this</span><br><span class="line"> * phrase from a file you&#x27;ve .gitignored so it doesn&#x27;t accidentally become public.</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">const HDWalletProvider = require(&#x27;truffle-hdwallet-provider&#x27;);</span><br><span class="line">// const infuraKey = &quot;fj4jll3k.....&quot;;</span><br><span class="line">//</span><br><span class="line">const fs = require(&#x27;fs&#x27;);</span><br><span class="line">const mnemonic = fs.readFileSync(&quot;.secret&quot;).toString().trim();</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  /**</span><br><span class="line">   * Networks define how you connect to your ethereum client and let you set the</span><br><span class="line">   * defaults web3 uses to send transactions. If you don&#x27;t specify one truffle</span><br><span class="line">   * will spin up a development blockchain for you on port 9545 when you</span><br><span class="line">   * run `develop` or `test`. You can ask a truffle command to use a specific</span><br><span class="line">   * network from the command line, e.g</span><br><span class="line">   *</span><br><span class="line">   * $ truffle test --network &lt;network-name&gt;</span><br><span class="line">   */</span><br><span class="line"></span><br><span class="line">  networks: &#123;</span><br><span class="line">    // Useful for testing. The `development` name is special - truffle uses it by default</span><br><span class="line">    // if it&#x27;s defined here and no other network is specified at the command line.</span><br><span class="line">    // You should run a client (like ganache-cli, geth or parity) in a separate terminal</span><br><span class="line">    // tab if you use this network and you must also set the `host`, `port` and `network_id`</span><br><span class="line">    // options below to some value.</span><br><span class="line">    //</span><br><span class="line">    mainnet: &#123;</span><br><span class="line">      provider: function () &#123;</span><br><span class="line">        // Setting the provider with the Infura Rinkeby address and Token</span><br><span class="line">        return new HDWalletProvider(mnemonic, &quot;https://mainnet.infura.io/v3/xxxx1cabc499dc5d569&quot;)</span><br><span class="line">      &#125;,</span><br><span class="line">      network_id: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    // development: &#123;</span><br><span class="line">    //  host: &quot;127.0.0.1&quot;,     // Localhost (default: none)</span><br><span class="line">    //  port: 8545,            // Standard Ethereum port (default: none)</span><br><span class="line">    //  network_id: &quot;*&quot;,       // Any network (default: none)</span><br><span class="line">    // &#125;,</span><br><span class="line">    // Another network with more advanced options...</span><br><span class="line">    // advanced: &#123;</span><br><span class="line">    // port: 8777,             // Custom port</span><br><span class="line">    // network_id: 1342,       // Custom network</span><br><span class="line">    // gas: 8500000,           // Gas sent with each transaction (default: ~6700000)</span><br><span class="line">    // gasPrice: 20000000000,  // 20 gwei (in wei) (default: 100 gwei)</span><br><span class="line">    // from: &lt;address&gt;,        // Account to send txs from (default: accounts[0])</span><br><span class="line">    // websocket: true        // Enable EventEmitter interface for web3 (default: false)</span><br><span class="line">    // &#125;,</span><br><span class="line">    // Useful for deploying to a public network.</span><br><span class="line">    // NB: It&#x27;s important to wrap the provider as a function.</span><br><span class="line">    ropsten: &#123;</span><br><span class="line">      provider: () =&gt; new HDWalletProvider(mnemonic, &quot;https://ropsten.infura.io/v3/xxxx1cabc499dc5d569&quot;),</span><br><span class="line">      network_id: 3,       // Ropsten&#x27;s id</span><br><span class="line">      gas: 5500000,        // Ropsten has a lower block limit than mainnet</span><br><span class="line">      confirmations: 2,    // # of confs to wait between deployments. (default: 0)</span><br><span class="line">      timeoutBlocks: 200,  // # of blocks before a deployment times out  (minimum/default: 50)</span><br><span class="line">      skipDryRun: true     // Skip dry run before migrations? (default: false for public nets )</span><br><span class="line">    &#125;,</span><br><span class="line">    // Useful for private networks</span><br><span class="line">    // private: &#123;</span><br><span class="line">    // provider: () =&gt; new HDWalletProvider(mnemonic, `https://network.io`),</span><br><span class="line">    // network_id: 2111,   // This network is yours, in the cloud.</span><br><span class="line">    // production: true    // Treats this network as if it was a public net. (default: false)</span><br><span class="line">    // &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  // Set default mocha options here, use special reporters etc.</span><br><span class="line">  mocha: &#123;</span><br><span class="line">    // timeout: 100000</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  // Configure your compilers</span><br><span class="line">  compilers: &#123;</span><br><span class="line">    solc: &#123;</span><br><span class="line">      // version: &quot;0.5.1&quot;,    // Fetch exact version from solc-bin (default: truffle&#x27;s version)</span><br><span class="line">      // docker: true,        // Use &quot;0.5.1&quot; you&#x27;ve installed locally with docker (default: false)</span><br><span class="line">      // settings: &#123;          // See the solidity docs for advice about optimization and evmVersion</span><br><span class="line">      //  optimizer: &#123;</span><br><span class="line">      //    enabled: false,</span><br><span class="line">      //    runs: 200</span><br><span class="line">      //  &#125;,</span><br><span class="line">      //  evmVersion: &quot;byzantium&quot;</span><br><span class="line">      // &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  // Truffle DB is currently disabled by default; to enable it, change enabled: false to enabled: true</span><br><span class="line">  //</span><br><span class="line">  // Note: if you migrated your contracts prior to enabling this field in your Truffle project and want</span><br><span class="line">  // those previously migrated contracts available in the .db directory, you will need to run the following:</span><br><span class="line">  // $ truffle migrate --reset --compile-all</span><br><span class="line"></span><br><span class="line">  db: &#123;</span><br><span class="line">    enabled: false</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>注意这几行 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const HDWalletProvider = require(&#x27;truffle-hdwallet-provider&#x27;);</span><br><span class="line">// const infuraKey = &quot;fj4jll3k.....&quot;;</span><br><span class="line">//</span><br><span class="line">const fs = require(&#x27;fs&#x27;);</span><br><span class="line">const mnemonic = fs.readFileSync(&quot;.secret&quot;).toString().trim();</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">ropsten: &#123;</span><br><span class="line">  provider: () =&gt; new HDWalletProvider(mnemonic, &quot;https://ropsten.infura.io/v3/xxxx1cabc499dc5d569&quot;),</span><br><span class="line">  network_id: 3,       // Ropsten&#x27;s id</span><br><span class="line">  gas: 5500000,        // Ropsten has a lower block limit than mainnet</span><br><span class="line">  confirmations: 2,    // # of confs to wait between deployments. (default: 0)</span><br><span class="line">  timeoutBlocks: 200,  // # of blocks before a deployment times out  (minimum/default: 50)</span><br><span class="line">  skipDryRun: true     // Skip dry run before migrations? (default: false for public nets )</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>这里我们用到了 助记词 和 PROJECT-ID 我这里是在项目的根目录下创建了一个<code>.secret</code>文件 把助记词放到了文件里, 这样比较好，<br>你也可以使用变量进行保存 <code>const infuraKey = &quot;fj4jll3k.....&quot;</code></p>
<p>5、部署到Ropsten测试网络</p>
<p>执行<code>truffle migrate --network ropsten</code> 即可部署至Ropsten</p>
<p>如需要重新编译所有合约，可执行<code>truffle migrate --network ropsten --reset --compile-all</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">Compiling your contracts...</span><br><span class="line">===========================</span><br><span class="line">&gt; Everything is up to date, there is nothing to compile.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Starting migrations...</span><br><span class="line">======================</span><br><span class="line">&gt; Network name:    &#x27;ropsten&#x27;</span><br><span class="line">&gt; Network id:      3</span><br><span class="line">&gt; Block gas limit: 8000000 (0x7a1200)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1_initial_migration.js</span><br><span class="line">======================</span><br><span class="line"></span><br><span class="line">   Deploying &#x27;Migrations&#x27;</span><br><span class="line">   ----------------------</span><br><span class="line">   &gt; transaction hash:    0xe27c86dc48219fa193d23843b301d6878a6820dcc93fd92a20e24d1ec9c49b31</span><br><span class="line">   &gt; Blocks: 3            Seconds: 14</span><br><span class="line">   &gt; contract address:    0x2e2982D9d1914b6580139Ec4E356B708478C875F</span><br><span class="line">   &gt; block number:        9898882</span><br><span class="line">   &gt; block timestamp:     1616554032</span><br><span class="line">   &gt; account:             0x270dF7D1f4612063abA065389b3fCbeF7993caA9</span><br><span class="line">   &gt; balance:             4.93502452</span><br><span class="line">   &gt; gas used:            193243 (0x2f2db)</span><br><span class="line">   &gt; gas price:           20 gwei</span><br><span class="line">   &gt; value sent:          0 ETH</span><br><span class="line">   &gt; total cost:          0.00386486 ETH</span><br><span class="line"></span><br><span class="line">   Pausing for 2 confirmations...</span><br><span class="line">   ------------------------------</span><br><span class="line">   &gt; confirmation number: 1 (block: 9898884)</span><br><span class="line">   &gt; confirmation number: 2 (block: 9898885)</span><br><span class="line"></span><br><span class="line">   &gt; Saving migration to chain.</span><br><span class="line">   &gt; Saving artifacts</span><br><span class="line">   -------------------------------------</span><br><span class="line">   &gt; Total cost:          0.00386486 ETH</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2_crowdfunding_migration.js</span><br><span class="line">===========================</span><br><span class="line"></span><br><span class="line">   Deploying &#x27;CrowdFunding&#x27;</span><br><span class="line">   ------------------------</span><br><span class="line">   &gt; transaction hash:    0x0f787b4d1567a00a8da4b28970632238fc50eb43ee7e33fb8d5c3d92fcbf5880</span><br><span class="line">   &gt; Blocks: 2            Seconds: 25</span><br><span class="line">   &gt; contract address:    0x3e32bF1e0Af404ed7DbCEf538BEba75ea2a76510</span><br><span class="line">   &gt; block number:        9898889</span><br><span class="line">   &gt; block timestamp:     1616554105</span><br><span class="line">   &gt; account:             0x270dF7D1f4612063abA065389b3fCbeF7993caA9</span><br><span class="line">   &gt; balance:             4.9224565</span><br><span class="line">   &gt; gas used:            582663 (0x8e407)</span><br><span class="line">   &gt; gas price:           20 gwei</span><br><span class="line">   &gt; value sent:          0 ETH</span><br><span class="line">   &gt; total cost:          0.01165326 ETH</span><br><span class="line"></span><br><span class="line">   Pausing for 2 confirmations...</span><br><span class="line">   ------------------------------</span><br><span class="line">   &gt; confirmation number: 1 (block: 9898890)</span><br><span class="line">   &gt; confirmation number: 2 (block: 9898891)</span><br><span class="line"></span><br><span class="line">   &gt; Saving migration to chain.</span><br><span class="line">   &gt; Saving artifacts</span><br><span class="line">   -------------------------------------</span><br><span class="line">   &gt; Total cost:          0.01165326 ETH</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Summary</span><br><span class="line">=======</span><br><span class="line">&gt; Total deployments:   2</span><br><span class="line">&gt; Final cost:          0.01551812 ETH</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="六、使用vue项目与合约进行交互"><a href="#六、使用vue项目与合约进行交互" class="headerlink" title="六、使用vue项目与合约进行交互"></a>六、使用vue项目与合约进行交互</h3><blockquote>
<p>利用 CrowdFund.vue 来众筹界面，众筹界面需要显示以下几个部分：</p>
</blockquote>
<blockquote>
<p> 1、当前众筹到金额。</p>
<p> 2、众筹的截止时间。</p>
<p> 3、当前众筹的价格，参与众筹按钮。</p>
<p> 4、如果是已经参与，显示其参与的价格以及赎回按钮。</p>
<p> 5、如果是创作者，显示一个提取资金按钮。</p>
</blockquote>
<p>1、 依然是创建一个vue项目</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue create crowd_funding_vue</span><br></pre></td></tr></table></figure>

<p>我们在components文件夹下创建一个<code>CrowdFunding.vue</code>文件 我们整个的<code>CrowdFunding.vue</code>文件就像是这样</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;content&quot;&gt;</span><br><span class="line">        &lt;h3&gt; 新书众筹&lt;/h3&gt;</span><br><span class="line">        &lt;span&gt;以最低的价格获取我的新书 &lt;/span&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div class=&quot;status&quot;&gt;</span><br><span class="line">            &lt;div v-if=&quot;!closed&quot;&gt;已众筹资金：&lt;b&gt;&#123;&#123; total &#125;&#125; ETH &lt;/b&gt;&lt;/div&gt;</span><br><span class="line">            &lt;div v-if=&quot;closed&quot;&gt; 众筹已完成&lt;/div&gt;</span><br><span class="line">            &lt;div&gt;众筹截止时间：&#123;&#123; endDate &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div v-if=&quot;joined&quot; class=&quot;card-bkg&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;award-des&quot;&gt;</span><br><span class="line">                &lt;span&gt; 参与价格 &lt;/span&gt;</span><br><span class="line">                &lt;b&gt; &#123;&#123; joinPrice &#125;&#125; ETH &lt;/b&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">            &lt;button :disabled=&quot;closed&quot; @click=&quot;withdraw&quot;&gt;赎回&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div v-if=&quot;!joined&quot; class=&quot;card-bkg&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;award-des&quot;&gt;</span><br><span class="line">                &lt;span&gt; 当前众筹价格 &lt;/span&gt;</span><br><span class="line">                &lt;b&gt; &#123;&#123; price &#125;&#125; ETH &lt;/b&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">            &lt;button :disabled=&quot;closed&quot; @click=&quot;join&quot;&gt;参与众筹&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div v-if=&quot;isAuthor&quot;&gt;</span><br><span class="line">            &lt;button :disabled=&quot;closed&quot; @click=&quot;withdrawFund&quot;&gt; 提取资金&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import contract from &quot;truffle-contract&quot;;</span><br><span class="line">    import crowd from &#x27;../../public/build/contracts/CrowdFunding.json&#x27;;</span><br><span class="line"></span><br><span class="line">    const Web3 = require(&#x27;web3&#x27;);</span><br><span class="line"></span><br><span class="line">    export default &#123;</span><br><span class="line">        name: &#x27;CrowdFund&#x27;,</span><br><span class="line">        // 定义上面HTML模板中使用的变量</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                price: null,</span><br><span class="line">                total: 0,</span><br><span class="line">                closed: true,</span><br><span class="line">                joinPrice: null,</span><br><span class="line">                joined: false,</span><br><span class="line">                endDate: &quot;null&quot;,</span><br><span class="line">                isAuthor: true,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        // 当前Vue组件被创建时回调的hook 函数</span><br><span class="line">        async created() &#123;</span><br><span class="line">            //  初始化 web3及账号</span><br><span class="line">            await this.initWeb3Account()</span><br><span class="line">            //  初始化合约实例</span><br><span class="line">            await this.initContract()</span><br><span class="line">            //  获取合约的状态信息</span><br><span class="line">            await this.getCrowdInfo()</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            async initWeb3Account() &#123;</span><br><span class="line">                console.log(&quot;initWeb3Account 方法执行了-------&quot;);</span><br><span class="line">                // 检查新版MetaMask</span><br><span class="line">                if (window.ethereum) &#123;</span><br><span class="line">                    this.provider = window.ethereum;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        // 请求用户账号授权</span><br><span class="line">                        await window.ethereum.enable();</span><br><span class="line">                    &#125; catch (error) &#123;</span><br><span class="line">                        // 用户拒绝了访问</span><br><span class="line">                        console.log(&quot;User denied account access&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                // 老版 MetaMask</span><br><span class="line">                else if (window.web3) &#123;</span><br><span class="line">                    this.provider = window.web3.currentProvider;</span><br><span class="line">                &#125;</span><br><span class="line">                // 如果没有注入的web3实例，回退到使用 Ganache</span><br><span class="line">                else &#123;</span><br><span class="line">                    alert(&quot;请安装MetaMask!&quot;);</span><br><span class="line">                     this.provider = new Web3.providers.HttpProvider(&quot;http://127.0.0.1:7545&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">                this.web3 = new Web3(this.provider);</span><br><span class="line">                this.web3.eth.getAccounts().then(accs =&gt; &#123;</span><br><span class="line">                    this.account = accs[0]</span><br><span class="line">                    console.log(accs)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">            async initContract() &#123;</span><br><span class="line">                const crowdContract = contract(crowd)</span><br><span class="line">                crowdContract.setProvider(this.provider)</span><br><span class="line">                this.crowdFund = await crowdContract.deployed()</span><br><span class="line">            &#125;,</span><br><span class="line">            async getCrowdInfo() &#123;</span><br><span class="line">                // 获取合约的余额</span><br><span class="line">                this.web3.eth.getBalance(this.crowdFund.address).then(</span><br><span class="line">                    r =&gt; &#123;</span><br><span class="line">                        this.total = this.web3.utils.fromWei(r)</span><br><span class="line">                    &#125;</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">                // 获取读者的参与金额</span><br><span class="line">                this.crowdFund.joined(this.account).then(</span><br><span class="line">                    r =&gt; &#123;</span><br><span class="line">                        if (r &gt; 0) &#123;</span><br><span class="line">                            this.joined = true</span><br><span class="line">                            this.joinPrice = this.web3.utils.fromWei(r)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">                // 获取合约的关闭状态</span><br><span class="line">                this.crowdFund.closed().then(</span><br><span class="line">                    r =&gt; this.closed = r</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">                // 获取当前的众筹价格</span><br><span class="line">                this.crowdFund.price().then(</span><br><span class="line">                    r =&gt; this.price = this.web3.utils.fromWei(r)</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">                // 获取众筹截止时间</span><br><span class="line">                this.crowdFund.endTime().then(r =&gt; &#123;</span><br><span class="line">                    var endTime = new Date(r * 1000)</span><br><span class="line">                    // 把时间戳转化为本地时间</span><br><span class="line">                    this.endDate = endTime.toLocaleDateString().replace(/\//g, &quot;-&quot;) + &quot; &quot; + endTime.toTimeString().substr(0, 8);</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">                // 获取众筹创作者地址</span><br><span class="line">                this.crowdFund.author().then(r =&gt; &#123;</span><br><span class="line">                    if (this.account === r) &#123;</span><br><span class="line">                        this.isAuthor = true</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        this.isAuthor = false</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">            // 读者参与众筹的 join()函数</span><br><span class="line">            join() &#123;</span><br><span class="line">                this.web3.eth.sendTransaction(&#123;</span><br><span class="line">                    from: this.account,</span><br><span class="line">                    to: this.crowdFund.address,</span><br><span class="line">                    value: this.web3.utils.toWei(this.price)</span><br><span class="line">                &#125;).then(() =&gt;</span><br><span class="line">                    this.getCrowdInfo()</span><br><span class="line">                )</span><br><span class="line">            &#125;,</span><br><span class="line">            // 读者赎回的 withdraw()函数</span><br><span class="line">            withdraw() &#123;</span><br><span class="line">                this.crowdFund.withdraw(&#123;</span><br><span class="line">                    from: this.account</span><br><span class="line">                &#125;).then(() =&gt; &#123;</span><br><span class="line">                    this.getCrowdInfo()</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">            // 创作者提取资金的 withdrawFund()函数</span><br><span class="line">            withdrawFund() &#123;</span><br><span class="line">                this.crowdFund.withdrawFund(&#123;</span><br><span class="line">                    from: this.account</span><br><span class="line">                &#125;).then(() =&gt; &#123;</span><br><span class="line">                    this.getCrowdInfo()</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>2、与合约进行交互</p>
<p>前端界面与合约进行交互时，需要使用到 <code>truffle-contract</code> 及 <code>web3</code> ，因为 Vue 工程本身也是通过 NPM 进行包管理，<br>因此可以直接通过 npm 进行安装，命令如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save truffle-contract web3</span><br></pre></td></tr></table></figure>

<p>如果创建vue项目的时候已经启动了vue项目 那么你需要重新启动一下vue项目 因为安装了包之后需要重新启动 这样使用import导入包的时候<br>才不会报错。</p>
<p>3、将智能合约项目编译产生的<code>build</code>文件夹放进vue项目中的<code>public</code>文件夹下 注意看上面的这句话</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import crowd from &#x27;../../public/build/contracts/CrowdFunding.json&#x27;;</span><br></pre></td></tr></table></figure>

<p>4、启动vue项目进行交互 看起来就像这样</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run serve</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210325105129.png"></p>
<h4 id="特别感谢一下博文"><a href="#特别感谢一下博文" class="headerlink" title="特别感谢一下博文"></a>特别感谢一下博文</h4><p>1、<a target="_blank" rel="noopener" href="https://learnblockchain.cn/2019/12/20/vue-dapp">如何使用Vue.js 开发以太坊DApp</a></p>
<p>2、<a target="_blank" rel="noopener" href="https://blog.csdn.net/u010159567/article/details/104895457">以太坊ETH-智能合约开发-solidity源码分析-truffle进阶</a></p>
<p>3、<a target="_blank" rel="noopener" href="https://blog.csdn.net/TurkeyCock/article/details/85103434">Infura：一键接入以太坊</a></p>
<p>4、<a target="_blank" rel="noopener" href="https://learnblockchain.cn/docs/truffle/getting-started/truffle-with-metamask.html">Truffle 和 MetaMask 配合</a></p>
<p>5、<a target="_blank" rel="noopener" href="https://www.chainnews.com/articles/823921189500.htm">详解 Truffle Migrations （迁移）- 合约部署不再困惑</a></p>
<p>6、<a target="_blank" rel="noopener" href="http://blog.hubwiz.com/2019/09/13/ethereum-dev-tools-2019/#%E6%96%B0%E6%89%8B%E5%85%A5%E9%97%A8">以太坊开发资源全面指南</a></p>

	
	</div>
  <a type="button" href="/2021/03/19/ETH智能合约开发/#more" class="btn btn-default more">阅读此文</a>
</div>

		

		</div>

		<!-- pagination -->
		<div>
  		<center>
		<div class="pagination">

   
    
           <a type="button" class="btn btn-default disabled"><i class="fa fa-arrow-circle-o-left"></i>上一页</a>
        

        <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
 
       <a href="/page/2/" type="button" class="btn btn-default ">下一页<i class="fa fa-arrow-circle-o-right"></i></a>     
        

  
</div>

  		</center>
		</div>

		
		
	</div> <!-- col-md-9 -->

	
		<div class="col-md-3">
	<div id="sidebar">
	
			
  <div id="site_search">
   <div class="form-group">
    <input type="text" id="local-search-input" name="q" results="0" placeholder="搜索" class="st-search-input st-default-search-input form-control"/>
   </div>  
  <div id="local-search-result"></div>
  </div>


		
			
	<div class="widget">
		<h4>分类</h4>
		<ul class="tag_box inline list-unstyled">
		
			<li><a href="/categories/Android/">Android<span>11</span></a></li>
		
			<li><a href="/categories/Appium/">Appium<span>1</span></a></li>
		
			<li><a href="/categories/ETH智能合约/">ETH智能合约<span>1</span></a></li>
		
			<li><a href="/categories/Fail2ban/">Fail2ban<span>1</span></a></li>
		
			<li><a href="/categories/IDEA/">IDEA<span>1</span></a></li>
		
			<li><a href="/categories/Java/">Java<span>1</span></a></li>
		
			<li><a href="/categories/Linux/">Linux<span>6</span></a></li>
		
			<li><a href="/categories/Mac/">Mac<span>3</span></a></li>
		
			<li><a href="/categories/NFT/">NFT<span>1</span></a></li>
		
			<li><a href="/categories/Redis/">Redis<span>1</span></a></li>
		
			<li><a href="/categories/Rust/">Rust<span>3</span></a></li>
		
			<li><a href="/categories/Ubuntu/">Ubuntu<span>1</span></a></li>
		
			<li><a href="/categories/github/">github<span>1</span></a></li>
		
			<li><a href="/categories/mysql/">mysql<span>1</span></a></li>
		
			<li><a href="/categories/nginx/">nginx<span>1</span></a></li>
		
			<li><a href="/categories/oh-my-zsh/">oh my zsh<span>1</span></a></li>
		
			<li><a href="/categories/rails/">rails<span>2</span></a></li>
		
			<li><a href="/categories/redis/">redis<span>1</span></a></li>
		
			<li><a href="/categories/web前端/">web前端<span>1</span></a></li>
		
			<li><a href="/categories/图床/">图床<span>1</span></a></li>
		
			<li><a href="/categories/钓鱼网站/">钓鱼网站<span>1</span></a></li>
		
		</ul>
	</div>

		
			
	<div class="widget">
		<h4>标签云</h4>
		<ul class="tag_box inline list-unstyled">		
		
			<li><a href="/tags/ruby/">ruby<span>1</span></a></li>
		
			<li><a href="/tags/运维/">运维<span>1</span></a></li>
		
			<li><a href="/tags/mysql/">mysql<span>2</span></a></li>
		
			<li><a href="/tags/EditText/">EditText<span>1</span></a></li>
		
			<li><a href="/tags/NFT/">NFT<span>1</span></a></li>
		
			<li><a href="/tags/Linux/">Linux<span>5</span></a></li>
		
			<li><a href="/tags/Drawable/">Drawable<span>1</span></a></li>
		
			<li><a href="/tags/Intent/">Intent<span>1</span></a></li>
		
			<li><a href="/tags/rails/">rails<span>1</span></a></li>
		
			<li><a href="/tags/viewPager2/">viewPager2<span>1</span></a></li>
		
			<li><a href="/tags/腾讯云服务器/">腾讯云服务器<span>1</span></a></li>
		
			<li><a href="/tags/自动化测试/">自动化测试<span>1</span></a></li>
		
			<li><a href="/tags/常用命令/">常用命令<span>1</span></a></li>
		
			<li><a href="/tags/jsDelivr/">jsDelivr<span>1</span></a></li>
		
			<li><a href="/tags/xml/">xml<span>1</span></a></li>
		
			<li><a href="/tags/github/">github<span>2</span></a></li>
		
			<li><a href="/tags/Java/">Java<span>2</span></a></li>
		
			<li><a href="/tags/字面量/">字面量<span>1</span></a></li>
		
			<li><a href="/tags/背景图/">背景图<span>1</span></a></li>
		
			<li><a href="/tags/nginx/">nginx<span>1</span></a></li>
		
		
		   <li><a href="/tags">...<span>58</span></a></li>
		 
		</ul>
	</div>


		
			
<div class="widget">
  <h4>最新文章</h4>
  <ul class="entry list-unstyled">
    
      <li>
        <a href="/2021/10/12/appium自动化测试/" ><i class="fa fa-file-o"></i>appium自动化测试</a>
      </li>
    
      <li>
        <a href="/2021/07/30/deploy-a-nft-art-and-transfer-in-eth-testnet/" ><i class="fa fa-file-o"></i>deploy a nft art and transf...</a>
      </li>
    
      <li>
        <a href="/2021/07/01/记一次被钓鱼网站盗走eth的经历/" ><i class="fa fa-file-o"></i>记一次被钓鱼网站盗走eth的经历</a>
      </li>
    
      <li>
        <a href="/2021/06/25/Android-tablayout-viewpager2-fragment-你可能用错了/" ><i class="fa fa-file-o"></i>Android tablayout viewpager...</a>
      </li>
    
      <li>
        <a href="/2021/06/22/Android-中的单例模式/" ><i class="fa fa-file-o"></i>Android 中的单例模式</a>
      </li>
    
  </ul>
</div>

		
			
<div class="widget">
	<h4>链接</h4>
	<ul class="blogroll list-unstyled">
	
		<li><i class="false"></i><a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" title="" target="_blank"]);">hexo-theme-bithack</a></li>
	
	</ul>
</div>


		
	</div> <!-- sidebar -->
</div> <!-- col-md-3 -->

	
	
</div> <!-- row-fluid -->
	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2024 Weaver Li's Blog
  
      powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.Theme <a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" target="_blank">freemind.bithack</a>  
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
