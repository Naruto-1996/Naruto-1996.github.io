<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>第 2 页 | Weaver Li</title>
  <meta name="author" content="Weaver Li">
  
  <meta name="description" content="Time is money!">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Weaver Li"/>

  
    <meta property="og:image" content=""/>
  

  
    <link rel="alternative" href="/atom.xml" title="Weaver Li" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/prism.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70812759-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70812759-1');
</script>






<meta name="generator" content="Hexo 7.3.0"></head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">Weaver Li</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class=""></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class=""></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class=""></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class=""></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 <div class="page-header logo">
  <h1>Show Me The Code!<span class="blink-fast">|</span></h1>
</div>

<div class="row page">

	
	<div class="col-md-9">
	

		<div class="slogan">


		<i class="fa fa-heart blink-slow"></i>

		wubba lubba dub dub.

</div>    

		<div id="top_search"></div>
		<div class="mypage">
		
		<!-- title and entry -->
		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/03/19/ETH智能合约开发/" >ETH智能合约开发</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-03-19  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h2 id="ETH智能合约开发-vue-智能合约"><a href="#ETH智能合约开发-vue-智能合约" class="headerlink" title="ETH智能合约开发(vue + 智能合约)"></a>ETH智能合约开发(vue + 智能合约)</h2><h3 id="一、什么是ETH智能合约"><a href="#一、什么是ETH智能合约" class="headerlink" title="一、什么是ETH智能合约"></a>一、什么是ETH智能合约</h3><blockquote>
<p>说白了就是一段可以运行在以太坊平台上的代码，应用中，我们可以使用 Solidity 来编写和区块链交互的智能合约，<br>合约编写好之后，我们通过一个有余额的外部账户将合约部署到以太坊节点上，<br>并运行合约（使用 Truffle 框架可以更好的帮助我们做这些事情）</p>
</blockquote>
<h3 id="二、Truffle-和-ganache-cli-简介"><a href="#二、Truffle-和-ganache-cli-简介" class="headerlink" title="二、Truffle 和 ganache-cli 简介"></a>二、Truffle 和 ganache-cli 简介</h3><blockquote>
<p>Truffle Truffle是Dapp开发框架，他可以帮我们处理掉大量无关紧要的小事情，<br>让我们可以迅速开始写代码-编译-部署-测试-打包DApp这个流程。<br>Truffle是使用Nodejs开发的，我们首先需要安装Nodejs运行环境。</p>
</blockquote>
<blockquote>
<p>ganache-cli是以太坊节点仿真器软件ganache的命令行版本，可以方便开发者快速进行以太坊DApp的开发与测试。</p>
</blockquote>
<p>1、Truffle安装</p>
<p>查看node版本 没有安装node的请自行google安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Nodejs版本</span><br><span class="line">&gt; npm -v</span><br><span class="line">6.0.0</span><br><span class="line">&gt; node -v</span><br><span class="line">v8.9.4</span><br></pre></td></tr></table></figure>

<p>全局安装Truffle工具。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g truffle</span><br></pre></td></tr></table></figure>

<p>安装完成后查看命令行是否安装成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&gt; truffle</span><br><span class="line">Truffle v4.1.12 - a development framework for Ethereum</span><br><span class="line"></span><br><span class="line">Usage: truffle  [options]</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  init      Initialize new and empty Ethereum project</span><br><span class="line">  compile   Compile contract source files</span><br><span class="line">  migrate   Run migrations to deploy contracts</span><br><span class="line">  deploy    (alias for migrate)</span><br><span class="line">  build     Execute build pipeline (if configuration present)</span><br><span class="line">  test      Run JavaScript and Solidity tests</span><br><span class="line">  debug     Interactively debug any transaction on the blockchain (experimental)</span><br><span class="line">  opcode    Print the compiled opcodes for a given contract</span><br><span class="line">  console   Run a console with contract abstractions and commands available</span><br><span class="line">  develop   Open a console with a local development blockchain</span><br><span class="line">  create    Helper to create new contracts, migrations and tests</span><br><span class="line">  install   Install a package from the Ethereum Package Registry</span><br><span class="line">  publish   Publish a package to the Ethereum Package Registry</span><br><span class="line">  networks  Show addresses for deployed contracts on each network</span><br><span class="line">  watch     Watch filesystem for changes and rebuild the project automatically</span><br><span class="line">  serve     Serve the build directory on localhost and watch for changes</span><br><span class="line">  exec      Execute a JS module within this Truffle environment</span><br><span class="line">  unbox     Download a Truffle Box, a pre-built Truffle project</span><br><span class="line">  version   Show version number and exit</span><br><span class="line"></span><br><span class="line">See more at http://truffleframework.com/docs</span><br></pre></td></tr></table></figure>

<p>2、全局安装ganache-cli</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g ganache-cli</span><br></pre></td></tr></table></figure>

<h3 id="三、创建项目"><a href="#三、创建项目" class="headerlink" title="三、创建项目"></a>三、创建项目</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt; cd ~</span><br><span class="line">&gt; mkdir truffle-crowdfund</span><br><span class="line">&gt; cd truffle-crowdfund</span><br><span class="line"># 初始化项目</span><br><span class="line">&gt; truffle init</span><br><span class="line">Downloading...</span><br><span class="line">Unpacking...</span><br><span class="line">Setting up...</span><br><span class="line">Unbox successful. Sweet!</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line"></span><br><span class="line">  Compile:        truffle compile</span><br><span class="line">  Migrate:        truffle migrate</span><br><span class="line">  Test contracts: truffle test</span><br></pre></td></tr></table></figure>

<h3 id="四、启动测试节点"><a href="#四、启动测试节点" class="headerlink" title="四、启动测试节点"></a>四、启动测试节点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ganache-cli</span><br></pre></td></tr></table></figure>

<p>它会自动给我们生成10个带有100个eth的账户</p>
<h3 id="五、接下来写合约代码并部署到测试网络上"><a href="#五、接下来写合约代码并部署到测试网络上" class="headerlink" title="五、接下来写合约代码并部署到测试网络上"></a>五、接下来写合约代码并部署到测试网络上</h3><h4 id="需求："><a href="#需求：" class="headerlink" title="需求："></a>需求：</h4><blockquote>
<p>假设我准备出版一本区块练技术书籍，但是不确定有多少人愿意购买这本书，于是我发起了一个众筹， 如果在一个月内，<br>  能筹集到 10 个 ETH，我就进行写作，并给参与的读者每人赠送一本书，如果未能筹到足够的资金，<br>  参与的读者赎回之前投入的资金。<br>  同时，为了让读者积极参与，初始时，参与众筹的价格非常低（0.02 ETH），每筹集满 1 个 ETH 时，价格上涨 0.002ETH。<br>  归纳出合约三个对外动作（函数）：</p>
</blockquote>
<blockquote>
<p>1、汇款进合约，可通过实现合约的回退函数来实现。</p>
<p>2、读者赎回汇款，这个函数仅仅在众筹未达标之后，由读者本人调用生效。</p>
<p>3、创作者提取资金，这个函数需要在众筹达标之后，由创作者调用。</p>
</blockquote>
<blockquote>
<p>除此之外，还需要一个状态变量来保存以下状态：</p>
</blockquote>
<blockquote>
<p>1、用户众筹的金额，使用一个 mapping 来保存。</p>
<p>2、当前众筹的价格，以及一个相应的内部函数逐步上涨价格。价格可以使用一个 uint 来保存。</p>
<p>3、合约众筹的截止时间，用 uint 来保存， 在合约创建时往后追加 30 天，在构造函数中完成。</p>
<p>4、记录合约众筹的收益者，即创作者，在合约创建时在构造函数中进行赋值，合约创建者就是创作者。</p>
<p>5、再加入众筹状态，如果众筹停止阻止用户在参与。创作者提取资金时及时关闭众筹。</p>
</blockquote>
<h4 id="实现众筹合约"><a href="#实现众筹合约" class="headerlink" title="实现众筹合约"></a>实现众筹合约</h4><p>我们进入到上面使用<code>truffle init</code>命令创建的项目中去</p>
<p>在 contracts 下创建一个合约文件 Crowdfunding.sol:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity &gt;=0.4.21 &lt;0.7.0;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">contract Crowdfunding &#123;</span><br><span class="line">    // 创作者</span><br><span class="line">    address public author;</span><br><span class="line"></span><br><span class="line">    // 参与金额</span><br><span class="line">    mapping(address =&gt; uint) public joined;</span><br><span class="line"></span><br><span class="line">    // 众筹目标</span><br><span class="line">    uint constant Target = 10 ether;</span><br><span class="line"></span><br><span class="line">    // 众筹截止时间</span><br><span class="line">    uint public endTime;</span><br><span class="line"></span><br><span class="line">    // 记录当前众筹价格</span><br><span class="line">    uint public price  = 0.02 ether ;</span><br><span class="line"></span><br><span class="line">    // 作者提取资金之后，关闭众筹</span><br><span class="line">    bool public closed = false;</span><br><span class="line"></span><br><span class="line">    // 部署合约时调用，初始化作者以及众筹结束时间</span><br><span class="line">    constructor() public &#123;</span><br><span class="line">        author = msg.sender;</span><br><span class="line">        endTime = now + 30 days;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 更新价格，这是一个内部函数</span><br><span class="line">    function updatePrice() internal &#123;</span><br><span class="line">        uint rise = address(this).balance / 1 ether * 0.002 ether;</span><br><span class="line">        price = 0.02 ether + rise;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 用户向合约转账时 触发的回调函数</span><br><span class="line">    function () external payable &#123;</span><br><span class="line">        require(now &lt; endTime &amp;&amp; !closed  , &quot;众筹已结束&quot;);</span><br><span class="line">        require(joined[msg.sender] == 0 , &quot;你已经参与过众筹&quot;);</span><br><span class="line"></span><br><span class="line">        require (msg.value &gt;= price, &quot;出价太低了&quot;);</span><br><span class="line">        joined[msg.sender] = msg.value;</span><br><span class="line"></span><br><span class="line">        updatePrice();</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    // 作者提取资金</span><br><span class="line">    function withdrawFund() external &#123;</span><br><span class="line">        require(msg.sender == author, &quot;你不是作者&quot;);</span><br><span class="line">        require(address(this).balance &gt;= Target, &quot;未达到众筹目标&quot;);</span><br><span class="line">        closed = true;   </span><br><span class="line">        msg.sender.transfer(address(this).balance);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 读者赎回资金</span><br><span class="line">    function withdraw() external &#123;</span><br><span class="line">        require(now &gt; endTime, &quot;还未到众筹结束时间&quot;);</span><br><span class="line">        require(!closed, &quot;众筹达标，众筹资金已提取&quot;);</span><br><span class="line">        require(Target &gt; address(this).balance, &quot;众筹达标，你没法提取资金&quot;);</span><br><span class="line">        </span><br><span class="line">        msg.sender.transfer(joined[msg.sender]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>代码的介绍，在合约代码中，使用到了 Solidity 语言中的一些知识点：</p>
</blockquote>
<blockquote>
<p>ether : 这是货币单位<br>。<br>days : 这是时间单位，1 days 对应 1 天的秒数。</p>
<p>now : 这是一个 Solidity 的内置属性，用于获取当前的时间戳，单位是秒。</p>
<p>require : 如果条件不满足回退交易。</p>
<p>address.transfer(value) : 对某一个地址进行转账。</p>
<p>有关 Solidity 语言入门推荐大家使用官网课程 <a target="_blank" rel="noopener" href="https://cryptozombies.io/zh/course/">僵尸游戏</a></p>
</blockquote>
<h4 id="合约部署"><a href="#合约部署" class="headerlink" title="合约部署"></a>合约部署</h4><p>部署之前我们使用 <code>truffle compile</code> 命令来进行编译</p>
<p>之后，在 migrations 下创建一个部署脚本 2_crowfunding.js ，内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const crowd = artifacts.require(&quot;Crowdfunding&quot;);</span><br><span class="line"></span><br><span class="line">module.exports = function(deployer) &#123;</span><br><span class="line">  deployer.deploy(crowd);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>接下来你的文件目录应该是这样的:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">├── build</span><br><span class="line">│   └── contracts</span><br><span class="line">│       ├── CrowdFunding.json</span><br><span class="line">│       └── Migrations.json</span><br><span class="line">├── contracts</span><br><span class="line">│   ├── CrowdFunding.sol</span><br><span class="line">│   └── Migrations.sol</span><br><span class="line">├── migrations</span><br><span class="line">│   ├── 1_initial_migration.js</span><br><span class="line">│   └── 2_crowdfunding_migration.js</span><br><span class="line">├── test</span><br><span class="line">└── truffle-config.js</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>注意一下这个<code>1_initial_migration.js</code>文件和 <code>Migrations.sol</code>文件 这是我们在使用<code>truffle init</code>命令初始化项目时它为我们生成的文件 这两个文件是不能删除的否则会无法进行部署，我们在<code>migrations</code>文件夹下面创建的文件要按照 1_xxx.js, 2_xxx.js 在部署的时候是按照这个顺序进行的。</p>
<p>下面我们配置部署脚本<code>truffle-config.js</code></p>
<p>配置之前 我们还需要做一些事情：</p>
<p>1、注册infura获取PROJECT-ID</p>
<p><a target="_blank" rel="noopener" href="https://infura.io/">infura</a>是基于ETH的chain公共API服务，为开发者提供链上数据查询、交易广播等功能。</p>
<p>注册成功之后需要创建项目</p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210325100549.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210325100631.png"></p>
<p>项目名字是随便起的无所谓</p>
<p>项目创建完之后你就能看到PROJECT-ID了这个我们待会要用</p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210325100830.png"></p>
<p>2、我们还需要一个浏览器插件 <a target="_blank" rel="noopener" href="https://metamask.io/">MetaMask</a> 推荐大家使用Chrome浏览器 </p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210325101145.png"></p>
<p>按照步骤注册账户，并将助记词保存下来， 我们下面要用到</p>
<p>我们需要获取ETH，以为部署是要gas费的, 测试网络可以每天给我们5个ETH 这足够我们使用了</p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210325103044.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210325103155.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210325103316.png"></p>
<p>3、安装 <code>truffle-hdwallet-provider</code></p>
<p>由于需要将合约部署到测试网Ropsten，此过程需要部署者私钥进行签名再将数据进行广播，<br><code>truffle-hdwallet-provider</code>是truffle上提供交易离线签名的模块</p>
<p>注：必须在truffle框架的代码目录下安装，否则不生效</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; cd truffle-crowdfund</span><br><span class="line">&gt; npm install truffle-hdwallet-provider</span><br></pre></td></tr></table></figure>

<p>4、我们终于可以进行修改<code>truffle-config.js</code>部署脚本了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Use this file to configure your truffle project. It&#x27;s seeded with some</span><br><span class="line"> * common settings for different networks and features like migrations,</span><br><span class="line"> * compilation and testing. Uncomment the ones you need or modify</span><br><span class="line"> * them to suit your project as necessary.</span><br><span class="line"> *</span><br><span class="line"> * More information about configuration can be found at:</span><br><span class="line"> *</span><br><span class="line"> * trufflesuite.com/docs/advanced/configuration</span><br><span class="line"> *</span><br><span class="line"> * To deploy via Infura you&#x27;ll need a wallet provider (like @truffle/hdwallet-provider)</span><br><span class="line"> * to sign your transactions before they&#x27;re sent to a remote public node. Infura accounts</span><br><span class="line"> * are available for free at: infura.io/register.</span><br><span class="line"> *</span><br><span class="line"> * You&#x27;ll also need a mnemonic - the twelve word phrase the wallet uses to generate</span><br><span class="line"> * public/private key pairs. If you&#x27;re publishing your code to GitHub make sure you load this</span><br><span class="line"> * phrase from a file you&#x27;ve .gitignored so it doesn&#x27;t accidentally become public.</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">const HDWalletProvider = require(&#x27;truffle-hdwallet-provider&#x27;);</span><br><span class="line">// const infuraKey = &quot;fj4jll3k.....&quot;;</span><br><span class="line">//</span><br><span class="line">const fs = require(&#x27;fs&#x27;);</span><br><span class="line">const mnemonic = fs.readFileSync(&quot;.secret&quot;).toString().trim();</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  /**</span><br><span class="line">   * Networks define how you connect to your ethereum client and let you set the</span><br><span class="line">   * defaults web3 uses to send transactions. If you don&#x27;t specify one truffle</span><br><span class="line">   * will spin up a development blockchain for you on port 9545 when you</span><br><span class="line">   * run `develop` or `test`. You can ask a truffle command to use a specific</span><br><span class="line">   * network from the command line, e.g</span><br><span class="line">   *</span><br><span class="line">   * $ truffle test --network &lt;network-name&gt;</span><br><span class="line">   */</span><br><span class="line"></span><br><span class="line">  networks: &#123;</span><br><span class="line">    // Useful for testing. The `development` name is special - truffle uses it by default</span><br><span class="line">    // if it&#x27;s defined here and no other network is specified at the command line.</span><br><span class="line">    // You should run a client (like ganache-cli, geth or parity) in a separate terminal</span><br><span class="line">    // tab if you use this network and you must also set the `host`, `port` and `network_id`</span><br><span class="line">    // options below to some value.</span><br><span class="line">    //</span><br><span class="line">    mainnet: &#123;</span><br><span class="line">      provider: function () &#123;</span><br><span class="line">        // Setting the provider with the Infura Rinkeby address and Token</span><br><span class="line">        return new HDWalletProvider(mnemonic, &quot;https://mainnet.infura.io/v3/xxxx1cabc499dc5d569&quot;)</span><br><span class="line">      &#125;,</span><br><span class="line">      network_id: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    // development: &#123;</span><br><span class="line">    //  host: &quot;127.0.0.1&quot;,     // Localhost (default: none)</span><br><span class="line">    //  port: 8545,            // Standard Ethereum port (default: none)</span><br><span class="line">    //  network_id: &quot;*&quot;,       // Any network (default: none)</span><br><span class="line">    // &#125;,</span><br><span class="line">    // Another network with more advanced options...</span><br><span class="line">    // advanced: &#123;</span><br><span class="line">    // port: 8777,             // Custom port</span><br><span class="line">    // network_id: 1342,       // Custom network</span><br><span class="line">    // gas: 8500000,           // Gas sent with each transaction (default: ~6700000)</span><br><span class="line">    // gasPrice: 20000000000,  // 20 gwei (in wei) (default: 100 gwei)</span><br><span class="line">    // from: &lt;address&gt;,        // Account to send txs from (default: accounts[0])</span><br><span class="line">    // websocket: true        // Enable EventEmitter interface for web3 (default: false)</span><br><span class="line">    // &#125;,</span><br><span class="line">    // Useful for deploying to a public network.</span><br><span class="line">    // NB: It&#x27;s important to wrap the provider as a function.</span><br><span class="line">    ropsten: &#123;</span><br><span class="line">      provider: () =&gt; new HDWalletProvider(mnemonic, &quot;https://ropsten.infura.io/v3/xxxx1cabc499dc5d569&quot;),</span><br><span class="line">      network_id: 3,       // Ropsten&#x27;s id</span><br><span class="line">      gas: 5500000,        // Ropsten has a lower block limit than mainnet</span><br><span class="line">      confirmations: 2,    // # of confs to wait between deployments. (default: 0)</span><br><span class="line">      timeoutBlocks: 200,  // # of blocks before a deployment times out  (minimum/default: 50)</span><br><span class="line">      skipDryRun: true     // Skip dry run before migrations? (default: false for public nets )</span><br><span class="line">    &#125;,</span><br><span class="line">    // Useful for private networks</span><br><span class="line">    // private: &#123;</span><br><span class="line">    // provider: () =&gt; new HDWalletProvider(mnemonic, `https://network.io`),</span><br><span class="line">    // network_id: 2111,   // This network is yours, in the cloud.</span><br><span class="line">    // production: true    // Treats this network as if it was a public net. (default: false)</span><br><span class="line">    // &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  // Set default mocha options here, use special reporters etc.</span><br><span class="line">  mocha: &#123;</span><br><span class="line">    // timeout: 100000</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  // Configure your compilers</span><br><span class="line">  compilers: &#123;</span><br><span class="line">    solc: &#123;</span><br><span class="line">      // version: &quot;0.5.1&quot;,    // Fetch exact version from solc-bin (default: truffle&#x27;s version)</span><br><span class="line">      // docker: true,        // Use &quot;0.5.1&quot; you&#x27;ve installed locally with docker (default: false)</span><br><span class="line">      // settings: &#123;          // See the solidity docs for advice about optimization and evmVersion</span><br><span class="line">      //  optimizer: &#123;</span><br><span class="line">      //    enabled: false,</span><br><span class="line">      //    runs: 200</span><br><span class="line">      //  &#125;,</span><br><span class="line">      //  evmVersion: &quot;byzantium&quot;</span><br><span class="line">      // &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  // Truffle DB is currently disabled by default; to enable it, change enabled: false to enabled: true</span><br><span class="line">  //</span><br><span class="line">  // Note: if you migrated your contracts prior to enabling this field in your Truffle project and want</span><br><span class="line">  // those previously migrated contracts available in the .db directory, you will need to run the following:</span><br><span class="line">  // $ truffle migrate --reset --compile-all</span><br><span class="line"></span><br><span class="line">  db: &#123;</span><br><span class="line">    enabled: false</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>注意这几行 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const HDWalletProvider = require(&#x27;truffle-hdwallet-provider&#x27;);</span><br><span class="line">// const infuraKey = &quot;fj4jll3k.....&quot;;</span><br><span class="line">//</span><br><span class="line">const fs = require(&#x27;fs&#x27;);</span><br><span class="line">const mnemonic = fs.readFileSync(&quot;.secret&quot;).toString().trim();</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">ropsten: &#123;</span><br><span class="line">  provider: () =&gt; new HDWalletProvider(mnemonic, &quot;https://ropsten.infura.io/v3/xxxx1cabc499dc5d569&quot;),</span><br><span class="line">  network_id: 3,       // Ropsten&#x27;s id</span><br><span class="line">  gas: 5500000,        // Ropsten has a lower block limit than mainnet</span><br><span class="line">  confirmations: 2,    // # of confs to wait between deployments. (default: 0)</span><br><span class="line">  timeoutBlocks: 200,  // # of blocks before a deployment times out  (minimum/default: 50)</span><br><span class="line">  skipDryRun: true     // Skip dry run before migrations? (default: false for public nets )</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>这里我们用到了 助记词 和 PROJECT-ID 我这里是在项目的根目录下创建了一个<code>.secret</code>文件 把助记词放到了文件里, 这样比较好，<br>你也可以使用变量进行保存 <code>const infuraKey = &quot;fj4jll3k.....&quot;</code></p>
<p>5、部署到Ropsten测试网络</p>
<p>执行<code>truffle migrate --network ropsten</code> 即可部署至Ropsten</p>
<p>如需要重新编译所有合约，可执行<code>truffle migrate --network ropsten --reset --compile-all</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">Compiling your contracts...</span><br><span class="line">===========================</span><br><span class="line">&gt; Everything is up to date, there is nothing to compile.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Starting migrations...</span><br><span class="line">======================</span><br><span class="line">&gt; Network name:    &#x27;ropsten&#x27;</span><br><span class="line">&gt; Network id:      3</span><br><span class="line">&gt; Block gas limit: 8000000 (0x7a1200)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1_initial_migration.js</span><br><span class="line">======================</span><br><span class="line"></span><br><span class="line">   Deploying &#x27;Migrations&#x27;</span><br><span class="line">   ----------------------</span><br><span class="line">   &gt; transaction hash:    0xe27c86dc48219fa193d23843b301d6878a6820dcc93fd92a20e24d1ec9c49b31</span><br><span class="line">   &gt; Blocks: 3            Seconds: 14</span><br><span class="line">   &gt; contract address:    0x2e2982D9d1914b6580139Ec4E356B708478C875F</span><br><span class="line">   &gt; block number:        9898882</span><br><span class="line">   &gt; block timestamp:     1616554032</span><br><span class="line">   &gt; account:             0x270dF7D1f4612063abA065389b3fCbeF7993caA9</span><br><span class="line">   &gt; balance:             4.93502452</span><br><span class="line">   &gt; gas used:            193243 (0x2f2db)</span><br><span class="line">   &gt; gas price:           20 gwei</span><br><span class="line">   &gt; value sent:          0 ETH</span><br><span class="line">   &gt; total cost:          0.00386486 ETH</span><br><span class="line"></span><br><span class="line">   Pausing for 2 confirmations...</span><br><span class="line">   ------------------------------</span><br><span class="line">   &gt; confirmation number: 1 (block: 9898884)</span><br><span class="line">   &gt; confirmation number: 2 (block: 9898885)</span><br><span class="line"></span><br><span class="line">   &gt; Saving migration to chain.</span><br><span class="line">   &gt; Saving artifacts</span><br><span class="line">   -------------------------------------</span><br><span class="line">   &gt; Total cost:          0.00386486 ETH</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2_crowdfunding_migration.js</span><br><span class="line">===========================</span><br><span class="line"></span><br><span class="line">   Deploying &#x27;CrowdFunding&#x27;</span><br><span class="line">   ------------------------</span><br><span class="line">   &gt; transaction hash:    0x0f787b4d1567a00a8da4b28970632238fc50eb43ee7e33fb8d5c3d92fcbf5880</span><br><span class="line">   &gt; Blocks: 2            Seconds: 25</span><br><span class="line">   &gt; contract address:    0x3e32bF1e0Af404ed7DbCEf538BEba75ea2a76510</span><br><span class="line">   &gt; block number:        9898889</span><br><span class="line">   &gt; block timestamp:     1616554105</span><br><span class="line">   &gt; account:             0x270dF7D1f4612063abA065389b3fCbeF7993caA9</span><br><span class="line">   &gt; balance:             4.9224565</span><br><span class="line">   &gt; gas used:            582663 (0x8e407)</span><br><span class="line">   &gt; gas price:           20 gwei</span><br><span class="line">   &gt; value sent:          0 ETH</span><br><span class="line">   &gt; total cost:          0.01165326 ETH</span><br><span class="line"></span><br><span class="line">   Pausing for 2 confirmations...</span><br><span class="line">   ------------------------------</span><br><span class="line">   &gt; confirmation number: 1 (block: 9898890)</span><br><span class="line">   &gt; confirmation number: 2 (block: 9898891)</span><br><span class="line"></span><br><span class="line">   &gt; Saving migration to chain.</span><br><span class="line">   &gt; Saving artifacts</span><br><span class="line">   -------------------------------------</span><br><span class="line">   &gt; Total cost:          0.01165326 ETH</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Summary</span><br><span class="line">=======</span><br><span class="line">&gt; Total deployments:   2</span><br><span class="line">&gt; Final cost:          0.01551812 ETH</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="六、使用vue项目与合约进行交互"><a href="#六、使用vue项目与合约进行交互" class="headerlink" title="六、使用vue项目与合约进行交互"></a>六、使用vue项目与合约进行交互</h3><blockquote>
<p>利用 CrowdFund.vue 来众筹界面，众筹界面需要显示以下几个部分：</p>
</blockquote>
<blockquote>
<p> 1、当前众筹到金额。</p>
<p> 2、众筹的截止时间。</p>
<p> 3、当前众筹的价格，参与众筹按钮。</p>
<p> 4、如果是已经参与，显示其参与的价格以及赎回按钮。</p>
<p> 5、如果是创作者，显示一个提取资金按钮。</p>
</blockquote>
<p>1、 依然是创建一个vue项目</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue create crowd_funding_vue</span><br></pre></td></tr></table></figure>

<p>我们在components文件夹下创建一个<code>CrowdFunding.vue</code>文件 我们整个的<code>CrowdFunding.vue</code>文件就像是这样</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;content&quot;&gt;</span><br><span class="line">        &lt;h3&gt; 新书众筹&lt;/h3&gt;</span><br><span class="line">        &lt;span&gt;以最低的价格获取我的新书 &lt;/span&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div class=&quot;status&quot;&gt;</span><br><span class="line">            &lt;div v-if=&quot;!closed&quot;&gt;已众筹资金：&lt;b&gt;&#123;&#123; total &#125;&#125; ETH &lt;/b&gt;&lt;/div&gt;</span><br><span class="line">            &lt;div v-if=&quot;closed&quot;&gt; 众筹已完成&lt;/div&gt;</span><br><span class="line">            &lt;div&gt;众筹截止时间：&#123;&#123; endDate &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div v-if=&quot;joined&quot; class=&quot;card-bkg&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;award-des&quot;&gt;</span><br><span class="line">                &lt;span&gt; 参与价格 &lt;/span&gt;</span><br><span class="line">                &lt;b&gt; &#123;&#123; joinPrice &#125;&#125; ETH &lt;/b&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">            &lt;button :disabled=&quot;closed&quot; @click=&quot;withdraw&quot;&gt;赎回&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div v-if=&quot;!joined&quot; class=&quot;card-bkg&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;award-des&quot;&gt;</span><br><span class="line">                &lt;span&gt; 当前众筹价格 &lt;/span&gt;</span><br><span class="line">                &lt;b&gt; &#123;&#123; price &#125;&#125; ETH &lt;/b&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">            &lt;button :disabled=&quot;closed&quot; @click=&quot;join&quot;&gt;参与众筹&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div v-if=&quot;isAuthor&quot;&gt;</span><br><span class="line">            &lt;button :disabled=&quot;closed&quot; @click=&quot;withdrawFund&quot;&gt; 提取资金&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import contract from &quot;truffle-contract&quot;;</span><br><span class="line">    import crowd from &#x27;../../public/build/contracts/CrowdFunding.json&#x27;;</span><br><span class="line"></span><br><span class="line">    const Web3 = require(&#x27;web3&#x27;);</span><br><span class="line"></span><br><span class="line">    export default &#123;</span><br><span class="line">        name: &#x27;CrowdFund&#x27;,</span><br><span class="line">        // 定义上面HTML模板中使用的变量</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                price: null,</span><br><span class="line">                total: 0,</span><br><span class="line">                closed: true,</span><br><span class="line">                joinPrice: null,</span><br><span class="line">                joined: false,</span><br><span class="line">                endDate: &quot;null&quot;,</span><br><span class="line">                isAuthor: true,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        // 当前Vue组件被创建时回调的hook 函数</span><br><span class="line">        async created() &#123;</span><br><span class="line">            //  初始化 web3及账号</span><br><span class="line">            await this.initWeb3Account()</span><br><span class="line">            //  初始化合约实例</span><br><span class="line">            await this.initContract()</span><br><span class="line">            //  获取合约的状态信息</span><br><span class="line">            await this.getCrowdInfo()</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            async initWeb3Account() &#123;</span><br><span class="line">                console.log(&quot;initWeb3Account 方法执行了-------&quot;);</span><br><span class="line">                // 检查新版MetaMask</span><br><span class="line">                if (window.ethereum) &#123;</span><br><span class="line">                    this.provider = window.ethereum;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        // 请求用户账号授权</span><br><span class="line">                        await window.ethereum.enable();</span><br><span class="line">                    &#125; catch (error) &#123;</span><br><span class="line">                        // 用户拒绝了访问</span><br><span class="line">                        console.log(&quot;User denied account access&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                // 老版 MetaMask</span><br><span class="line">                else if (window.web3) &#123;</span><br><span class="line">                    this.provider = window.web3.currentProvider;</span><br><span class="line">                &#125;</span><br><span class="line">                // 如果没有注入的web3实例，回退到使用 Ganache</span><br><span class="line">                else &#123;</span><br><span class="line">                    alert(&quot;请安装MetaMask!&quot;);</span><br><span class="line">                     this.provider = new Web3.providers.HttpProvider(&quot;http://127.0.0.1:7545&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">                this.web3 = new Web3(this.provider);</span><br><span class="line">                this.web3.eth.getAccounts().then(accs =&gt; &#123;</span><br><span class="line">                    this.account = accs[0]</span><br><span class="line">                    console.log(accs)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">            async initContract() &#123;</span><br><span class="line">                const crowdContract = contract(crowd)</span><br><span class="line">                crowdContract.setProvider(this.provider)</span><br><span class="line">                this.crowdFund = await crowdContract.deployed()</span><br><span class="line">            &#125;,</span><br><span class="line">            async getCrowdInfo() &#123;</span><br><span class="line">                // 获取合约的余额</span><br><span class="line">                this.web3.eth.getBalance(this.crowdFund.address).then(</span><br><span class="line">                    r =&gt; &#123;</span><br><span class="line">                        this.total = this.web3.utils.fromWei(r)</span><br><span class="line">                    &#125;</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">                // 获取读者的参与金额</span><br><span class="line">                this.crowdFund.joined(this.account).then(</span><br><span class="line">                    r =&gt; &#123;</span><br><span class="line">                        if (r &gt; 0) &#123;</span><br><span class="line">                            this.joined = true</span><br><span class="line">                            this.joinPrice = this.web3.utils.fromWei(r)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">                // 获取合约的关闭状态</span><br><span class="line">                this.crowdFund.closed().then(</span><br><span class="line">                    r =&gt; this.closed = r</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">                // 获取当前的众筹价格</span><br><span class="line">                this.crowdFund.price().then(</span><br><span class="line">                    r =&gt; this.price = this.web3.utils.fromWei(r)</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">                // 获取众筹截止时间</span><br><span class="line">                this.crowdFund.endTime().then(r =&gt; &#123;</span><br><span class="line">                    var endTime = new Date(r * 1000)</span><br><span class="line">                    // 把时间戳转化为本地时间</span><br><span class="line">                    this.endDate = endTime.toLocaleDateString().replace(/\//g, &quot;-&quot;) + &quot; &quot; + endTime.toTimeString().substr(0, 8);</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">                // 获取众筹创作者地址</span><br><span class="line">                this.crowdFund.author().then(r =&gt; &#123;</span><br><span class="line">                    if (this.account === r) &#123;</span><br><span class="line">                        this.isAuthor = true</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        this.isAuthor = false</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">            // 读者参与众筹的 join()函数</span><br><span class="line">            join() &#123;</span><br><span class="line">                this.web3.eth.sendTransaction(&#123;</span><br><span class="line">                    from: this.account,</span><br><span class="line">                    to: this.crowdFund.address,</span><br><span class="line">                    value: this.web3.utils.toWei(this.price)</span><br><span class="line">                &#125;).then(() =&gt;</span><br><span class="line">                    this.getCrowdInfo()</span><br><span class="line">                )</span><br><span class="line">            &#125;,</span><br><span class="line">            // 读者赎回的 withdraw()函数</span><br><span class="line">            withdraw() &#123;</span><br><span class="line">                this.crowdFund.withdraw(&#123;</span><br><span class="line">                    from: this.account</span><br><span class="line">                &#125;).then(() =&gt; &#123;</span><br><span class="line">                    this.getCrowdInfo()</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">            // 创作者提取资金的 withdrawFund()函数</span><br><span class="line">            withdrawFund() &#123;</span><br><span class="line">                this.crowdFund.withdrawFund(&#123;</span><br><span class="line">                    from: this.account</span><br><span class="line">                &#125;).then(() =&gt; &#123;</span><br><span class="line">                    this.getCrowdInfo()</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>2、与合约进行交互</p>
<p>前端界面与合约进行交互时，需要使用到 <code>truffle-contract</code> 及 <code>web3</code> ，因为 Vue 工程本身也是通过 NPM 进行包管理，<br>因此可以直接通过 npm 进行安装，命令如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save truffle-contract web3</span><br></pre></td></tr></table></figure>

<p>如果创建vue项目的时候已经启动了vue项目 那么你需要重新启动一下vue项目 因为安装了包之后需要重新启动 这样使用import导入包的时候<br>才不会报错。</p>
<p>3、将智能合约项目编译产生的<code>build</code>文件夹放进vue项目中的<code>public</code>文件夹下 注意看上面的这句话</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import crowd from &#x27;../../public/build/contracts/CrowdFunding.json&#x27;;</span><br></pre></td></tr></table></figure>

<p>4、启动vue项目进行交互 看起来就像这样</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run serve</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210325105129.png"></p>
<h4 id="特别感谢一下博文"><a href="#特别感谢一下博文" class="headerlink" title="特别感谢一下博文"></a>特别感谢一下博文</h4><p>1、<a target="_blank" rel="noopener" href="https://learnblockchain.cn/2019/12/20/vue-dapp">如何使用Vue.js 开发以太坊DApp</a></p>
<p>2、<a target="_blank" rel="noopener" href="https://blog.csdn.net/u010159567/article/details/104895457">以太坊ETH-智能合约开发-solidity源码分析-truffle进阶</a></p>
<p>3、<a target="_blank" rel="noopener" href="https://blog.csdn.net/TurkeyCock/article/details/85103434">Infura：一键接入以太坊</a></p>
<p>4、<a target="_blank" rel="noopener" href="https://learnblockchain.cn/docs/truffle/getting-started/truffle-with-metamask.html">Truffle 和 MetaMask 配合</a></p>
<p>5、<a target="_blank" rel="noopener" href="https://www.chainnews.com/articles/823921189500.htm">详解 Truffle Migrations （迁移）- 合约部署不再困惑</a></p>
<p>6、<a target="_blank" rel="noopener" href="http://blog.hubwiz.com/2019/09/13/ethereum-dev-tools-2019/#%E6%96%B0%E6%89%8B%E5%85%A5%E9%97%A8">以太坊开发资源全面指南</a></p>

	
	</div>
  <a type="button" href="/2021/03/19/ETH智能合约开发/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/02/02/在linux服务器上安装Ruby-On-Rails/" >在linux服务器上安装Ruby_On_Rails</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-02-02  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h4 id="在linux服务器上安装Ruby-On-Rails"><a href="#在linux服务器上安装Ruby-On-Rails" class="headerlink" title="在linux服务器上安装Ruby On Rails"></a>在linux服务器上安装Ruby On Rails</h4><h5 id="1、安装rbenv"><a href="#1、安装rbenv" class="headerlink" title="1、安装rbenv"></a>1、安装rbenv</h5><p>先安装git</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># mac</span><br><span class="line">brew install git</span><br><span class="line"># centos</span><br><span class="line">yum install git</span><br><span class="line"># ubuntu</span><br><span class="line">apt-get install git</span><br></pre></td></tr></table></figure>

<p>然后安装rbenv</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 安装rbenv到~/.rbenv目录</span><br><span class="line">git clone git://github.com/sstephenson/rbenv.git ~/.rbenv</span><br></pre></td></tr></table></figure>

<p>下面安装一下rbenv的插件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 用来编译安装 ruby</span><br><span class="line">git clone git://github.com/sstephenson/ruby-build.git ~/.rbenv/plugins/ruby-build</span><br><span class="line"></span><br><span class="line"># 用来管理 gemset, 可选, 因为有 bundler 也没什么必要</span><br><span class="line">git clone git://github.com/jamis/rbenv-gemset.git  ~/.rbenv/plugins/rbenv-gemset</span><br><span class="line"></span><br><span class="line"># 通过 gem 命令安装完 gem 后无需手动输入 rbenv rehash 命令, 推荐</span><br><span class="line">git clone git://github.com/sstephenson/rbenv-gem-rehash.git ~/.rbenv/plugins/rbenv-gem-rehash</span><br><span class="line"></span><br><span class="line"># 通过 rbenv update 命令来更新 rbenv 以及所有插件, 推荐</span><br><span class="line">git clone git://github.com/rkh/rbenv-update.git ~/.rbenv/plugins/rbenv-update</span><br><span class="line"></span><br><span class="line"># 使用 Ruby China 的镜像安装 Ruby, 国内用户推荐</span><br><span class="line">git clone git://github.com/AndorChen/rbenv-china-mirror.git ~/.rbenv/plugins/rbenv-china-mirror</span><br></pre></td></tr></table></figure>

<p>然后需要将下面两句代码放在bash的配置文件中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export PATH=&quot;$HOME/.rbenv/bin:$PATH&quot;</span><br><span class="line">eval &quot;$(rbenv init -)&quot;</span><br></pre></td></tr></table></figure>

<p>linux是一般是放在<del>&#x2F;.bashrc中，mac是放在</del>&#x2F;.bash_profile中</p>
<p>修改完成后，执行下面的命令使其生效</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># linux</span><br><span class="line">source ~/.bashrc</span><br><span class="line"># mac</span><br><span class="line">source ~/.bash_profile</span><br></pre></td></tr></table></figure>

<h4 id="2、安装ruby"><a href="#2、安装ruby" class="headerlink" title="2、安装ruby"></a>2、安装ruby</h4><p>rbenv install –list  # 列出所有 ruby 版本</p>
<p>例如安装2.7.2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rbenv install 2.7.2</span><br></pre></td></tr></table></figure>

<p>设置使用的ruby版本, 有以下三种设置方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rbenv global 2.3.3      # 默认使用2.3.3</span><br><span class="line">rbenv shell 2.3.3       # 当前的 shell 使用2.3.3, 会设置一个 `RBENV_VERSION` 环境变量</span><br><span class="line">rbenv local 2.3.3      # 当前目录使用2.3.3, 会生成一个 `.rbenv-version` 文件</span><br></pre></td></tr></table></figure>

<h4 id="3-安装rails"><a href="#3-安装rails" class="headerlink" title="3. 安装rails"></a>3. 安装rails</h4><p>设置ruby版本后，安装rails：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 在当前的ruby版本中安装rails</span><br><span class="line">gem install rails</span><br></pre></td></tr></table></figure>

<p>好了，这样就完成了rails的安装，rails已经可以使用了，但是为了更好的使用，请继续看后面的教程。</p>
<h3 id="配置RubyGems镜像"><a href="#配置RubyGems镜像" class="headerlink" title="配置RubyGems镜像"></a>配置RubyGems镜像</h3><p>gem是ruby管理依赖包的工具，而RubyGems的默认地址因为万恶的墙的关系很难访问到，因此需要配置RubyGems 镜像。这里使用的是<a target="_blank" rel="noopener" href="https://gems.ruby-china.com/">Ruby China</a>的镜像地址</p>
<p>命令行输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem sources --add https://gems.ruby-china.com/ --remove https://rubygems.org/</span><br></pre></td></tr></table></figure>

<p>可以通过下面这个命令查看设置的结果是不是<a href="https://gems.ruby-china.com：">https://gems.ruby-china.com：</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem sources -l</span><br></pre></td></tr></table></figure>

<h3 id="修改bundle的源地址"><a href="#修改bundle的源地址" class="headerlink" title="修改bundle的源地址"></a>修改bundle的源地址</h3><p>bundler是rails管理gem依赖的工具，同样的，也需要修改其地址为ruby china的镜像</p>
<p>命令行输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bundle config mirror.https://rubygems.org https://gems.ruby-china.com</span><br></pre></td></tr></table></figure>
	
	</div>
  <a type="button" href="/2021/02/02/在linux服务器上安装Ruby-On-Rails/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/02/02/ubuntu下安装redis/" >ubuntu下安装redis</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-02-02  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h4 id="ubuntu下安装redis"><a href="#ubuntu下安装redis" class="headerlink" title="ubuntu下安装redis"></a>ubuntu下安装redis</h4><h5 id="1、使用apt安装"><a href="#1、使用apt安装" class="headerlink" title="1、使用apt安装"></a>1、使用apt安装</h5><p>在 Ubuntu 系统安装 Redi 可以使用以下命令:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$sudo apt-get update</span><br><span class="line">$sudo apt-get install redis-server</span><br></pre></td></tr></table></figure>

<h5 id="2、启动redis"><a href="#2、启动redis" class="headerlink" title="2、启动redis"></a>2、启动redis</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ redis-server</span><br></pre></td></tr></table></figure>

<h5 id="3、查看-redis-是否启动？"><a href="#3、查看-redis-是否启动？" class="headerlink" title="3、查看 redis 是否启动？"></a>3、查看 redis 是否启动？</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli</span><br></pre></td></tr></table></figure>

<p>以上命令将打开以下终端：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>

<p>127.0.0.1 是本机 IP ，6379 是 redis 服务端口。现在我们输入 PING 命令。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; ping PONG</span><br></pre></td></tr></table></figure>

	
	</div>
  <a type="button" href="/2021/02/02/ubuntu下安装redis/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/02/02/ubuntu下安装mysql/" >ubuntu下安装mysql</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-02-02  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h4 id="ubuntu下安装mysql"><a href="#ubuntu下安装mysql" class="headerlink" title="ubuntu下安装mysql"></a>ubuntu下安装mysql</h4><blockquote>
<p>MySQL 的安装比较简单，只需要简单的几步就可以搞定，但它的一些配置却比较繁琐。下面以 Ubuntu 18.04（其他版本类似）为例，详细介绍 MySQL 数据库的安装和配置。</p>
</blockquote>
<h5 id="1、安装mysql"><a href="#1、安装mysql" class="headerlink" title="1、安装mysql"></a>1、安装mysql</h5><p>在 Ubuntu 中，默认只有最新版本的 MySQL 包含在 APT 软件包存储库中。</p>
<p>要安装它，需要使用 apt 更新服务器上的软件包索引：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt update</span><br></pre></td></tr></table></figure>

<p>然后安装默认的 MySQL 软件包：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install mysql-server</span><br></pre></td></tr></table></figure>

<p>这一步不会进行一些配置相关的提示（例如：设置密码），因为会使 MySQL 的安装不安全，我们将在下一步解决该问题。</p>
<h5 id="2、配置mysql"><a href="#2、配置mysql" class="headerlink" title="2、配置mysql"></a>2、配置mysql</h5><p>在安装完 MySQL 之后，应该运行一下包含的安全脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mysql_secure_installation</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210202115006.png"></p>
<p>重点说一下第一个提示，这会询问我们是否愿意设置验证密码插件，该插件可用于测试 MySQL 密码的强度。</p>
<h5 id="3、更改用户验证方式"><a href="#3、更改用户验证方式" class="headerlink" title="3、更改用户验证方式"></a>3、更改用户验证方式</h5><p>虽然上面设置了 root 用户的密码，但当通过 MySQL 终端登录时，并不能通过密码进行认证：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -u root -p</span><br><span class="line">Enter password:</span><br><span class="line">ERROR 1698 (28000): Access denied for user &#x27;root&#x27;@&#x27;localhost&#x27;</span><br></pre></td></tr></table></figure>

<p>这是因为在 MySQL 5.7 及之后的版本中，root 用户被默认设置为通过 auth_socket 插件（而非密码）认证，其主要原因是出于对数据库的安全性考虑。</p>
<p>话虽如此，但偶尔也需要外部程序来访问，这时就会很麻烦了。为了使 root 用户能通过密码方式连接 MySQL，先通过终端打开 MySQL 的提示符：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mysql</span><br></pre></td></tr></table></figure>

<p>然后通过如下命令，检查 MySQL 中每个用户的认证方式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT user, authentication_string, plugin, host FROM mysql.user;</span><br><span class="line">+------------------+-------------------------------------------+-----------------------+-----------+</span><br><span class="line">| user             | authentication_string                     | plugin                | host      |</span><br><span class="line">+------------------+-------------------------------------------+-----------------------+-----------+</span><br><span class="line">| root             |                                           | auth_socket           | localhost |</span><br><span class="line">| mysql.session    | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | mysql_native_password | localhost |</span><br><span class="line">| mysql.sys        | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | mysql_native_password | localhost |</span><br><span class="line">| debian-sys-maint | *ABA968D18E3A0B6DEB02F9D5FBDA21415A86977B | mysql_native_password | localhost |</span><br><span class="line">+------------------+-------------------------------------------+-----------------------+-----------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>显而易见，root 用户的认证方式是 auth_socket。现在运行如下命令，将认证方式更改为密码认证（即：mysql_native_password）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;123456&#x27;;</span><br></pre></td></tr></table></figure>

<p>可以看到，已经修改成功了，现在退出数据库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; exit</span><br></pre></td></tr></table></figure>

<p>再来尝试一下，让 root 用户以密码形式登录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -u root -p</span><br><span class="line">Enter password:</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 7</span><br><span class="line">Server version: 5.7.29-0ubuntu0.18.04.1 (Ubuntu)</span><br><span class="line"> </span><br><span class="line">Copyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"> </span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"> </span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"> </span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<h5 id="4、配置远程访问"><a href="#4、配置远程访问" class="headerlink" title="4、配置远程访问"></a>4、配置远程访问</h5><p>默认情况下，MySQL 只监听本地主机（localhost）的连接。若要启用远程连接，需要进行以下配置。</p>
<ol>
<li>编辑 MySQL 的 mysqld.cnf 配置文件：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf</span><br></pre></td></tr></table></figure>

<p>注释掉下面这行配置并保存退出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bind-address          = 127.0.0.1</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>更改 user 表中的 host 项，将“localhost”改称“%”（表示所有用户都可以访问），并给 root 用户授权：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ mysql -u root -p</span><br><span class="line"> </span><br><span class="line">mysql&gt; use mysql;</span><br><span class="line">mysql&gt;</span><br><span class="line">mysql&gt; update user set host = &#x27;%&#x27; where user = &#x27;root&#x27;;</span><br><span class="line">mysql&gt;</span><br><span class="line">mysql&gt; grant all on *.* to root@&#x27;%&#x27; identified by &#x27;123456&#x27; with grant option;</span><br><span class="line">mysql&gt;</span><br><span class="line">mysql&gt; flush privileges;  # 刷新权限</span><br><span class="line">mysql&gt;</span><br><span class="line">mysql&gt; exit</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>执行如下命令，重启 mysql 服务：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl restart mysql</span><br></pre></td></tr></table></figure>

<p>现在，就可以远程连接（下图为 Navicat 截图） MySQl 数据库了：</p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210202120829.png"></p>

	
	</div>
  <a type="button" href="/2021/02/02/ubuntu下安装mysql/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/02/02/ubuntu下彻底卸载mysql/" >ubuntu下彻底卸载mysql</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-02-02  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h4 id="Ubuntu下彻底卸载mysql"><a href="#Ubuntu下彻底卸载mysql" class="headerlink" title="Ubuntu下彻底卸载mysql"></a>Ubuntu下彻底卸载mysql</h4><blockquote>
<p>采用sudo apt install mysql-server命令的方式默认安装的是MySQL5.7，MySQL5.7版本最高只适配到Ubuntu17.04，<br>不支持Ubuntu18.04，MySQL8.0可适配到Ubuntu18.04故如果系统使用的Ubuntu18.04，<br>只能安装MySQL8.0，而且加密方式需要选择5.x的加密，因为有兼容性问题，如果你已经执行了上边的命令，安装了MySQL5.7，需要先卸载。</p>
</blockquote>
<h5 id="1、首先在系统终端中查看MySQL的依赖项，运行命令：dpkg-list-grep-mysql"><a href="#1、首先在系统终端中查看MySQL的依赖项，运行命令：dpkg-list-grep-mysql" class="headerlink" title="1、首先在系统终端中查看MySQL的依赖项，运行命令：dpkg --list|grep mysql"></a>1、首先在系统终端中查看MySQL的依赖项，运行命令：<code>dpkg --list|grep mysql</code></h5><p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210202093257.png"></p>
<h5 id="2、卸载-sudo-apt-get-remove-mysql-common"><a href="#2、卸载-sudo-apt-get-remove-mysql-common" class="headerlink" title="2、卸载 sudo apt-get remove mysql-common"></a>2、卸载 <code>sudo apt-get remove mysql-common</code></h5><p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210202093512.png"></p>
<p>卸载 <code>sudo apt-get autoremove --purge mysql-server-5.7</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210202093713.png"></p>
<h4 id="3、清除残留数据，运行命令：dpkg-l-grep-rc-awk-print-2-sudo-xargs-dpkg-P"><a href="#3、清除残留数据，运行命令：dpkg-l-grep-rc-awk-print-2-sudo-xargs-dpkg-P" class="headerlink" title="3、清除残留数据，运行命令：dpkg -l|grep ^rc|awk &#39;{print$2}&#39;|sudo xargs dpkg -P"></a>3、清除残留数据，运行命令：<code>dpkg -l|grep ^rc|awk &#39;&#123;print$2&#125;&#39;|sudo xargs dpkg -P</code></h4><p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20210202093832.png"></p>
<h4 id="4、再次查看MySQL的剩余依赖项，运行命令：dpkg-list-grep-mysql"><a href="#4、再次查看MySQL的剩余依赖项，运行命令：dpkg-list-grep-mysql" class="headerlink" title="4、再次查看MySQL的剩余依赖项，运行命令：dpkg --list|grep mysql"></a>4、再次查看MySQL的剩余依赖项，运行命令：<code>dpkg --list|grep mysql</code></h4><blockquote>
<p> 如果还有依赖项 就继续删除剩余依赖项，比如：sudo apt-get autoremove –purge mysql-apt-config<br> 如果没有那就表示删除干净了</p>
</blockquote>

	
	</div>
  <a type="button" href="/2021/02/02/ubuntu下彻底卸载mysql/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2020/12/30/搭建服务器ubuntu系统/" >搭建服务器ubuntu系统</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2020-12-30  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h4 id="购买完服务器后应该做哪些配置"><a href="#购买完服务器后应该做哪些配置" class="headerlink" title="购买完服务器后应该做哪些配置"></a>购买完服务器后应该做哪些配置</h4><h5 id="一-、安装apache"><a href="#一-、安装apache" class="headerlink" title="一 、安装apache"></a>一 、安装apache</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install apche2 apche2-doc</span><br></pre></td></tr></table></figure>

<p>如果你已经安装完了nginx，你需要安装一个这个东西，当你在浏览器地址栏输入服务器公网ip的时候就会出现一个nginx的默认页面 就像这样的</p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20201230160621.png"></p>
<h5 id="二、安装mysql"><a href="#二、安装mysql" class="headerlink" title="二、安装mysql"></a>二、安装mysql</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install mysql-server mysql-client</span><br></pre></td></tr></table></figure>

<p>在安装mysql的时候可能会提醒设置root账户密码</p>
<h5 id="三、更改默认python版本："><a href="#三、更改默认python版本：" class="headerlink" title="三、更改默认python版本："></a>三、更改默认python版本：</h5><p>修改软连接</p>
<p>1、进入到usr&#x2F;bin目录下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/bin</span><br></pre></td></tr></table></figure>

<p>2、查看该目录下与python有关的项</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -altrh | grep python</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20201230174310.png"></p>
<p>3、删除软连接并指向新的版本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo rm python</span><br><span class="line">sudo ln -s python3.6 python</span><br></pre></td></tr></table></figure>

<p>4、最后结果</p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20201230174848.png"></p>

	
	</div>
  <a type="button" href="/2020/12/30/搭建服务器ubuntu系统/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2020/12/18/Android一些常用的背景图/" >Android一些常用的背景图</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2020-12-18  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h4 id="Android中一些常用的xml背景图"><a href="#Android中一些常用的xml背景图" class="headerlink" title="Android中一些常用的xml背景图"></a>Android中一些常用的xml背景图</h4><h5 id="1、绿色背景-圆角为4dp的xml背景-颜色可自行修改"><a href="#1、绿色背景-圆角为4dp的xml背景-颜色可自行修改" class="headerlink" title="1、绿色背景 圆角为4dp的xml背景(颜色可自行修改)"></a>1、绿色背景 圆角为4dp的xml背景(颜色可自行修改)</h5><p>res&#x2F;drawable 目录下 common_bg_4_radius_green.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:shape</span>=<span class="string">&quot;rectangle&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">&quot;@color/绿色&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">corners</span> <span class="attr">android:radius</span>=<span class="string">&quot;4dp&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20201218170312.png"></p>
<h5 id="2、绿色border边框背景"><a href="#2、绿色border边框背景" class="headerlink" title="2、绿色border边框背景"></a>2、绿色border边框背景</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">android:shape</span>=<span class="string">&quot;rectangle&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">stroke</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:width</span>=<span class="string">&quot;0.6dp&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:color</span>=<span class="string">&quot;@color/绿色&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">corners</span> <span class="attr">android:radius</span>=<span class="string">&quot;2dp&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20201218170216.png"></p>
<h5 id="3、背景为圆形"><a href="#3、背景为圆形" class="headerlink" title="3、背景为圆形"></a>3、背景为圆形</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:shape</span>=<span class="string">&quot;oval&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">&quot;@color/绿色&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">corners</span> <span class="attr">android:radius</span>=<span class="string">&quot;8.3dp&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">size</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:width</span>=<span class="string">&quot;17dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:height</span>=<span class="string">&quot;17dp&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20201218170648.png"></p>

	
	</div>
  <a type="button" href="/2020/12/18/Android一些常用的背景图/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2020/12/18/Android自定义EditText一键清除和密文查看/" >Android自定义EditText一键清除和密文查看</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2020-12-18  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h4 id="Android自定义EditText一键清除和密文查看"><a href="#Android自定义EditText一键清除和密文查看" class="headerlink" title="Android自定义EditText一键清除和密文查看"></a>Android自定义EditText一键清除和密文查看</h4><ul>
<li>先上截屏看一下效果<br><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/S01218-16245606.jpg"></li>
</ul>
<h5 id="自定义步骤"><a href="#自定义步骤" class="headerlink" title="自定义步骤"></a>自定义步骤</h5><h5 id="1、首先新建一个类PowerfulEditText-java-我放在了widgets目录中这个目录平时就用来存放一些自定义的类"><a href="#1、首先新建一个类PowerfulEditText-java-我放在了widgets目录中这个目录平时就用来存放一些自定义的类" class="headerlink" title="1、首先新建一个类PowerfulEditText.java 我放在了widgets目录中这个目录平时就用来存放一些自定义的类"></a>1、首先新建一个类PowerfulEditText.java 我放在了widgets目录中这个目录平时就用来存放一些自定义的类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//  这个自定义EditText 有两个按钮 一键清空按钮 和 小眼睛查看明文</span></span><br><span class="line"><span class="comment">//  isPassword 字段会根据输入框是否是密码框来决定是否会绘制小眼睛 很好用</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PowerfulEditText</span> <span class="keyword">extends</span> <span class="title class_">androidx</span>.appcompat.widget.AppCompatEditText &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TAG</span> <span class="operator">=</span> <span class="string">&quot;PowerfulEditText.java&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_CLEAR_RES</span> <span class="operator">=</span> R.drawable.delete_edit;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_VISIBLE_RES</span> <span class="operator">=</span> R.drawable.black_open_eyes;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_INVISIBLE_RES</span> <span class="operator">=</span> R.drawable.black_close_eyes;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_STYLE_COLOR</span> <span class="operator">=</span> Color.BLUE;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_BUTTON_PADDING</span> <span class="operator">=</span></span><br><span class="line">    getResources().getDimensionPixelSize(R.dimen.btn_edit_text_padding);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_BUTTON_WIDTH</span> <span class="operator">=</span></span><br><span class="line">    getResources().getDimensionPixelSize(R.dimen.btn_edit_text_width);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">STYLE_RECT</span> <span class="operator">=</span> <span class="string">&quot;rectangle&quot;</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">STYLE_ROUND_RECT</span> <span class="operator">=</span> <span class="string">&quot;roundRect&quot;</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">STYLE_HALF_RECT</span> <span class="operator">=</span> <span class="string">&quot;halfRect&quot;</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">STYLE_ANIMATOR</span> <span class="operator">=</span> <span class="string">&quot;animator&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_ROUND_RADIUS</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ANIMATOR_TIME</span> <span class="operator">=</span> <span class="number">200</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_FOCUSED_STROKE_WIDTH</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_UNFOCUSED_STROKE_WIDTH</span> <span class="operator">=</span> <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//按钮间隔</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> <span class="variable">mBtnPadding</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">  <span class="comment">//按钮宽度</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> <span class="variable">mBtnWidth</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">  <span class="comment">//右内边距</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> mTextPaddingRight;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> <span class="variable">mClearResId</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> <span class="variable">mVisibleResId</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> <span class="variable">mInvisibleResId</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">private</span> Bitmap mBitmapClear;</span><br><span class="line">  <span class="keyword">private</span> Bitmap mBitmapVisible;</span><br><span class="line">  <span class="keyword">private</span> Bitmap mBitmapInvisible;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="type">String</span> <span class="variable">mBorderStyle</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> <span class="variable">mStyleColor</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//出现和消失动画</span></span><br><span class="line">  <span class="keyword">private</span> ValueAnimator mGoneAnimator;</span><br><span class="line">  <span class="keyword">private</span> ValueAnimator mVisibleAnimator;</span><br><span class="line">  <span class="comment">//状态值</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">isBtnVisible</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="comment">// isPassword 字段会根据输入框是否是密码框来决定是否会绘制小眼睛</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">isPassword</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">isPasswordVisible</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">isAnimatorRunning</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> <span class="variable">mAnimatorProgress</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">private</span> ObjectAnimator mAnimator;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//自定义属性动画</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Property&lt;PowerfulEditText, Integer&gt; BORDER_PROGRESS</span><br><span class="line">    = <span class="keyword">new</span> <span class="title class_">Property</span>&lt;PowerfulEditText, Integer&gt;(Integer.class, <span class="string">&quot;borderProgress&quot;</span>) &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">get</span><span class="params">(PowerfulEditText powerfulEditText)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> powerfulEditText.getBorderProgress();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(PowerfulEditText powerfulEditText, Integer value)</span> &#123;</span><br><span class="line">      powerfulEditText.setBorderProgress(value);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Paint mPaint;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">PowerfulEditText</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>(context, <span class="literal">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">PowerfulEditText</span><span class="params">(Context context, <span class="meta">@Nullable</span> AttributeSet attrs)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(context, attrs);</span><br><span class="line">    init(context, attrs);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">PowerfulEditText</span><span class="params">(Context context, <span class="meta">@Nullable</span> AttributeSet attrs, <span class="type">int</span> defStyleAttr)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">    init(context, attrs);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(Context context, AttributeSet attrs)</span> &#123;</span><br><span class="line">    <span class="comment">//抗锯齿和位图滤波</span></span><br><span class="line">    mPaint = <span class="keyword">new</span> <span class="title class_">Paint</span>(Paint.ANTI_ALIAS_FLAG | Paint.FILTER_BITMAP_FLAG);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//读取xml文件中的配置</span></span><br><span class="line">    <span class="keyword">if</span> (attrs != <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="type">TypedArray</span> <span class="variable">array</span> <span class="operator">=</span> context.obtainStyledAttributes(attrs, R.styleable.PowerfulEditText);</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; array.getIndexCount(); i++) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">attr</span> <span class="operator">=</span> array.getIndex(i);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (attr) &#123;</span><br><span class="line">          <span class="keyword">case</span> R.styleable.PowerfulEditText_clearDrawable:</span><br><span class="line">            mClearResId = array.getResourceId(attr, DEFAULT_CLEAR_RES);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> R.styleable.PowerfulEditText_visibleDrawable:</span><br><span class="line">            mVisibleResId = array.getResourceId(attr, DEFAULT_VISIBLE_RES);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> R.styleable.PowerfulEditText_invisibleDrawable:</span><br><span class="line">            mInvisibleResId = array.getResourceId(attr, DEFAULT_INVISIBLE_RES);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> R.styleable.PowerfulEditText_BtnWidth:</span><br><span class="line">            mBtnWidth = array.getDimensionPixelSize(attr, DEFAULT_BUTTON_WIDTH);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> R.styleable.PowerfulEditText_BtnSpacing:</span><br><span class="line">            mBtnPadding = array.getDimensionPixelSize(attr, DEFAULT_BUTTON_PADDING);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> R.styleable.PowerfulEditText_borderStyle:</span><br><span class="line">            mBorderStyle = array.getString(attr);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> R.styleable.PowerfulEditText_styleColor:</span><br><span class="line">            mStyleColor = array.getColor(attr, DEFAULT_STYLE_COLOR);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      array.recycle();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//初始化按钮显示的Bitmap</span></span><br><span class="line">    mBitmapClear = createBitmap(context, mClearResId, DEFAULT_CLEAR_RES);</span><br><span class="line">    mBitmapVisible = createBitmap(context, mVisibleResId, DEFAULT_VISIBLE_RES);</span><br><span class="line">    mBitmapInvisible = createBitmap(context, mInvisibleResId, DEFAULT_INVISIBLE_RES);</span><br><span class="line">    <span class="comment">//如果自定义，则使用自定义的值，否则使用默认值</span></span><br><span class="line">    <span class="keyword">if</span> (mBtnPadding == <span class="number">0</span>) &#123;</span><br><span class="line">      mBtnPadding = DEFAULT_BUTTON_PADDING;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mBtnWidth == <span class="number">0</span>) &#123;</span><br><span class="line">      mBtnWidth = DEFAULT_BUTTON_WIDTH;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//给文字设置一个padding，避免文字和按钮重叠了</span></span><br><span class="line">    mTextPaddingRight = mBtnPadding * <span class="number">4</span> + mBtnWidth * <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//按钮出现和消失的动画</span></span><br><span class="line">    mGoneAnimator = ValueAnimator.ofFloat(<span class="number">1f</span>, <span class="number">0f</span>).setDuration(ANIMATOR_TIME);</span><br><span class="line">    mVisibleAnimator = ValueAnimator.ofFloat(<span class="number">0f</span>, <span class="number">1f</span>).setDuration(ANIMATOR_TIME);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//是否是密码样式</span></span><br><span class="line">    isPassword =</span><br><span class="line">      getInputType() == (InputType.TYPE_TEXT_VARIATION_PASSWORD | InputType.TYPE_CLASS_TEXT);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onMeasure</span><span class="params">(<span class="type">int</span> widthMeasureSpec, <span class="type">int</span> heightMeasureSpec)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置右内边距, 防止清除按钮和文字重叠</span></span><br><span class="line">    setPadding(getPaddingLeft(), getPaddingTop(), mTextPaddingRight, getPaddingBottom());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onDraw</span><span class="params">(Canvas canvas)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onDraw(canvas);</span><br><span class="line"></span><br><span class="line">    mPaint.setStyle(Paint.Style.STROKE);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用自定义颜色。如未定义，则使用默认颜色</span></span><br><span class="line">    <span class="keyword">if</span> (mStyleColor != -<span class="number">1</span>) &#123;</span><br><span class="line">      mPaint.setColor(mStyleColor);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      mPaint.setColor(DEFAULT_STYLE_COLOR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//控件获取焦点时，加粗边框</span></span><br><span class="line">    <span class="keyword">if</span> (isFocused()) &#123;</span><br><span class="line">      mPaint.setStrokeWidth(DEFAULT_FOCUSED_STROKE_WIDTH);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      mPaint.setStrokeWidth(DEFAULT_UNFOCUSED_STROKE_WIDTH);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//绘制边框</span></span><br><span class="line">    drawBorder(canvas);</span><br><span class="line">    <span class="comment">//绘制清空和明文显示按钮</span></span><br><span class="line">    drawButtons(canvas);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">drawBorder</span><span class="params">(Canvas canvas)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">width</span> <span class="operator">=</span> getWidth();</span><br><span class="line">    <span class="type">int</span> <span class="variable">height</span> <span class="operator">=</span> getHeight();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (mBorderStyle) &#123;</span><br><span class="line">      <span class="comment">//矩形样式</span></span><br><span class="line">      <span class="keyword">case</span> STYLE_RECT:</span><br><span class="line">        setBackground(<span class="literal">null</span>);</span><br><span class="line">        canvas.drawRect(<span class="number">0</span>, <span class="number">0</span>, width, height, mPaint);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//圆角矩形样式</span></span><br><span class="line">      <span class="keyword">case</span> STYLE_ROUND_RECT:</span><br><span class="line">        setBackground(<span class="literal">null</span>);</span><br><span class="line">        <span class="type">float</span> <span class="variable">roundRectLineWidth</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (isFocused()) &#123;</span><br><span class="line">          roundRectLineWidth = DEFAULT_FOCUSED_STROKE_WIDTH / <span class="number">2</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          roundRectLineWidth = DEFAULT_UNFOCUSED_STROKE_WIDTH / <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        mPaint.setStrokeWidth(roundRectLineWidth);</span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="number">21</span>) &#123;</span><br><span class="line">          canvas.drawRoundRect(</span><br><span class="line">            roundRectLineWidth / <span class="number">2</span>, roundRectLineWidth / <span class="number">2</span>, width - roundRectLineWidth / <span class="number">2</span>, height - roundRectLineWidth / <span class="number">2</span>,</span><br><span class="line">            DEFAULT_ROUND_RADIUS, DEFAULT_ROUND_RADIUS,</span><br><span class="line">            mPaint);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          canvas.drawRoundRect(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">RectF</span>(roundRectLineWidth / <span class="number">2</span>, roundRectLineWidth / <span class="number">2</span>, width - roundRectLineWidth / <span class="number">2</span>, height - roundRectLineWidth / <span class="number">2</span>),</span><br><span class="line">            DEFAULT_ROUND_RADIUS, DEFAULT_ROUND_RADIUS,</span><br><span class="line">            mPaint);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//半矩形样式</span></span><br><span class="line">      <span class="keyword">case</span> STYLE_HALF_RECT:</span><br><span class="line">        setBackground(<span class="literal">null</span>);</span><br><span class="line">        canvas.drawLine(<span class="number">0</span>, height, width, height, mPaint);</span><br><span class="line">        canvas.drawLine(<span class="number">0</span>, height / <span class="number">2</span>, <span class="number">0</span>, height, mPaint);</span><br><span class="line">        canvas.drawLine(width, height / <span class="number">2</span>, width, height, mPaint);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//动画特效样式</span></span><br><span class="line">      <span class="keyword">case</span> STYLE_ANIMATOR:</span><br><span class="line">        setBackground(<span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">if</span> (isAnimatorRunning) &#123;</span><br><span class="line">          canvas.drawLine(width / <span class="number">2</span> - mAnimatorProgress, height, width / <span class="number">2</span> + mAnimatorProgress, height, mPaint);</span><br><span class="line">          <span class="keyword">if</span> (mAnimatorProgress == width / <span class="number">2</span>) &#123;</span><br><span class="line">            isAnimatorRunning = <span class="literal">false</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          canvas.drawLine(<span class="number">0</span>, height, width, height, mPaint);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">drawButtons</span><span class="params">(Canvas canvas)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isBtnVisible) &#123;</span><br><span class="line">      <span class="comment">//播放按钮出现的动画</span></span><br><span class="line">      <span class="keyword">if</span> (mVisibleAnimator.isRunning()) &#123;</span><br><span class="line">        <span class="type">float</span> <span class="variable">scale</span> <span class="operator">=</span> (<span class="type">float</span>) mVisibleAnimator.getAnimatedValue();</span><br><span class="line">        drawClearButton(scale, canvas);</span><br><span class="line">        <span class="keyword">if</span> (isPassword) &#123;</span><br><span class="line">          drawVisibleButton(scale, canvas, isPasswordVisible);</span><br><span class="line">        &#125;</span><br><span class="line">        invalidate();</span><br><span class="line">        <span class="comment">//绘制静态的按钮</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        drawClearButton(<span class="number">1</span>, canvas);</span><br><span class="line">        <span class="keyword">if</span> (isPassword) &#123;</span><br><span class="line">          drawVisibleButton(<span class="number">1</span>, canvas, isPasswordVisible);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">//播放按钮消失的动画</span></span><br><span class="line">      <span class="keyword">if</span> (mGoneAnimator.isRunning()) &#123;</span><br><span class="line">        <span class="type">float</span> <span class="variable">scale</span> <span class="operator">=</span> (<span class="type">float</span>) mGoneAnimator.getAnimatedValue();</span><br><span class="line">        drawClearButton(scale, canvas);</span><br><span class="line">        <span class="keyword">if</span> (isPassword) &#123;</span><br><span class="line">          drawVisibleButton(scale, canvas, isPasswordVisible);</span><br><span class="line">        &#125;</span><br><span class="line">        invalidate();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">drawClearButton</span><span class="params">(<span class="type">float</span> scale, Canvas canvas)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> (<span class="type">int</span>) (getWidth() + getScrollX() - mBtnPadding - mBtnWidth * (<span class="number">1f</span> - scale) / <span class="number">2f</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> (<span class="type">int</span>) (getWidth() + getScrollX() - mBtnPadding - mBtnWidth * (scale + (<span class="number">1f</span> - scale) / <span class="number">2f</span>));</span><br><span class="line">    <span class="type">int</span> <span class="variable">top</span> <span class="operator">=</span> (<span class="type">int</span>) ((getHeight() - mBtnWidth * scale) / <span class="number">2</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">bottom</span> <span class="operator">=</span> (<span class="type">int</span>) (top + mBtnWidth * scale);</span><br><span class="line">    <span class="type">Rect</span> <span class="variable">rect</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Rect</span>(left, top, right, bottom);</span><br><span class="line">    canvas.drawBitmap(mBitmapClear, <span class="literal">null</span>, rect, mPaint);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">drawVisibleButton</span><span class="params">(<span class="type">float</span> scale, Canvas canvas, <span class="type">boolean</span> isVisible)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> (<span class="type">int</span>) (getWidth() + getScrollX() - mBtnPadding * <span class="number">3</span> - mBtnWidth - mBtnWidth * (<span class="number">1f</span> - scale) / <span class="number">2f</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> (<span class="type">int</span>) (getWidth() + getScrollX() - mBtnPadding * <span class="number">3</span> - mBtnWidth - mBtnWidth * (scale + (<span class="number">1f</span> - scale) / <span class="number">2f</span>));</span><br><span class="line">    <span class="type">int</span> <span class="variable">top</span> <span class="operator">=</span> (<span class="type">int</span>) ((getHeight() - mBtnWidth * scale) / <span class="number">2</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">bottom</span> <span class="operator">=</span> (<span class="type">int</span>) (top + mBtnWidth * scale);</span><br><span class="line">    <span class="type">Rect</span> <span class="variable">rect</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Rect</span>(left, top, right, bottom);</span><br><span class="line">    <span class="keyword">if</span> (isVisible) &#123;</span><br><span class="line">      canvas.drawBitmap(mBitmapVisible, <span class="literal">null</span>, rect, mPaint);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      canvas.drawBitmap(mBitmapInvisible, <span class="literal">null</span>, rect, mPaint);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 清除按钮出现时的动画效果</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">startVisibleAnimator</span><span class="params">()</span> &#123;</span><br><span class="line">    endAllAnimator();</span><br><span class="line">    mVisibleAnimator.start();</span><br><span class="line">    invalidate();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 清除按钮消失时的动画效果</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">startGoneAnimator</span><span class="params">()</span> &#123;</span><br><span class="line">    endAllAnimator();</span><br><span class="line">    mGoneAnimator.start();</span><br><span class="line">    invalidate();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 结束所有动画</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">endAllAnimator</span><span class="params">()</span> &#123;</span><br><span class="line">    mGoneAnimator.end();</span><br><span class="line">    mVisibleAnimator.end();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onFocusChanged</span><span class="params">(<span class="type">boolean</span> focused, <span class="type">int</span> direction, Rect previouslyFocusedRect)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onFocusChanged(focused, direction, previouslyFocusedRect);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//播放按钮出现和消失动画</span></span><br><span class="line">    <span class="keyword">if</span> (focused &amp;&amp; getText().length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!isBtnVisible) &#123;</span><br><span class="line">        isBtnVisible = <span class="literal">true</span>;</span><br><span class="line">        startVisibleAnimator();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (isBtnVisible) &#123;</span><br><span class="line">        isBtnVisible = <span class="literal">false</span>;</span><br><span class="line">        startGoneAnimator();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//实现动画特效样式</span></span><br><span class="line">    <span class="keyword">if</span> (focused &amp;&amp; mBorderStyle.equals(STYLE_ANIMATOR)) &#123;</span><br><span class="line">      isAnimatorRunning = <span class="literal">true</span>;</span><br><span class="line">      mAnimator = ObjectAnimator.ofInt(<span class="built_in">this</span>, BORDER_PROGRESS, <span class="number">0</span>, getWidth() / <span class="number">2</span>);</span><br><span class="line">      mAnimator.setDuration(ANIMATOR_TIME);</span><br><span class="line">      mAnimator.start();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">setBorderProgress</span><span class="params">(<span class="type">int</span> borderProgress)</span> &#123;</span><br><span class="line">    mAnimatorProgress = borderProgress;</span><br><span class="line">    postInvalidate();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">protected</span> <span class="type">int</span> <span class="title function_">getBorderProgress</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> mAnimatorProgress;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onTextChanged</span><span class="params">(CharSequence text, <span class="type">int</span> start, <span class="type">int</span> lengthBefore, <span class="type">int</span> lengthAfter)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onTextChanged(text, start, lengthBefore, lengthAfter);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (text.length() &gt; <span class="number">0</span> &amp;&amp; isFocused()) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!isBtnVisible) &#123;</span><br><span class="line">        isBtnVisible = <span class="literal">true</span>;</span><br><span class="line">        startVisibleAnimator();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (isBtnVisible) &#123;</span><br><span class="line">        isBtnVisible = <span class="literal">false</span>;</span><br><span class="line">        startGoneAnimator();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onTouchEvent</span><span class="params">(MotionEvent event)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (event.getAction() == MotionEvent.ACTION_UP) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="type">boolean</span> <span class="variable">clearTouched</span> <span class="operator">=</span></span><br><span class="line">        (getWidth() - mBtnPadding - mBtnWidth &lt; event.getX())</span><br><span class="line">          &amp;&amp; (event.getX() &lt; getWidth() - mBtnPadding)</span><br><span class="line">          &amp;&amp; isFocused();</span><br><span class="line">      <span class="type">boolean</span> <span class="variable">visibleTouched</span> <span class="operator">=</span></span><br><span class="line">        (getWidth() - mBtnPadding * <span class="number">3</span> - mBtnWidth * <span class="number">2</span> &lt; event.getX())</span><br><span class="line">          &amp;&amp; (event.getX() &lt; getWidth() - mBtnPadding * <span class="number">3</span> - mBtnWidth)</span><br><span class="line">          &amp;&amp; isPassword &amp;&amp; isFocused();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (clearTouched) &#123;</span><br><span class="line">        setError(<span class="literal">null</span>);</span><br><span class="line">        setText(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (visibleTouched) &#123;</span><br><span class="line">        <span class="keyword">if</span> (isPasswordVisible) &#123;</span><br><span class="line">          isPasswordVisible = <span class="literal">false</span>;</span><br><span class="line">          setInputType(InputType.TYPE_TEXT_VARIATION_PASSWORD | InputType.TYPE_CLASS_TEXT);</span><br><span class="line">          setSelection(getText().length());</span><br><span class="line">          invalidate();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          isPasswordVisible = <span class="literal">true</span>;</span><br><span class="line">          setInputType(InputType.TYPE_TEXT_VARIATION_VISIBLE_PASSWORD);</span><br><span class="line">          setSelection(getText().length());</span><br><span class="line">          invalidate();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.onTouchEvent(event);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 开始晃动的入口</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startShakeAnimation</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (getAnimation() == <span class="literal">null</span>) &#123;</span><br><span class="line">      setAnimation(shakeAnimation(<span class="number">4</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    startAnimation(getAnimation());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 晃动动画</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> counts 0.5秒钟晃动多少下</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> Animation <span class="title function_">shakeAnimation</span><span class="params">(<span class="type">int</span> counts)</span> &#123;</span><br><span class="line">    <span class="type">Animation</span> <span class="variable">translateAnimation</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TranslateAnimation</span>(<span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    translateAnimation.setInterpolator(<span class="keyword">new</span> <span class="title class_">CycleInterpolator</span>(counts));</span><br><span class="line">    translateAnimation.setDuration(<span class="number">500</span>);</span><br><span class="line">    <span class="keyword">return</span> translateAnimation;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Bitmap <span class="title function_">createBitmap</span><span class="params">(Context context, <span class="type">int</span> resId, <span class="type">int</span> defResId)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (resId != <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> BitmapFactory.decodeResource(context.getResources(), resId);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> BitmapFactory.decodeResource(context.getResources(), defResId);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这个类里面会用到values目录中的attrs.xml 和 dimens.xml 如果没有就自行创建</p>
<h5 id="2、往attrs-xml中写入自定义EditText的属性"><a href="#2、往attrs-xml中写入自定义EditText的属性" class="headerlink" title="2、往attrs.xml中写入自定义EditText的属性"></a>2、往attrs.xml中写入自定义EditText的属性</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--  自定义EditText的属性--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">declare-styleable</span> <span class="attr">name</span>=<span class="string">&quot;PowerfulEditText&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--图片资源--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;clearDrawable&quot;</span> <span class="attr">format</span>=<span class="string">&quot;reference&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;visibleDrawable&quot;</span> <span class="attr">format</span>=<span class="string">&quot;reference&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;invisibleDrawable&quot;</span> <span class="attr">format</span>=<span class="string">&quot;reference&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--按钮宽度大小--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;BtnWidth&quot;</span> <span class="attr">format</span>=<span class="string">&quot;dimension&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--按钮间距大小--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;BtnSpacing&quot;</span> <span class="attr">format</span>=<span class="string">&quot;dimension&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--边框颜色和样式--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;styleColor&quot;</span> <span class="attr">format</span>=<span class="string">&quot;color&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;borderStyle&quot;</span> <span class="attr">format</span>=<span class="string">&quot;string&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">declare-styleable</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="3、往dimens-xml中写入一些大小配置"><a href="#3、往dimens-xml中写入一些大小配置" class="headerlink" title="3、往dimens.xml中写入一些大小配置"></a>3、往dimens.xml中写入一些大小配置</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Default screen margins, per the Android Design guidelines. 自定义editText的属性设置 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">&quot;activity_horizontal_margin&quot;</span>&gt;</span>16dp<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">&quot;activity_vertical_margin&quot;</span>&gt;</span>16dp<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--按钮间距大小--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">&quot;btn_edit_text_padding&quot;</span>&gt;</span>8dp<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--按钮宽度大小--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">&quot;btn_edit_text_width&quot;</span>&gt;</span>16dp<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="4、在布局文件中使用"><a href="#4、在布局文件中使用" class="headerlink" title="4、在布局文件中使用"></a>4、在布局文件中使用</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">com.你的包名.widgets.PowerfulEditText</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:id</span>=<span class="string">&quot;@+id/password_edit&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:layout_height</span>=<span class="string">&quot;45dp&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:background</span>=<span class="string">&quot;@null&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:paddingStart</span>=<span class="string">&quot;12dp&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:textSize</span>=<span class="string">&quot;15sp&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:hint</span>=<span class="string">&quot;请输入密码&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">app:BtnWidth</span>=<span class="string">&quot;@dimen/btn_edit_text_width&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">app:BtnSpacing</span>=<span class="string">&quot;@dimen/btn_edit_text_padding&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:inputType</span>=<span class="string">&quot;textPassword&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">tools:ignore</span>=<span class="string">&quot;RtlSymmetry&quot;</span> /&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>一共是7个样式可以在xml中使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">app:clearDrawable=&quot;@drawable/clear_all&quot;  </span><br><span class="line">app:visibleDrawable=&quot;@drawable/visible&quot;  </span><br><span class="line">app:invisibleDrawable=&quot;@drawable/invisible&quot;  </span><br><span class="line">app:BtnWidth=&quot;@dimen/btn_edittext_width&quot;  </span><br><span class="line">app:BtnSpacing=&quot;@dimen/btn_edittext_padding&quot;  </span><br><span class="line">app:borderStyle=&quot;halfRect&quot;  </span><br><span class="line">app:styleColor=&quot;#ff0000&quot;  </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其中，边框样式的对应规则如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1、矩形样式：         app:borderStyle=&quot;rectangle&quot;</span><br><span class="line"></span><br><span class="line">2、半矩形样式：       app:borderStyle=&quot;halfRect&quot;</span><br><span class="line"></span><br><span class="line">3、圆角矩形样式：     app:borderStyle=&quot;roundRect&quot;</span><br><span class="line"></span><br><span class="line">4、动画特效样式：     app:borderStyle=&quot;animator&quot;</span><br><span class="line"></span><br><span class="line">控件抖动的效果也是利用动画实现的。调用view实例的以下方法即可实现抖动。</span><br><span class="line"></span><br><span class="line">mPEditText.startShakeAnimation()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>也可以使用依赖的方式去项目中用，不过如果作者不维护, 那你的项目也就需要改动了</p>
<p>作者的<a href="https://github.com/AndroidWJC/PowerfulEditText">github链接</a></p>

	
	</div>
  <a type="button" href="/2020/12/18/Android自定义EditText一键清除和密文查看/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2020/12/09/linux-ubuntu-使用fail2ban-为nginx保驾护航/" >linux(ubuntu) - 使用fail2ban 为nginx保驾护航</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2020-12-09  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h4 id="Linux-ubuntu-使用fail2ban-为nginx保驾护航"><a href="#Linux-ubuntu-使用fail2ban-为nginx保驾护航" class="headerlink" title="Linux(ubuntu) - 使用fail2ban 为nginx保驾护航"></a>Linux(ubuntu) - 使用fail2ban 为nginx保驾护航</h4><h4 id="1、安装"><a href="#1、安装" class="headerlink" title="1、安装"></a>1、安装</h4><p>Fail2ban软件包包含在默认的Ubuntu 20.04存储库中。 要安装它，请以root或具有sudo特权的用户身份输入以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install fail2ban</span><br></pre></td></tr></table></figure>

<p>安装完成后，Fail2ban服务将自动启动。 您可以通过检查服务状态来验证它：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status fail2ban</span><br></pre></td></tr></table></figure>

<p>输出将如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fail2ban.service - Fail2Ban Service</span><br><span class="line">    Loaded: loaded (/lib/systemd/system/fail2ban.service; enabled; vendor preset: enabled)</span><br><span class="line">    Active: active (running) since Wed 2020-08-19 06:16:29 UTC; 27s ago</span><br><span class="line">      Docs: man:fail2ban(1)</span><br><span class="line">  Main PID: 1251 (f2b/server)</span><br><span class="line">     Tasks: 5 (limit: 1079)</span><br><span class="line">    Memory: 13.8M</span><br><span class="line">    CGroup: /system.slice/fail2ban.service</span><br><span class="line">            └─1251 /usr/bin/python3 /usr/bin/fail2ban-server -xf start</span><br></pre></td></tr></table></figure>

<h4 id="2、Fail2ban配置"><a href="#2、Fail2ban配置" class="headerlink" title="2、Fail2ban配置"></a>2、Fail2ban配置</h4><p>默认的<code>Fail2ban</code>安装带有两个配置文件， <code>/etc/fail2ban/jail.conf</code> 和 <code>/etc/fail2ban/jail.d/defaults-debian.conf</code>。 不建议修改这些文件，因为更新软件包时它们可能会被覆盖。</p>
<p>最好的做法是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local </span><br><span class="line">或者新建</span><br><span class="line">sudo vim /etc/fail2ban/jail.local </span><br></pre></td></tr></table></figure>

<p>然后修改 jail.local的内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[nginx-req-limit]</span><br><span class="line"></span><br><span class="line">enabled = true</span><br><span class="line">filter = nginx-req-limit</span><br><span class="line">action = iptables-multiport[name=ReqLimit, port=&quot;http,https&quot;, protocol=tcp]</span><br><span class="line">logpath = /var/log/nginx/access.log</span><br><span class="line">findtime = 60</span><br><span class="line">maxretry = 600</span><br><span class="line">bantime = 600</span><br></pre></td></tr></table></figure>

<p>新增文件：<code>/etc/fail2ban/filter.d/nginx-req-limit.conf</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># Fail2Ban configuration file</span><br><span class="line">#</span><br><span class="line"># supports: ngx_http_limit_req_module module</span><br><span class="line"></span><br><span class="line">[Definition]</span><br><span class="line"></span><br><span class="line">failregex =  -.*- .*HTTP/1.* .* .*$</span><br><span class="line"></span><br><span class="line"># Option: ignoreregex</span><br><span class="line"># Notes.: regex to ignore. If this regex matches, the line is ignored.</span><br><span class="line"># Values: TEXT</span><br><span class="line">#</span><br><span class="line">ignoreregex =</span><br></pre></td></tr></table></figure>
<h4 id="将IP地址列入白名单"><a href="#将IP地址列入白名单" class="headerlink" title="将IP地址列入白名单"></a>将IP地址列入白名单</h4><p>您可以将要排除在外的IP地址，IP范围或主机添加到 <code>ignoreip</code> 指示。 在这里，您应该添加您的本地PC IP地址和所有其他要列入白名单的计算机。</p>
<p><code>/etc/fail2ban/jail.local</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ignoreip = 127.0.0.1/8 ::1 123.123.123.123 192.168.1.0/24</span><br></pre></td></tr></table></figure>

<ul>
<li>每次编辑配置文件时，都需要重新启动Fail2ban服务以使更改生效：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart fail2ban</span><br></pre></td></tr></table></figure>

<h4 id="Fail2ban客户端-命令"><a href="#Fail2ban客户端-命令" class="headerlink" title="Fail2ban客户端 命令"></a>Fail2ban客户端 命令</h4><ul>
<li>检查监狱状态：</li>
</ul>
<p><code>sudo fail2ban-client status sshd</code></p>
<ul>
<li>解禁IP：</li>
</ul>
<p><code>sudo fail2ban-client set sshd unbanip 23.34.45.56</code></p>
<ul>
<li>禁止IP</li>
</ul>
<p><code>sudo fail2ban-client set sshd banip 23.34.45.56</code></p>

	
	</div>
  <a type="button" href="/2020/12/09/linux-ubuntu-使用fail2ban-为nginx保驾护航/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2020/12/09/给Linux安装nginx/" >给Linux安装nginx</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2020-12-09  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h4 id="给Linux-ubuntu-服务器安装nginx"><a href="#给Linux-ubuntu-服务器安装nginx" class="headerlink" title="给Linux(ubuntu)服务器安装nginx"></a>给Linux(ubuntu)服务器安装nginx</h4><h5 id="1：检查80端口是否被占用。"><a href="#1：检查80端口是否被占用。" class="headerlink" title="1：检查80端口是否被占用。"></a>1：检查80端口是否被占用。</h5><h5 id="2：安装nginx"><a href="#2：安装nginx" class="headerlink" title="2：安装nginx"></a>2：安装nginx</h5><p>给nginx配置安装目录,就是nginx存放的目录</p>
<p>我一般安装软件都是安装在&#x2F;usr&#x2F;local下面的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /usr/local/nginx</span><br></pre></td></tr></table></figure>

<p>进入nginx目录<code>cd /usr/local/nginx</code></p>
<p>使用wget命令下载nginx资源包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://nginx.org/download/nginx-1.12.2.tar.gz</span><br></pre></td></tr></table></figure>

<p>解压</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">tar</span> <span class="string">-zxvf</span> <span class="string">nginx-1.5.9.tar.gz</span></span><br></pre></td></tr></table></figure>


<p>执行<code> ./configure命令</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd nginx-1.5.9</span><br><span class="line">sudo ./configure</span><br></pre></td></tr></table></figure>

<p>执行<code>./configure</code>可能会存在一下错误,如果出现请执行一下命令</p>
<blockquote>
<p>错误1</p>
<p>&#x2F;configure: error: the HTTP rewrite module requires the PCRE library.</p>
</blockquote>
<p>解决方法</p>
<p>安装pcre-devel解决问题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install libpcre3 libpcre3-dev</span><br></pre></td></tr></table></figure>

<blockquote>
<p>错误2</p>
<p>.&#x2F;configure: error: the HTTP cache module requires md5 functions<br>from OpenSSL library. You can either disable the module by using<br>–without-http-cache option, or install the OpenSSL library into the system,<br>or build the OpenSSL library statically from the source with nginx by using<br>–with-http_ssl_module –with-openssl&#x3D;<path> options.</p>
</blockquote>
<p>解决办法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openssl libssl-dev</span><br></pre></td></tr></table></figure>

<blockquote>
<p>错误3 （如果出现这种检查不通过，则说明缺少某些依赖。）</p>
<p>ubuntu@VM-0-16-ubuntu:&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;nginx-1.12.2$ sudo .&#x2F;configure<br>checking for OS</p>
<p>Linux 4.15.0-118-generic x86_64<br>checking for C compiler … not found</p>
<p>.&#x2F;configure: error: C compiler cc is not found</p>
</blockquote>
<p>解决办法：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sudo</span> <span class="string">apt-get</span> <span class="string">install</span> <span class="string">build-essential</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>错误4</p>
<p>error: the HTTP gzip module requires the zlib library.</p>
</blockquote>
<p>解决办法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install zlib1g-dev</span><br></pre></td></tr></table></figure>


<p>然后在执行<code> ./configure命令</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd nginx-1.5.9</span><br><span class="line">sudo ./configure</span><br></pre></td></tr></table></figure>

<h5 id="3-编译"><a href="#3-编译" class="headerlink" title="3.编译"></a>3.编译</h5><p><code>make</code> 编译 （make的过程是把各种语言写的源码文件，变成可执行文件和各种库文件）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/nginx/nginx-1.5.9</span><br><span class="line">sudo make</span><br></pre></td></tr></table></figure>

<h5 id="4-make-install安装"><a href="#4-make-install安装" class="headerlink" title="4.make install安装"></a>4.make install安装</h5><p><code>make install</code> 安装 （<code>make install</code>是把这些编译出来的可执行文件和库文件复制到合适的地方）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo make install</span><br></pre></td></tr></table></figure>

<h5 id="5-启动nginx服务"><a href="#5-启动nginx服务" class="headerlink" title="5.启动nginx服务"></a>5.启动nginx服务</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/nginx/sbin</span><br><span class="line">sudo ./nginx</span><br></pre></td></tr></table></figure>
<h5 id="6-看nginx服务是否启动"><a href="#6-看nginx服务是否启动" class="headerlink" title="6.看nginx服务是否启动"></a>6.看nginx服务是否启动</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@VM-0-16-ubuntu:/usr/local/nginx/sbin$ ps -ef | grep nginx</span><br><span class="line">root      7183     1  0 14:53 ?        00:00:00 nginx: master process ./nginx</span><br><span class="line">nobody    7184  7183  0 14:53 ?        00:00:00 nginx: worker process</span><br><span class="line">ubuntu    7252 23084  0 14:53 pts/1    00:00:00 grep --color=auto nginx</span><br></pre></td></tr></table></figure>

<p>我们看到服务已经起来了,输入ip即可访问我们nginx目录下面的html文件夹下面的index.html文件</p>
<p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20201209145642.png"></p>
<p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;华丽的分割线&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p>
<p><code>nginx -s reload </code>：修改配置后重新加载生效</p>
<p><code>nginx -s reopen</code> ：重新打开日志文件</p>
<p>关闭nginx：</p>
<p><code>nginx -s stop</code> :快速停止nginx</p>
<p><code>quit </code>：完整有序的停止nginx</p>

	
	</div>
  <a type="button" href="/2020/12/09/给Linux安装nginx/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2020/12/09/给服务器设置ssh免密码登录/" >给服务器设置ssh免密码登录</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2020-12-09  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h4 id="给服务器设置ssh免密码登录"><a href="#给服务器设置ssh免密码登录" class="headerlink" title="给服务器设置ssh免密码登录"></a>给服务器设置ssh免密码登录</h4><h4 id="SSH是什么？"><a href="#SSH是什么？" class="headerlink" title="SSH是什么？"></a>SSH是什么？</h4><blockquote>
<p>SSH 为 Secure Shell 的缩写，由IETF的网络工作小组（Network Working Group）所制定；SSH为建立在应用层和传输层基础上的安全协议。<br>SSH是目前较可靠，专为远程登录会话和其他网络服务提供安全性的协议。利用SSH协议可以有效防止远程管理过程中的信息泄露问题。<br>SSH最初是UNIX系统上的一个程序，后来又迅速扩展到其他操作平台。SSH在正确使用时可弥补网络中的漏洞。SSH客户端适用于多种平台。<br>几乎所有UNIX平台—包括HP-UX、Linux、AIX、Solaris、Digital UNIX、Irix，以及其他平台，都可运行SSH。</p>
</blockquote>
<ul>
<li>简单来理解，就是我拥有一台服务器，我现在想要登录上去做一些事情，那就得使用ssh登录到远程的服务器上，才能在上面进行操作。</li>
</ul>
<h4 id="SSH-服务端以及客户端配置"><a href="#SSH-服务端以及客户端配置" class="headerlink" title="SSH 服务端以及客户端配置"></a>SSH 服务端以及客户端配置</h4><h5 id="启动-sshd-服务"><a href="#启动-sshd-服务" class="headerlink" title="启动 sshd 服务"></a>启动 sshd 服务</h5><blockquote>
<p>一开始在远程服务器上面，需要查看一下他的sshd服务启动了没有，如果没有启动，任何客户端主机是连接不上来的，一般如果是自己在云厂商处购买了主机，主机启动的时候就会把sshd服务启动起来。但有可能自己在测试环境搭建机器的时候，是没有默认启动的，这时候就需要在测试机器的终端看一下，命令如下</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@VM-0-16-ubuntu:~$ ps -ef | grep sshd</span><br><span class="line">root      1221     1  0 Dec07 ?        00:00:00 /usr/sbin/sshd -D</span><br><span class="line">root     15649  1221  0 09:21 ?        00:00:00 sshd: ubuntu [priv]</span><br><span class="line">ubuntu   15740 15649  0 09:21 ?        00:00:00 sshd: ubuntu@pts/0</span><br><span class="line">ubuntu   24863 15741  0 10:24 pts/0    00:00:00 grep --color=auto sshd</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里看到第一行,sshd已经启动起来了,进程号是 1221</p>
</blockquote>
<ul>
<li>如果没有启动的话,那就启动一下,命令如下</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@VM-0-16-ubuntu:~$ service sshd start</span><br></pre></td></tr></table></figure>

<h4 id="登录服务器主机的方式"><a href="#登录服务器主机的方式" class="headerlink" title="登录服务器主机的方式"></a>登录服务器主机的方式</h4><h4 id="1、客户端使用密码的方式登录目标主机"><a href="#1、客户端使用密码的方式登录目标主机" class="headerlink" title="1、客户端使用密码的方式登录目标主机"></a>1、客户端使用密码的方式登录目标主机</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ ssh root@192.168.0.187</span><br><span class="line">root@192.168.0.187&#x27;s password:</span><br></pre></td></tr></table></figure>
<p>输入密码即可</p>
<h4 id="2、客户端使用密钥方式登录目标主机-免密码"><a href="#2、客户端使用密钥方式登录目标主机-免密码" class="headerlink" title="2、客户端使用密钥方式登录目标主机(免密码)"></a>2、客户端使用密钥方式登录目标主机(免密码)</h4><blockquote>
<p>使用场景：</p>
<p>1、如果某个运维人员临时需要登录一台机器，但是机器的管理员并不想把密码暴露给他，所以会让这个运维人员发一个自己的公钥给自己，帮他添加进去，这个运维人员就可以顺利的登录机器了。在运维做完了自己的事情之后，机器的管理员会把他从公钥列表中删掉，这样一来整个过程，密码没有暴露，运维也在这段时间内登上了机器，很完美。</p>
<p>2、因为自己懒，不想敲密码,想直接使用自己在电脑上配置的ssh_xxx来登录</p>
</blockquote>
<h4 id="使用ssh-keygen生成密匙对"><a href="#使用ssh-keygen生成密匙对" class="headerlink" title="使用ssh-keygen生成密匙对"></a>使用ssh-keygen生成密匙对</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ cd .ssh </span><br><span class="line">➜  .ssh </span><br><span class="line">➜  .ssh ssh-keygen -t rsa</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/Users/zhaochao/.ssh/id_rsa): id_rsa</span><br><span class="line">Enter passphrase (empty for no passphrase):</span><br></pre></td></tr></table></figure>

<p>回车以后，询问是否要输入一个密码来保护这个密匙，为了方便起见，我就不输入了，不然每次使用这个密匙文件还要输一遍密码,直接一路回车就ok</p>
<p>到了这里，可以看到我们已经创建好了密匙对</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  .ssh ls</span><br><span class="line">id_rsa      id_rsa.pub  known_hosts</span><br></pre></td></tr></table></figure>
<p>我们可以使用<code>cat</code>命令来获取这个id_rsa.pub</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  .ssh cat id_rsa.pub </span><br><span class="line">ssh-rsa AAAAB3NDzaC1yc2EAFADAADAQFcPFT++P8rOkltuIGDSle45yEyDXtDGcCVcHmHAa8TH3/1G+cGusuvREewaJWdxS95fopdi7iumedN+bOJsCIyDsskuLJtt9FaT1MlEg8C3DH+VTkVTKadOYtFF0cwSediRadqjhMQqTOq6gH1g6zTkr4eGEIPp5RaPFDLZmeGiOeYvIS+d8eIdpHckO90KWL0T0bOcjifHlle+5ia0tSo4ZP5ekp0CxTlu0McorQIU7C1cjW/Iz5xQHpYFOdkKYImQob0H0bletwGY8K4A48ioEG9bfiBwbhmCrt93SGcp40G4e6KsuqLMe+5JUqqRcOg7TqvmD/FnftFbjDz2VTGJ/WlEJ4P3HXvAR8CdKPc/DJMmTV3oxwlmdgtDLFpqW7BkydkF2wSkO1+QP4p5ua3Ned7VLlNb16JKafBXD59q1yhwtsvhDxcgmk0tL5O3H4KPCHMZ6tePcWF2wPf+K/zLqV5DF2KXjat+PMveQf6NWAP+KK2jlG8AyV2+BBTI4nC5TdRZMXGmnVOvoc/eGbBB0NohoxZbFnjIVmpLUJcXrUXmXPojjauXQ0z37Ve/uOarVCkDTMimL+GZ4HrOx2s7FR1XM0cpw== 123456@qq.com</span><br></pre></td></tr></table></figure>

<h4 id="将公钥文件放进authorized-keys中"><a href="#将公钥文件放进authorized-keys中" class="headerlink" title="将公钥文件放进authorized_keys中"></a>将公钥文件放进authorized_keys中</h4><p>目标主机上如果没有.ssh文件夹，就自己创建一个，创建好之后,再创建一个authorized_keys文件。如果有的话就不用了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@wzt-dev2-PC:~/.ssh# ll</span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x  2 root root 4096 7月  17 19:49 ./</span><br><span class="line">drwx------ 10 root root 4096 7月  17 19:49 ../</span><br><span class="line">-rw-r--r--  1 root root    0 7月  17 19:49 authorized_keys</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim authorized_keys</span><br></pre></td></tr></table></figure>

<p>将刚才的id_rsa.pub的内容放进去保存一下就可以</p>
<h4 id="这里需要注意"><a href="#这里需要注意" class="headerlink" title="这里需要注意"></a>这里需要注意</h4><blockquote>
<p>authorized_keys 文件对权限有哟求，必须是600(-rw——-)或者644<br>.ssh目录 必须是700(drwx——),否则一会儿登录不成功<br>弄完之后检查一下权限，如果不是的话，改成响应的权限就ok了</p>
</blockquote>
<h4 id="准备就绪，在客户端上登录目标主机"><a href="#准备就绪，在客户端上登录目标主机" class="headerlink" title="准备就绪，在客户端上登录目标主机"></a>准备就绪，在客户端上登录目标主机</h4><p>在登录之前，要确认一下目标主机是否允许密匙对登录，一般都是打开的，如果没有打开就自己打开</p>
<blockquote>
<p>(查看 &#x2F;etc&#x2F;ssh&#x2F;sshd_config 文件内容 中的 PubkeyAuthentication 这一项是否为 yes,如果不是就自己修改成yes之后重启sshd服务 )</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">wzy@wzt-dev2-PC:~$ cat /etc/ssh/sshd_config</span><br><span class="line"># Package generated configuration file</span><br><span class="line"># See the sshd_config(5) manpage for details</span><br><span class="line"></span><br><span class="line"># What ports, IPs and protocols we listen for</span><br><span class="line">Port 22</span><br><span class="line"># Use these options to restrict which interfaces/protocols sshd will bind to</span><br><span class="line">#ListenAddress ::</span><br><span class="line">#ListenAddress 0.0.0.0</span><br><span class="line">Protocol 2</span><br><span class="line"># HostKeys for protocol version 2</span><br><span class="line">HostKey /etc/ssh/ssh_host_rsa_key</span><br><span class="line">HostKey /etc/ssh/ssh_host_dsa_key</span><br><span class="line">HostKey /etc/ssh/ssh_host_ecdsa_key</span><br><span class="line">HostKey /etc/ssh/ssh_host_ed25519_key</span><br><span class="line">#Privilege Separation is turned on for security</span><br><span class="line">UsePrivilegeSeparation yes</span><br><span class="line"></span><br><span class="line"># Lifetime and size of ephemeral version 1 server key</span><br><span class="line">KeyRegenerationInterval 3600</span><br><span class="line">ServerKeyBits 1024</span><br><span class="line"></span><br><span class="line"># Logging</span><br><span class="line">SyslogFacility AUTH</span><br><span class="line">LogLevel INFO</span><br><span class="line"></span><br><span class="line"># Authentication:</span><br><span class="line">LoginGraceTime 120</span><br><span class="line">PermitRootLogin yes</span><br><span class="line">StrictModes yes</span><br><span class="line"></span><br><span class="line">RSAAuthentication yes</span><br><span class="line">PubkeyAuthentication yes   &lt;---------------  在这里</span><br><span class="line">#AuthorizedKeysFile %h/.ssh/authorized_keys</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>到此我们就配置完了。 (不用输入密码就可以登录了)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ ./ssh_my_tencent </span><br><span class="line">Welcome to Ubuntu 18.04.4 LTS (GNU/Linux 4.15.0-118-generic x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/advantage</span><br><span class="line"></span><br><span class="line">  System information as of Wed Dec  9 10:45:26 CST 2020</span><br><span class="line"></span><br><span class="line">  System load:  0.0               Processes:           89</span><br><span class="line">  Usage of /:   5.0% of 49.15GB   Users logged in:     0</span><br><span class="line">  Memory usage: 12%               IP address for eth0: 172.21.0.16</span><br><span class="line">  Swap usage:   0%</span><br><span class="line"></span><br><span class="line"> * Introducing self-healing high availability clusters in MicroK8s.</span><br><span class="line">   Simple, hardened, Kubernetes for production, from RaspberryPi to DC.</span><br><span class="line"></span><br><span class="line">     https://microk8s.io/high-availability</span><br><span class="line"></span><br><span class="line"> * Canonical Livepatch is available for installation.</span><br><span class="line">   - Reduce system reboots and improve kernel security. Activate at:</span><br><span class="line">     https://ubuntu.com/livepatch</span><br><span class="line">New release &#x27;20.04.1 LTS&#x27; available.</span><br><span class="line">Run &#x27;do-release-upgrade&#x27; to upgrade to it.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt; Hi, How are you &gt;</span><br><span class="line"> -----------------</span><br><span class="line">        \   ^__^</span><br><span class="line">         \  (oo)\_______</span><br><span class="line">            (__)\       )\/\</span><br><span class="line">                ||----w |</span><br><span class="line">                ||     ||</span><br><span class="line">Last login: Wed Dec  9 09:21:16 2020 from 124.126.1.181</span><br></pre></td></tr></table></figure>
	
	</div>
  <a type="button" href="/2020/12/09/给服务器设置ssh免密码登录/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2020/12/08/给Linux服务器设置登录提示/" >给Linux服务器设置登录提示</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2020-12-08  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h5 id="1、给Linux设置登录提示"><a href="#1、给Linux设置登录提示" class="headerlink" title="1、给Linux设置登录提示"></a>1、给Linux设置登录提示</h5><p><img src="https://cdn.jsdelivr.net/gh/Naruto-1996/picture/images/20201208180823.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/motd</span><br></pre></td></tr></table></figure>

<p>然后把你想要的内用拷贝进去 退出服务器,重新登录就可以看到了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt; Hi, How are you &gt;</span><br><span class="line"> -----------------</span><br><span class="line">        \   ^__^</span><br><span class="line">         \  (oo)\_______</span><br><span class="line">            (__)\       )\/\</span><br><span class="line">                ||----w |</span><br><span class="line">                ||     ||  </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="2、给Linux设置彩色界面"><a href="#2、给Linux设置彩色界面" class="headerlink" title="2、给Linux设置彩色界面"></a>2、给Linux设置彩色界面</h5><h5 id="查看当前终端支持集中颜色"><a href="#查看当前终端支持集中颜色" class="headerlink" title="查看当前终端支持集中颜色"></a>查看当前终端支持集中颜色</h5><p>使用<code>tput colors</code>命令即可查看当前终端支持几种颜色</p>
<h5 id="查看当前终端类型"><a href="#查看当前终端类型" class="headerlink" title="查看当前终端类型"></a>查看当前终端类型</h5><p><code>$TERM</code>变量代表当前终端类型，可使用<code>echo $TERM</code>命令查看。</p>
<h5 id="输出当前支持的颜色"><a href="#输出当前支持的颜色" class="headerlink" title="输出当前支持的颜色"></a>输出当前支持的颜色</h5><p>运行以下命令，若输出了完整的256种颜色，就说明当前终端支持256色：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(x=`tput op` y=`printf %76s`;for i in &#123;0..256&#125;;do o=00$i;echo -e $&#123;o:$&#123;#o&#125;-3:3&#125; `tput setaf $i;tput setab $i`$&#123;y// /=&#125;$x;done)</span><br></pre></td></tr></table></figure>

<p>若只有前8种颜色，说明当前配置是8色模式，默认情况下，Ubuntu中的Gnome-Terminal就只开启了8色支持。此时可通过修改<code>~/.bashrc</code>文件将其改为256色，在<code>.bashrc</code>文件最后中加入以下代码即可：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export TERM=vte-256color</span><br></pre></td></tr></table></figure>

<p>如果没有<code>.bashrc</code>文件 可以选择<code>sudo vim .bashrc</code> 创建一个 也可以使用<code>sudo cp /etc/skel/.bashrc ./</code> 命令拷贝到home目录下</p>
<p>最后输入命令source ~&#x2F;.bashrc，一定要输入，不然配置文件无法生效(虽然source了但是退出登录进来后有没有了颜色)</p>
<h5 id="解决-bashrc文件每次打开终端都需要source的问题"><a href="#解决-bashrc文件每次打开终端都需要source的问题" class="headerlink" title="解决.bashrc文件每次打开终端都需要source的问题"></a>解决.bashrc文件每次打开终端都需要source的问题</h5><p><code>sudo vim ~/.bash_profile</code>在文件内部输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 加载.bashrc文件</span><br><span class="line">if test -f .bashrc ; then</span><br><span class="line">source .bashrc </span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

	
	</div>
  <a type="button" href="/2020/12/08/给Linux服务器设置登录提示/#more" class="btn btn-default more">阅读此文</a>
</div>

		

		</div>

		<!-- pagination -->
		<div>
  		<center>
		<div class="pagination">

   
    
     <a href="/" type="button" class="btn btn-default"><i class="fa fa-arrow-circle-o-left"></i> 上一页</a>
      

        <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
 
       <a href="/page/3/" type="button" class="btn btn-default ">下一页<i class="fa fa-arrow-circle-o-right"></i></a>     
        

  
</div>

  		</center>
		</div>

		
		
	</div> <!-- col-md-9 -->

	
		<div class="col-md-3">
	<div id="sidebar">
	
			
  <div id="site_search">
   <div class="form-group">
    <input type="text" id="local-search-input" name="q" results="0" placeholder="搜索" class="st-search-input st-default-search-input form-control"/>
   </div>  
  <div id="local-search-result"></div>
  </div>


		
			
	<div class="widget">
		<h4>分类</h4>
		<ul class="tag_box inline list-unstyled">
		
			<li><a href="/categories/Android/">Android<span>11</span></a></li>
		
			<li><a href="/categories/Appium/">Appium<span>1</span></a></li>
		
			<li><a href="/categories/ETH智能合约/">ETH智能合约<span>1</span></a></li>
		
			<li><a href="/categories/Fail2ban/">Fail2ban<span>1</span></a></li>
		
			<li><a href="/categories/IDEA/">IDEA<span>1</span></a></li>
		
			<li><a href="/categories/Java/">Java<span>1</span></a></li>
		
			<li><a href="/categories/Linux/">Linux<span>6</span></a></li>
		
			<li><a href="/categories/Mac/">Mac<span>3</span></a></li>
		
			<li><a href="/categories/Maven/">Maven<span>1</span></a></li>
		
			<li><a href="/categories/NFT/">NFT<span>1</span></a></li>
		
			<li><a href="/categories/Redis/">Redis<span>1</span></a></li>
		
			<li><a href="/categories/Rust/">Rust<span>3</span></a></li>
		
			<li><a href="/categories/Ubuntu/">Ubuntu<span>1</span></a></li>
		
			<li><a href="/categories/github/">github<span>1</span></a></li>
		
			<li><a href="/categories/mysql/">mysql<span>1</span></a></li>
		
			<li><a href="/categories/nginx/">nginx<span>1</span></a></li>
		
			<li><a href="/categories/oh-my-zsh/">oh my zsh<span>1</span></a></li>
		
			<li><a href="/categories/rails/">rails<span>2</span></a></li>
		
			<li><a href="/categories/redis/">redis<span>1</span></a></li>
		
			<li><a href="/categories/web前端/">web前端<span>1</span></a></li>
		
			<li><a href="/categories/图床/">图床<span>1</span></a></li>
		
			<li><a href="/categories/钓鱼网站/">钓鱼网站<span>1</span></a></li>
		
		</ul>
	</div>

		
			
	<div class="widget">
		<h4>标签云</h4>
		<ul class="tag_box inline list-unstyled">		
		
			<li><a href="/tags/xml/">xml<span>1</span></a></li>
		
			<li><a href="/tags/ImageView/">ImageView<span>1</span></a></li>
		
			<li><a href="/tags/字面量/">字面量<span>1</span></a></li>
		
			<li><a href="/tags/RecycleView/">RecycleView<span>2</span></a></li>
		
			<li><a href="/tags/Runtime/">Runtime<span>1</span></a></li>
		
			<li><a href="/tags/背景图/">背景图<span>1</span></a></li>
		
			<li><a href="/tags/mysql/">mysql<span>2</span></a></li>
		
			<li><a href="/tags/tabLayout/">tabLayout<span>1</span></a></li>
		
			<li><a href="/tags/Maven/">Maven<span>1</span></a></li>
		
			<li><a href="/tags/EditText/">EditText<span>1</span></a></li>
		
			<li><a href="/tags/IDEA/">IDEA<span>1</span></a></li>
		
			<li><a href="/tags/腾讯云服务器/">腾讯云服务器<span>1</span></a></li>
		
			<li><a href="/tags/Mac/">Mac<span>4</span></a></li>
		
			<li><a href="/tags/0u8/">0u8<span>1</span></a></li>
		
			<li><a href="/tags/setFlags/">setFlags<span>1</span></a></li>
		
			<li><a href="/tags/Android/">Android<span>2</span></a></li>
		
			<li><a href="/tags/Intent/">Intent<span>1</span></a></li>
		
			<li><a href="/tags/Rust/">Rust<span>2</span></a></li>
		
			<li><a href="/tags/nginx/">nginx<span>1</span></a></li>
		
			<li><a href="/tags/Solidity/">Solidity<span>1</span></a></li>
		
		
		   <li><a href="/tags">...<span>59</span></a></li>
		 
		</ul>
	</div>


		
			
<div class="widget">
  <h4>最新文章</h4>
  <ul class="entry list-unstyled">
    
      <li>
        <a href="/2024/07/02/Maven配置镜像的正确姿势/" ><i class="fa fa-file-o"></i>Maven 配置镜像</a>
      </li>
    
      <li>
        <a href="/2021/10/12/appium自动化测试/" ><i class="fa fa-file-o"></i>appium自动化测试</a>
      </li>
    
      <li>
        <a href="/2021/07/30/deploy-a-nft-art-and-transfer-in-eth-testnet/" ><i class="fa fa-file-o"></i>deploy a nft art and transf...</a>
      </li>
    
      <li>
        <a href="/2021/07/01/记一次被钓鱼网站盗走eth的经历/" ><i class="fa fa-file-o"></i>记一次被钓鱼网站盗走eth的经历</a>
      </li>
    
      <li>
        <a href="/2021/06/25/Android-tablayout-viewpager2-fragment-你可能用错了/" ><i class="fa fa-file-o"></i>Android tablayout viewpager...</a>
      </li>
    
  </ul>
</div>

		
			
<div class="widget">
	<h4>链接</h4>
	<ul class="blogroll list-unstyled">
	
		<li><i class="false"></i><a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" title="" target="_blank"]);">hexo-theme-bithack</a></li>
	
	</ul>
</div>


		
	</div> <!-- sidebar -->
</div> <!-- col-md-3 -->

	
	
</div> <!-- row-fluid -->
	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2024 Weaver Li's Blog
  
      powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.Theme <a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" target="_blank">freemind.bithack</a>  
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
